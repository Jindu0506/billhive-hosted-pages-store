(function(){"use strict";const f={baseUrl:"http://localhost:4001",endpoints:{pricingTable:r=>`/products/${r}/pricing-table`,products:"/products",subscriptions:"/subscriptions"},headers:{"Content-Type":"application/json",Accept:"application/json"},getAuthHeaders(){return{...this.headers,"api-key":this.apiKey}},getPricingTableUrl(r=null){const e=r||this.productId;return`${this.baseUrl}${this.endpoints.pricingTable(e)}`}};typeof module<"u"&&module.exports&&(module.exports=f),typeof window<"u"&&(window.ApiConfig=f);function x(r,e=null){let t="";switch(console.log("generateThemeCSS :",r),e){case"Pricing-Table":return r.branding&&(r.branding.primaryColor&&(t+=`--billhive-primary-color: ${r.branding.primaryColor};
    `),r.branding.backgroundColor&&(t+=`--billhive-background-color: ${r.branding.backgroundColor};
    `)),r.header&&(r.header.color&&(t+=`--billhive-header-text-color: ${r.header.color};
    `),r.header.fontSize&&(t+=`--billhive-header-font-size: ${r.header.fontSize}px;
    `),r.header.fontWeight&&(t+=`--billhive-header-font-weight: ${r.header.fontWeight};
    `)),r.card&&(r.card.backgroundColor&&(t+=`--billhive-card-background-color: ${r.card.backgroundColor};
    `),r.card.headerColor&&(t+=`--billhive-card-header-color: ${r.card.headerColor};
    `),r.card.textColor&&(t+=`--billhive-card-text-color: ${r.card.textColor};
    `),r.card.borderColor&&(t+=`--billhive-card-border-color: ${r.card.borderColor};
    `),r.card.headerFontSize&&(t+=`--billhive-card-header-font-size: ${r.card.headerFontSize}px;
    `),r.card.textFontSize&&(t+=`--billhive-card-text-font-size: ${r.card.textFontSize}px;
    `),r.card.headerFontWeight&&(t+=`--billhive-card-header-font-weight: ${r.card.headerFontWeight};
    `),r.card.shadow&&(t+=`--billhive-card-shadow: ${{small:"0 1px 3px rgba(0, 0, 0, 0.12)",medium:"0 4px 6px rgba(0, 0, 0, 0.1)",large:"0 10px 15px rgba(0, 0, 0, 0.1)"}[r.card.shadow]||r.card.shadow};
    `)),r.notes&&r.notes.fontSize&&(t+=`--billhive-font-size-foot-notes: ${r.notes.fontSize}px;
    `),`
    :host {
      ${t.trim()}
    }
  `;case"Checkout":return r.branding&&(r.branding.logoPath&&(t+=`--billhive-logo-path: url(${r.branding.logoPath});
    `),r.branding.primaryColor&&(t+=`--billhive-accent-color: ${r.branding.primaryColor};
    `),r.branding.secondaryColor&&(t+=`--billhive-secondary-color: ${r.branding.secondaryColor};
    `),r.branding.fontFamily&&(t+=`--billhive-font-family: ${r.branding.fontFamily};
    `),r.branding.textFontSize&&(t+=`--billhive-font-size: ${r.branding.textFontSize};
    `),r.branding.textColor&&(t+=`--billhive-text-color: ${r.branding.textColor};
    `)),r.header&&(r.header.color&&(t+=`--billhive-header-color: ${r.header.color};
    `),r.header.textColor&&(t+=`--billhive-header-text-color: ${r.header.textColor};
    `),r.header.fontSize&&(t+=`--billhive-header-font-size: ${r.header.fontSize};
    `),r.header.fontWeight&&(t+=`--billhive-header-font-weight: ${r.header.fontWeight};
    `)),r.subHeader&&(r.subHeader.fontSize&&(t+=`--billhive-sub-header-font-size: ${r.subHeader.fontSize};
    `),r.subHeader.textColor&&(t+=`--billhive-sub-header-text-color: ${r.subHeader.textColor};
    `),r.subHeader.fontWeight&&(t+=`--billhive-sub-header-font-weight: ${r.subHeader.fontWeight};
    `)),r.inputComponent&&(r.inputComponent.color&&(t+=`--billhive-input-components-color: ${r.inputComponent.color};
    `),r.inputComponent.borderColor&&(t+=`--billhive-border-color: ${r.inputComponent.borderColor};
    `)),r.card&&(r.card.color&&(t+=`--billhive-cards-color: ${r.card.color};
    `),r.card.borderColor&&(t+=`--billhive-card-border-color: ${r.card.borderColor};
    `),r.card.borderRadius&&(t+=`--billhive-card-border-radius: ${r.card.borderRadius};
    `),r.card.borderWidth&&(t+=`--billhive-card-border-width: ${r.card.borderWidth};
    `)),`
    :host {
      ${t.trim()}
    }
  `}return r.theme&&typeof r.theme=="object"&&(r.theme.colors&&Object.entries(r.theme.colors).forEach(([o,i])=>{let a;switch(o){case"accent":a="--billhive-accent-color";break;case"header":a="--billhive-header-color";break;case"highlightPanel":a="--billhive-highlight-panel-color";break;case"card":a="--billhive-cards-color";break;case"inputComponent":a="--billhive-input-components-color";break;case"text":a="--billhive-text-color";break;case"subText":a="--billhive-sub-text-color";break;case"borders":a="--billhive-border-color";break;case"accentHover":a="--billhive-accent-hover";break;case"accentLight":a="--billhive-accent-light";break;default:a=`--billhive-${o.replace(/([A-Z])/g,"-$1").toLowerCase()}-color`}t+=`${a}: ${i};
    `}),r.theme.typography&&Object.entries(r.theme.typography).forEach(([o,i])=>{const a=`--billhive-${o.replace(/([A-Z])/g,"-$1").toLowerCase()}`;t+=`${a}: ${i};
    `}),r.theme.shadows&&Object.entries(r.theme.shadows).forEach(([o,i])=>{let a;switch(o){case"card":a="--billhive-card-shadow";break;case"modal":a="--billhive-modal-shadow";break;case"button":a="--billhive-button-shadow";break;default:a=`--billhive-${o}-shadow`}t+=`${a}: ${i};
    `}),r.layout&&(t+=`--billhive-layout: ${r.layout};
    `)),console.log("generateThemeCSS Response :",t),`
    :host {
      ${t.trim()}
    }
  `}function C(r){if(console.log("Merging themes. Custom theme:",r),!r)throw new Error("mergeThemes: customTheme is required and cannot be null or undefined");if(!r.theme)throw new Error('mergeThemes: customTheme must have a "theme" property containing colors, typography, and shadows');if(!r.theme.colors)throw new Error("mergeThemes: theme.colors section is required");if(!r.theme.typography)throw new Error("mergeThemes: theme.typography section is required");if(["accent","text"].forEach(o=>{if(!r.theme.colors[o])throw new Error(`mergeThemes: Required color property missing: theme.colors.${o}`)}),!r.theme.typography.fontFamily)throw new Error("mergeThemes: Required typography property missing: theme.typography.fontFamily");const t=JSON.parse(JSON.stringify(r));return console.log("Processed theme:",t),t}function w(r){let e=r.replace("#","");e.length===8&&(e=e.substr(0,6));const t=parseInt(e.substr(0,2),16),o=parseInt(e.substr(2,2),16),i=parseInt(e.substr(4,2),16),a=Math.floor(t*.8),n=Math.floor(o*.8),l=Math.floor(i*.8);return{theme:{colors:{accentHover:`#${a.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}${l.toString(16).padStart(2,"0")}`,accentLight:`rgba(${t}, ${o}, ${i}, 0.1)`},shadows:{button:`0 2px 4px rgba(${t}, ${o}, ${i}, 0.3)`}}}}function k(r){if(!r)throw new Error("validateTheme: theme is required and cannot be null or undefined");if(!r.theme)throw new Error('validateTheme: Theme must have a "theme" property containing colors, typography, and shadows');const e=r.theme;if(!e.colors)throw new Error("validateTheme: Missing theme.colors section");if(["accent","text"].forEach(i=>{if(!e.colors[i])throw new Error(`validateTheme: Missing required color property: theme.colors.${i}`)}),Object.entries(e.colors).forEach(([i,a])=>{if(a&&typeof a=="string"&&!a.match(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{8}|[A-Fa-f0-9]{3})|rgba?\(.*\)$/))throw new Error(`validateTheme: Invalid color format for theme.colors.${i}: ${a}`)}),!e.typography)throw new Error("validateTheme: Missing theme.typography section");if(["fontFamily"].forEach(i=>{if(!e.typography[i])throw new Error(`validateTheme: Missing required typography property: theme.typography.${i}`)}),r.layout&&!["in-app","full-page"].includes(r.layout))throw new Error(`validateTheme: Invalid layout value: ${r.layout}. Must be 'in-app' or 'full-page'`)}class P extends HTMLElement{constructor(){console.log("[Checkout WebComponent] constructor"),super(),this.selectedPlan=null,this.productId=null,this.planId=null,this.apiKey=null,this.isLoadingPlan=!1,this.planLoadError=null,this.addons=[],this.selectedAddons=new Set,this.addonQuantities=new Map,this.isLoadingAddons=!1,this.addonsLoadError=null,this.isVisible=!1,this.couponCode="",this.appliedCoupon=null,this.availableDiscounts=[],this.selectedDiscount=null,this.isLoadingOffers=!1,this.offersLoadError=null,this.updateTimeout=null,this.orderEstimate=null,this.isLoadingEstimate=!1,this.estimateError=null,this.estimateRequestId=0,this.currentModalStep="plan-selection",this.existingAccount=null,this.isCheckingExistingAccount=!1,this.createdOrder=null,this.isCreatingOrder=!1,this.orderCreated=!1,this.orderInvoices=[],this.isLoadingInvoices=!1,this.personalDetails={firstName:"",lastName:"",email:"",phone:"",company:"",address:{addressLine:"",city:"",state:"",zipCode:"",country:""}},this.formErrors={},this.selectedPaymentMethod="",this.orderData=null,this.paymentDetails={card:{cardNumber:"",expiryDate:"",cvv:"",cardholderName:""},upi:{upiId:""},netbanking:{bankName:""},wallet:{walletType:"",walletNumber:""}},this.theme=null,this.cashfreeInstance=null,this.cashfreeComponents={cardNumber:null,cardHolder:null,cardExpiry:null,cardCvv:null,upiCollect:null,wallets:new Map},this.preview=!1}set theme(e){try{this.theme=typeof e=="string"?JSON.parse(e):e}catch(t){console.warn("bh-checkout: failed to parse theme JSON, using raw value",t),this.theme=e}this.loadTheme(),this.render()}get theme(){return this.theme}applyThemeData(e){var t,o;console.log("[Checkout WebComponent] applyThemeData");try{const i=k(e);if(i.isValid){this.theme=C(e);const a=((o=(t=e.theme)==null?void 0:t.colors)==null?void 0:o.accent)||e.accentColor;if(a){const n=w(a);this.theme={...this.theme,theme:{...this.theme.theme,colors:{...this.theme.theme.colors,...n.theme.colors},shadows:{...this.theme.theme.shadows,...n.theme.shadows}}}}console.log("Checkout programmatic theme applied:",this.theme),this.render()}else console.warn("Invalid themeData configuration:",i.errors)}catch(i){console.warn("Error applying themeData:",i)}}static get observedAttributes(){return["product-id","plan-id","api-key","theme","preview"]}connectedCallback(){console.log("[Checkout WebComponent] connectedCallback"),this.loadData(),this.loadCashfreeSDK(),this.setupEventListeners()}async loadCashfreeSDK(){console.log("[Checkout WebComponent] loadCashfreeSDK");try{if(window.Cashfree){console.log("Cashfree SDK already loaded globally"),this.cashfreeInstance=window.Cashfree;return}const e=document.createElement("script");e.src="https://sdk.cashfree.com/js/v3/cashfree.js",e.async=!0,await new Promise((t,o)=>{e.onload=()=>{console.log("Cashfree SDK script loaded"),window.Cashfree?(this.cashfreeInstance=new window.Cashfree({mode:"sandbox"}),console.log("✅ Cashfree SDK initialized successfully"),t()):o(new Error("Cashfree object not found after script load"))},e.onerror=o,document.head.appendChild(e)})}catch(e){console.error("❌ Failed to load Cashfree SDK:",e)}}attributeChangedCallback(e,t,o){console.log("[Checkout WebComponent] attributeChangedCallback"),t!==o&&(e==="product-id"?this.productId=o:e==="plan-id"?this.planId=o:e==="api-key"?this.apiKey=o:e==="theme"?this.theme=o:e==="preview"&&(this.preview=o==="true"))}loadData(){console.log("[Checkout WebComponent] loadData"),this.productId=this.getAttribute("product-id"),this.planId=this.getAttribute("plan-id"),this.apiKey=this.getAttribute("api-key"),this.planId||(this.addons=[],this.selectedPlan=null),this.loadTheme()}loadTheme(){var t,o;console.log("[Checkout WebComponent] loadTheme"),this.theme={};const e=this.getAttribute("theme");if(console.log("themeAttr :",e),e)try{const i=JSON.parse(e);if(console.log("Parsed customTheme:",i),i.theme&&(i.theme.branding||i.theme.header||i.theme.card))console.log("Detected Checkout-specific theme structure"),this.theme=i.theme,console.log("Checkout custom theme applied:",this.theme);else try{if(k(i).isValid){this.theme=C(i);const n=((o=(t=i.theme)==null?void 0:t.colors)==null?void 0:o.accent)||i.accentColor;if(n){const l=w(n);this.theme={...this.theme,theme:{...this.theme.theme,colors:{...this.theme.theme.colors,...l.theme.colors},shadows:{...this.theme.theme.shadows,...l.theme.shadows}}}}console.log("Standard theme applied:",this.theme)}}catch(a){console.warn("Theme validation failed:",a.message)}}catch(i){console.warn("Invalid JSON in theme attribute:",i)}console.log("Final checkout theme loaded:",this.theme)}loadPlan(){console.log("[Checkout WebComponent] loadPlan"),this.selectedPlan=null}async loadPlanFromApi(){var e;if(console.log("[Checkout WebComponent] loadPlanFromApi"),!!this.planId&&!this.preview){this.isLoadingPlan=!0,this.planLoadError=null;try{const o=`${((e=window.ApiConfig)==null?void 0:e.baseUrl)||f.baseUrl}/rate-plan-prices/${this.planId}`,i=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey}});if(!i.ok)throw new Error(`HTTP error! status: ${i.status}`);const a=await i.json();this.selectedPlan=this.transformPlanApiData(a),this.isLoadingPlan=!1,this.planLoadError=null,this.render(),this.loadAddonsFromApi().catch(n=>{console.error("Failed to load addons:",n)}),this.loadApplicableOffers().catch(n=>{console.error("Failed to load applicable offers:",n)}),this.updateOrderSummary()}catch(t){this.planLoadError=t.message,this.isLoadingPlan=!1,this.isLoadingAddons=!1,this.loadPlan(),this.addons=[],this.render()}}}transformPlanApiData(e){var o,i,a;return console.log("[Checkout WebComponent] transformPlanApiData"),{id:e.ratePlanId,ratePlanPriceId:e.ratePlanPriceId,name:e.name||e.externalName,description:e.description,price:e.price,currencyCode:e.currencyCode,period:((o=e.billingPeriod)==null?void 0:o.periodName)||((i=e.billingPeriod)==null?void 0:i.period),periodName:(a=e.billingPeriod)==null?void 0:a.periodName,billingPeriod:e.billingPeriod,features:e.addons||e.features||[],recommended:e.mostPopular||!1,planLevel:e.planLevel,isTrial:e.isTrial,trialPeriod:e.trialPeriod,ratePlanKey:e.ratePlanKey,productName:e.productName,productId:e.productId,status:e.status,isVisibleInPortal:e.isVisibleInPortal,isVisibleInCheckout:e.isVisibleInCheckout,requireBillingAtSignup:e.requireBillingAtSignup,autoRenew:e.autoRenew,termLength:e.termLength,taxIncluded:e.taxIncluded,pricingModel:e.pricingModel,billingCycle:e.billingCycle}}async loadAddonsFromApi(){var e,t;if(console.log("[Checkout WebComponent] loadAddonsFromApi"),!((e=this.selectedPlan)!=null&&e.ratePlanPriceId)){this.addons=[];return}if(!this.preview){this.isLoadingAddons=!0,this.addonsLoadError=null;try{const o=((t=window.ApiConfig)==null?void 0:t.baseUrl)||f.baseUrl,i=encodeURIComponent('{"where":{"applicability":{"neq":"Mandatory"}}}'),a=`${o}/rate-plan-prices/${this.selectedPlan.ratePlanPriceId}/addons?filter=${i}`,n=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey}});if(!n.ok)throw new Error(`Failed to fetch addons: HTTP ${n.status}`);const l=await n.json();this.addons=this.transformAddonsApiData(l),this.isLoadingAddons=!1,this.addonsLoadError=null,this.render()}catch(o){console.error("Error loading addons:",o),this.addonsLoadError=o.message,this.isLoadingAddons=!1,this.addons=[],this.render()}}}transformAddonsApiData(e){return console.log("[Checkout WebComponent] transformAddonsApiData"),Array.isArray(e)?e.map(t=>{var o,i;return{id:t.addonPriceId,addonId:t.addonId,addonPriceId:t.addonPriceId,name:t.externalName||t.name,description:t.description,price:t.price,quantity:t.quantity||1,unitOfMeasurement:t.unitOfMeasurement,period:(i=(o=t.billingPeriod)==null?void 0:o.periodName)==null?void 0:i.toLowerCase(),billingPeriod:t.billingPeriod,currencyCode:t.currencyCode,pricingModel:t.pricingModel,applicability:t.applicability,isPriceIncluded:t.isPriceIncluded,isVisibleInPortal:t.isVisibleInPortal,status:t.status,addonPriceKey:t.addonPriceKey}}):[]}async loadApplicableOffers(){var e,t;if(console.log("[Checkout WebComponent] loadApplicableOffers"),!((e=this.selectedPlan)!=null&&e.ratePlanPriceId)){console.warn("No ratePlanPriceId available to load offers"),this.availableDiscounts=[];return}if(this.preview){this.availableDiscounts=[],this.isLoadingOffers=!1,this.render();return}this.isLoadingOffers=!0,this.offersLoadError=null,this.render();try{const i=`${((t=window.ApiConfig)==null?void 0:t.baseUrl)||f.baseUrl}/applicable-offers`,a=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey},body:JSON.stringify({ratePlanPriceId:this.selectedPlan.ratePlanPriceId})});if(!a.ok)throw new Error(`Failed to fetch applicable offers: HTTP ${a.status}`);const n=await a.json();this.availableDiscounts=n.map(l=>{var d;return{id:l.id,name:l.externalName||l.name,description:l.description,type:l.discountType==="Percentage"?"percentage":"fixed",value:l.amount,code:((d=l.code)==null?void 0:d.trim())||`OFFER${l.id.slice(-8).toUpperCase()}`,apiData:{tenantId:l.tenantId,applyOn:l.applyOn,discountDurationType:l.discountDurationType,expiryDate:l.expiryDate,maxRedemptionCount:l.maxRedemptionCount,maxRedemptionCountPerCustomer:l.maxRedemptionCountPerCustomer,minimumPurchaseAmount:l.minimumPurchaseAmount,status:l.status}}}).filter(l=>l.apiData.status==="Active"),this.isLoadingOffers=!1,this.offersLoadError=null}catch(o){console.error("Error loading applicable offers:",o),this.isLoadingOffers=!1,this.offersLoadError=o.message,this.availableDiscounts=[]}this.render()}async loadOrderEstimate(){var t;console.log("[Checkout WebComponent] loadOrderEstimate"),this.estimateRequestId+=1;const e=this.estimateRequestId;if(this.isLoadingEstimate=!0,this.estimateError=null,this.orderEstimate=null,this.render(),this.preview){this.orderEstimate={subtotal:99.99,tax:9.99,total:109.98,currency:"USD",items:[]},this.isLoadingEstimate=!1,this.render();return}try{const i=`${((t=window.ApiConfig)==null?void 0:t.baseUrl)||f.baseUrl}/orders/estimate`,a=this.buildEstimateRequestBody(),n=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey},body:JSON.stringify(a)});if(e!==this.estimateRequestId)return;if(!n.ok)throw new Error(`Failed to fetch order estimate: HTTP ${n.status}`);const l=await n.json();console.log("Order estimate received:",l),e===this.estimateRequestId&&(this.orderEstimate=l,this.isLoadingEstimate=!1,this.estimateError=null)}catch(o){e===this.estimateRequestId&&(console.error("Error loading order estimate:",o),this.isLoadingEstimate=!1,this.estimateError=o.message,this.orderEstimate=null)}e===this.estimateRequestId&&this.render()}buildEstimateRequestBody(){var i;console.log("[Checkout WebComponent] buildEstimateRequestBody");const e=[],t=new Date().toISOString().split("T")[0];return this.selectedPlan&&(e.push({itemType:"Rate Plan",itemId:this.selectedPlan.ratePlanPriceId,quantity:1,options:{startDate:t,billingCycle:1,autoRenew:!1,autoCollect:!1,invoiceGenerationPreference:"Immediately"}}),this.selectedAddons.forEach(a=>{const n=this.addons.find(l=>l.id===a);n&&e.push({itemType:"Addon",itemId:n.addonPriceId,quantity:this.addonQuantities.get(a)||1,options:{ratePlanPriceId:this.selectedPlan.ratePlanPriceId}})})),this.selectedDiscount&&e.push({itemType:"Discount",itemId:this.selectedDiscount.id,quantity:1}),console.log("Applied coupon is:",this.appliedCoupon),this.appliedCoupon&&e.push({itemType:"Coupon",itemId:this.appliedCoupon.code,quantity:1,options:{startDate:t}}),{srcSysCode:"Website",eventType:"NEW SUBSCRIPTION",currency:(i=this.selectedPlan)==null?void 0:i.currencyCode,scheduleDate:t,cart:e,personalInfo:{}}}buildPlaceOrderRequestBody(e){console.log("[Checkout WebComponent] buildPlaceOrderRequestBody");const t=this.buildEstimateRequestBody();return t.personalInfo={accountId:e},t}async placeOrder(e){var t,o;if(console.log("[Checkout WebComponent] placeOrder"),this.orderCreated)return console.log("Order already created, skipping duplicate creation"),this.createdOrder;if(this.isCreatingOrder){console.log("Order creation in progress, skipping duplicate request");return}if(this.preview){const i={orderId:"preview-order-id",orderNumber:"ORD-PREVIEW-001",accountId:e,status:"Draft",totalAmount:((t=this.orderEstimate)==null?void 0:t.total)||0};return this.createdOrder=i,this.orderCreated=!0,i}try{this.isCreatingOrder=!0;const a=`${((o=window.ApiConfig)==null?void 0:o.baseUrl)||f.baseUrl}/orders/place`,n=this.buildPlaceOrderRequestBody(e);console.log("Placing order with request body:",n);const l=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey},body:JSON.stringify(n)});if(!l.ok)throw new Error(`Failed to place order: HTTP ${l.status}`);const d=await l.json();return console.log("Order placed successfully:",d),this.createdOrder=d,this.orderCreated=!0,this.isCreatingOrder=!1,d}catch(i){throw console.error("Error placing order:",i),this.isCreatingOrder=!1,i}}async getOrderInvoices(e){var t,o;if(console.log("[Checkout WebComponent] getOrderInvoices"),!e){console.error("Order ID is required to fetch invoices");return}if(this.isLoadingInvoices){console.log("Invoices loading in progress, skipping duplicate request");return}if(this.preview)return this.orderInvoices=[{invoiceId:"preview-invoice-id",invoiceNumber:"INV-PREVIEW-001",amount:((t=this.orderEstimate)==null?void 0:t.total)||109.98,status:"Posted"}],this.isLoadingInvoices=!1,this.render(),this.orderInvoices;try{this.isLoadingInvoices=!0;const i=((o=window.ApiConfig)==null?void 0:o.baseUrl)||f.baseUrl,a=encodeURIComponent(JSON.stringify({where:{status:"Posted",orderId:e}})),n=`${i}/invoices?filter=${a}`;console.log("Fetching invoices for order:",e);const l=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey}});if(!l.ok)throw new Error(`Failed to fetch invoices: HTTP ${l.status}`);const d=await l.json();return console.log("Invoices fetched successfully:",d),this.orderInvoices=d,this.isLoadingInvoices=!1,d}catch(i){throw console.error("Error fetching invoices:",i),this.isLoadingInvoices=!1,this.orderInvoices=[],i}}async updateAccount(e){var t,o,i;console.log("[Checkout WebComponent] updateAccount");try{const n=`${((t=window.ApiConfig)==null?void 0:t.baseUrl)||f.baseUrl}/accounts/${e}`,l={accountType:this.personalDetails.company&&this.personalDetails.company.trim()?"Organisation":"Individual",name:this.personalDetails.company&&this.personalDetails.company.trim()?this.personalDetails.company.trim():`${this.personalDetails.firstName} ${this.personalDetails.lastName}`.trim(),country:this.personalDetails.address.country,address:this.personalDetails.address.addressLine,state:this.personalDetails.address.state,city:this.personalDetails.address.city,zipCode:this.personalDetails.address.zipCode,phone:this.personalDetails.phone,email:this.personalDetails.email,sameAsSoldTo:!1},d=await fetch(n,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey},body:JSON.stringify(l)});if(!d.ok)throw new Error(`Failed to update account: HTTP ${d.status}`);let c;return d.status===204?(console.log("Customer account updated successfully (204 No Content)"),c={...this.existingAccount,accountId:e,name:l.name,country:l.country,address:l.address,state:l.state,city:l.city,zipCode:l.zipCode,phone:l.phone,email:l.email,accountType:l.accountType,communicationProfile:this.existingAccount.communicationProfile}):(c=await d.json(),console.log("Customer account updated:",c)),l.accountType==="Organisation"&&((i=(o=this.existingAccount)==null?void 0:o.communicationProfile)!=null&&i.contactId)&&await this.updateContact(e,this.existingAccount.communicationProfile.contactId),c}catch(a){throw console.error("Error updating account:",a),a}}async updateContact(e,t){var o,i,a,n,l;console.log("[Checkout WebComponent] updateContact");try{const c=`${((o=window.ApiConfig)==null?void 0:o.baseUrl)||f.baseUrl}/accounts/${e}/contacts/${t}`,s={fullName:`${this.personalDetails.firstName} ${this.personalDetails.lastName}`.trim(),country:this.personalDetails.address.country,email:this.personalDetails.email,address:this.personalDetails.address.addressLine,billNotification:(a=(i=this.existingAccount)==null?void 0:i.communicationProfile)==null?void 0:a.billNotification,accountNotification:(l=(n=this.existingAccount)==null?void 0:n.communicationProfile)==null?void 0:l.accountNotification,phone:this.personalDetails.phone};console.log("Updating contact:",t,s);const p=await fetch(c,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey},body:JSON.stringify(s)});if(!p.ok)throw new Error(`Failed to update contact: HTTP ${p.status}`);if(p.status===204)return console.log("Contact updated successfully (204 No Content)"),{success:!0};const m=await p.json();return console.log("Contact updated:",m),m}catch(d){throw console.error("Error updating contact:",d),d}}async createCustomerAccount(){var e;if(console.log("[Checkout WebComponent] createCustomerAccount"),this.preview)return{accountId:"preview-account-id",id:"preview-account-id",name:this.personalDetails.company||`${this.personalDetails.firstName} ${this.personalDetails.lastName}`,email:this.personalDetails.email};try{if(this.existingAccount&&this.existingAccount.accountId){console.log("Updating existing Draft account:",this.existingAccount);const l=await this.updateAccount(this.existingAccount.accountId);return this.createdAccountId=l.id||l.accountId,l}const o=`${((e=window.ApiConfig)==null?void 0:e.baseUrl)||f.baseUrl}/accounts`,i={accountType:this.personalDetails.company&&this.personalDetails.company.trim()?"Organisation":"Individual",name:this.personalDetails.company&&this.personalDetails.company.trim()?this.personalDetails.company.trim():`${this.personalDetails.firstName} ${this.personalDetails.lastName}`.trim(),country:this.personalDetails.address.country,address:this.personalDetails.address.addressLine,state:this.personalDetails.address.state,city:this.personalDetails.address.city,zipCode:this.personalDetails.address.zipCode,phone:this.personalDetails.phone,email:this.personalDetails.email,sameAsSoldTo:!1,communicationProfile:{fullName:`${this.personalDetails.firstName} ${this.personalDetails.lastName}`.trim(),address:this.personalDetails.address.addressLine,country:this.personalDetails.address.country,phone:this.personalDetails.phone,email:this.personalDetails.email}},a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey},body:JSON.stringify(i)});if(!a.ok)throw new Error(`Failed to create customer account: HTTP ${a.status}`);const n=await a.json();return console.log("Customer account created:",n),this.createdAccountId=n.accountId,n}catch(t){throw console.error("Error creating customer account:",t),t}}async checkExistingAccount(e){var t;if(console.log("[Checkout WebComponent] checkExistingAccount"),this.preview)return null;try{const i=`${((t=window.ApiConfig)==null?void 0:t.baseUrl)||f.baseUrl}/accounts?filter=${encodeURIComponent(JSON.stringify({where:{email:e}}))}`,a=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey}});if(!a.ok)throw new Error(`Failed to check existing account: HTTP ${a.status}`);const n=await a.json();return console.log("Existing account check result:",n),n.accounts&&n.accounts.length>0?n.accounts[0]:null}catch(o){return console.error("Error checking existing account:",o),null}}async handleEmailCheck(e){if(console.log("[Checkout WebComponent] handleEmailCheck"),console.log("Checking email:",e),this.isCheckingExistingAccount){console.log("Already checking, skipping...");return}this.isCheckingExistingAccount=!0,this.existingAccount=null,this.hideExistingAccountMessage(),delete this.formErrors.email,this.updateFieldError("email");try{const t=await this.checkExistingAccount(e);console.log("Found existing account:",t),t&&t.accountId?t.status==="Active"?(console.log("Account is Active, showing error"),this.formErrors.email="Email ID is already associated with another account, please use another email ID",this.updateFieldError("email"),this.updateNextButtonState()):t.status==="Draft"&&(console.log("Account is Draft, prefilling details"),t&&(this.existingAccount=t,this.showExistingAccountMessage(t),await this.prefillAccountDetails(t))):(console.log("No existing account found"),this.hideExistingAccountMessage())}catch(t){console.error("Error during email check:",t)}finally{this.isCheckingExistingAccount=!1}}async prefillAccountDetails(e){console.log("[Checkout WebComponent] prefillAccountDetails"),console.log("Prefilling account details:",e),console.log("Current personal details before prefill:",this.personalDetails);const t=this.personalDetails.email;if(this.personalDetails={firstName:"",lastName:"",email:t,phone:"",company:"",address:{addressLine:"",city:"",state:"",zipCode:"",country:""}},e.accountType==="Organisation"){if(console.log("Organisation account detected"),this.personalDetails.company=e.name,console.log("Prefilled company:",this.personalDetails.company),e.communicationProfile&&e.communicationProfile.fullName){const o=e.communicationProfile.fullName.split(" ").filter(i=>i.trim());o.length>=1&&(this.personalDetails.firstName=o[0],console.log("Prefilled firstName from communicationProfile:",this.personalDetails.firstName)),o.length>=2&&(this.personalDetails.lastName=o.slice(1).join(" "),console.log("Prefilled lastName from communicationProfile:",this.personalDetails.lastName))}}else if(console.log("Individual account detected"),e.name){const o=e.name.split(" ").filter(i=>i.trim());o.length>=1&&(this.personalDetails.firstName=o[0],console.log("Prefilled firstName:",this.personalDetails.firstName)),o.length>=2&&(this.personalDetails.lastName=o.slice(1).join(" "),console.log("Prefilled lastName:",this.personalDetails.lastName))}e.phone&&(this.personalDetails.phone=e.phone,console.log("Prefilled phone:",this.personalDetails.phone)),e.address&&(this.personalDetails.address.addressLine=e.address,console.log("Prefilled addressLine:",this.personalDetails.address.addressLine)),e.city&&(this.personalDetails.address.city=e.city,console.log("Prefilled city:",this.personalDetails.address.city)),e.state&&(this.personalDetails.address.state=e.state,console.log("Prefilled state:",this.personalDetails.address.state)),e.zipCode&&(this.personalDetails.address.zipCode=e.zipCode,console.log("Prefilled zipCode:",this.personalDetails.address.zipCode)),e.country&&(this.personalDetails.address.country=e.country,console.log("Prefilled country:",this.personalDetails.address.country)),console.log("Personal details after prefill:",this.personalDetails),this.render(),this.updateNextButtonState()}showExistingAccountMessage(e){console.log("[Checkout WebComponent] showExistingAccountMessage");const t=this.shadowRoot.querySelector('[data-field="email"]');if(t){let o=this.shadowRoot.querySelector(".existing-account-message");o||(o=document.createElement("div"),o.className="existing-account-message",t.parentNode.appendChild(o)),o.innerHTML=`
        <div style="margin-top: 8px; padding: 12px; background-color: #e3f2fd; border-left: 4px solid #2196f3; border-radius: 4px; font-size: 14px; color: #1976d2;">
          ✓ We found an existing account for this email: <strong>${e.name||e.email}</strong>
          <br><small>We've prefilled your information from your existing account.</small>
        </div>
      `}}hideExistingAccountMessage(){console.log("[Checkout WebComponent] hideExistingAccountMessage");const e=this.shadowRoot.querySelector(".existing-account-message");e&&e.remove()}setupEventListeners(){console.log("[Checkout WebComponent] setupEventListeners"),this.handleEscapeKey=e=>{e.key==="Escape"&&this.isVisible&&this.close()},document.addEventListener("keydown",this.handleEscapeKey)}open(e){console.log("[Checkout WebComponent] open"),e!==void 0&&(this.selectedPlan=e),this.selectedAddons.clear(),this.couponCode="",this.appliedCoupon=null,this.selectedDiscount=null,this.availableDiscounts=[],this.currentModalStep="plan-selection",this.formErrors={},this.isVisible=!0,this.render(),document.body.style.overflow="hidden",setTimeout(()=>{const t=this.shadowRoot.querySelector(".modal-overlay");t&&this.isVisible&&(t.classList.add("fade-in"),setTimeout(()=>{t&&this.isVisible&&t.classList.add("show")},10))},10)}close(){if(console.log("[Checkout WebComponent] close"),!this.isVisible)return;this.updateTimeout&&(clearTimeout(this.updateTimeout),this.updateTimeout=null),this.selectedAddons.clear(),this.addonQuantities.clear();const e=this.shadowRoot.querySelector(".modal-overlay");if(e)e.classList.remove("show"),setTimeout(()=>{if(e){e.classList.remove("fade-in","visible"),this.isVisible=!1,document.body.style.overflow="";const t=new CustomEvent("modal-closed",{bubbles:!0});this.dispatchEvent(t)}},300);else{this.isVisible=!1,document.body.style.overflow="";const t=new CustomEvent("modal-closed",{bubbles:!0});this.dispatchEvent(t)}}disconnectedCallback(){console.log("[Checkout WebComponent] disconnectedCallback"),this.updateTimeout&&(clearTimeout(this.updateTimeout),this.updateTimeout=null),this.handleEscapeKey&&(document.removeEventListener("keydown",this.handleEscapeKey),this.handleEscapeKey=null),document.body.style.overflow=""}toggleAddon(e){console.log("[Checkout WebComponent] toggleAddon"),this.selectedAddons.has(e)?(this.selectedAddons.delete(e),this.addonQuantities.delete(e)):(this.selectedAddons.add(e),this.addonQuantities.set(e,1)),this.updateOrderSummary()}handleAddonQuantityChange(e,t){console.log("[Checkout WebComponent] handleAddonQuantityChange");const o=parseInt(t,10),i=this.shadowRoot.querySelector(`#addon-qty-${e}`);isNaN(o)||o<1?(this.addonQuantities.set(e,1),i&&(i.value=1,i.style.borderColor="#ff6b6b",setTimeout(()=>{i.style.borderColor=""},1500))):o>999?(this.addonQuantities.set(e,999),i&&(i.value=999,i.style.borderColor="#ff6b6b",setTimeout(()=>{i.style.borderColor=""},1500))):(this.addonQuantities.set(e,o),i&&(i.style.borderColor="")),this.updateOrderSummary()}updateOrderSummary(){console.log("[Checkout WebComponent] updateOrderSummary"),this.updateTimeout&&clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout(()=>{this.loadOrderEstimate()},300)}calculateTotal(){console.log("[Checkout WebComponent] calculateTotal");let e=this.selectedPlan?this.selectedPlan.price:0;return this.selectedAddons.forEach(t=>{const o=this.addons.find(i=>i.id===t);o&&(e+=o.price)}),e}calculateDiscountedTotal(){console.log("[Checkout WebComponent] calculateDiscountedTotal");let e=this.calculateTotal(),t=0;return this.appliedCoupon&&(this.appliedCoupon.type==="percentage"?t+=e*this.appliedCoupon.value/100:this.appliedCoupon.type==="fixed"&&(t+=this.appliedCoupon.value)),this.selectedDiscount&&(this.selectedDiscount.type==="percentage"?t+=e*this.selectedDiscount.value/100:this.selectedDiscount.type==="fixed"&&(t+=this.selectedDiscount.value)),Math.max(0,e-t)}getTotalDiscount(){console.log("[Checkout WebComponent] getTotalDiscount");const e=this.calculateTotal(),t=this.calculateDiscountedTotal();return e-t}applyCouponCode(){console.log("[Checkout WebComponent] applyCouponCode");const e=this.couponCode.trim();e&&(this.appliedCoupon={code:e,name:`Coupon: ${e}`},this.showMessage("Coupon applied successfully!","success"),this.updateOrderSummary())}removeCoupon(){console.log("[Checkout WebComponent] removeCoupon"),this.appliedCoupon=null,this.couponCode="",this.updateOrderSummary()}selectDiscount(e){var t;console.log("[Checkout WebComponent] selectDiscount"),((t=this.selectedDiscount)==null?void 0:t.id)===e?this.selectedDiscount=null:this.selectedDiscount=this.availableDiscounts.find(o=>o.id===e),this.updateOrderSummary()}removeDiscount(e){var t;console.log("[Checkout WebComponent] removeDiscount"),((t=this.selectedDiscount)==null?void 0:t.id)===e&&(this.selectedDiscount=null,this.updateOrderSummary())}showMessage(e,t="info"){console.log("[Checkout WebComponent] showMessage");const o=this.shadowRoot.querySelector(".coupon-message");o&&(o.textContent=e,o.className=`coupon-message ${t}`,o.style.display="block",setTimeout(()=>{o.style.display="none"},3e3))}proceedToPersonalDetails(){console.log("[Checkout WebComponent] proceedToPersonalDetails"),this.currentModalStep="personal-details",this.render()}goBackToPlanSelection(){console.log("[Checkout WebComponent] goBackToPlanSelection"),this.currentModalStep="plan-selection",this.render()}proceedToPaymentMethod(){console.log("[Checkout WebComponent] proceedToPaymentMethod"),this.currentModalStep="payment-method",this.render()}goBackToPersonalDetails(){console.log("[Checkout WebComponent] goBackToPersonalDetails"),this.currentModalStep="personal-details",this.render()}selectPaymentMethod(e){console.log("[Checkout WebComponent] selectPaymentMethod"),this.selectedPaymentMethod=e,this.render()}validatePersonalDetails(){if(console.log("[Checkout WebComponent] validatePersonalDetails"),this.preview)return{};const e={},{personalDetails:t}=this;return t.firstName.trim()||(e.firstName="First name is required"),t.lastName.trim()||(e.lastName="Last name is required"),t.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)||(e.email="Please enter a valid email address"):e.email="Email is required",t.phone.trim()||(e.phone="Phone number is required"),t.address.addressLine.trim()||(e.addressLine="Address line is required"),t.address.city.trim()||(e.city="City is required"),t.address.state.trim()||(e.state="State/Province is required"),t.address.zipCode.trim()||(e.zipCode="ZIP/Postal code is required"),t.address.country.trim()||(e.country="Country is required"),e}isPersonalDetailsFormValid(){if(console.log("[Checkout WebComponent] isPersonalDetailsFormValid"),this.preview)return!0;if(Object.keys(this.formErrors).length>0)return!1;const{personalDetails:e}=this,t=e.firstName.trim()&&e.lastName.trim()&&e.email.trim()&&e.phone.trim()&&e.address.addressLine.trim()&&e.address.city.trim()&&e.address.state.trim()&&e.address.zipCode.trim()&&e.address.country.trim(),o=e.email.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email);return t&&o}validatePaymentDetails(){if(console.log("[Checkout WebComponent] validatePaymentDetails"),this.preview)return{};const e={};if(!this.selectedPaymentMethod)return e.paymentMethod="Please select a payment method",e;switch(this.selectedPaymentMethod){case"card":this.cashfreeComponents.cardNumber&&this.cashfreeComponents.cardHolder&&this.cashfreeComponents.cardExpiry&&this.cashfreeComponents.cardCvv?(this.cashfreeComponents.cardHolder.isComplete()||(e.cardholderName="Cardholder name is required"),this.cashfreeComponents.cardNumber.isComplete()||(e.cardNumber="Please enter a valid card number"),this.cashfreeComponents.cardExpiry.isComplete()||(e.expiryDate="Please enter a valid expiry date"),this.cashfreeComponents.cardCvv.isComplete()||(e.cvv="Please enter a valid CVV")):e.cardForm="Payment form is not properly initialized. Please refresh and try again.";break;case"upi":this.cashfreeComponents.upiCollect?this.cashfreeComponents.upiCollect.isComplete()||(e.upiId="Please enter a valid UPI ID"):e.upiForm="UPI form is not properly initialized. Please refresh and try again.";break;case"netbanking":this.paymentDetails.netbanking.bankName.trim()||(e.bankName="Please select a bank");break;case"wallet":this.cashfreeComponents.wallets&&this.cashfreeComponents.wallets.size>0?(!this.paymentDetails.wallet.selectedProvider||!this.paymentDetails.wallet.isValid)&&(e.walletType="Please select a wallet to proceed"):e.walletForm="Wallet options are not properly initialized. Please refresh and try again.";break}return e}handleInputChange(e,t){if(console.log("[Checkout WebComponent] handleInputChange"),e.startsWith("address.")){const o=e.replace("address.","");this.personalDetails.address[o]=t}else if(e.startsWith("payment.")){const[,o,i]=e.split(".");this.paymentDetails[o]&&(this.paymentDetails[o][i]=t)}else this.personalDetails[e]=t;delete this.formErrors[e],this.updateFieldError(e),this.updateNextButtonState()}updateNextButtonState(){if(console.log("[Checkout WebComponent] updateNextButtonState"),this.currentModalStep==="personal-details"){const e=this.shadowRoot.querySelector("#proceedBtn");e&&(this.isPersonalDetailsFormValid()?e.removeAttribute("disabled"):e.setAttribute("disabled",""))}}updateFieldError(e){console.log("[Checkout WebComponent] updateFieldError");let t=e;if(e.startsWith("address.")&&(t=e.replace("address.","")),e.startsWith("payment.")){const a=e.split(".");a.length===3&&(t=a[2])}const o=this.shadowRoot.querySelector(`[data-error="${t}"]`);o&&(this.formErrors[e]?(o.textContent=this.formErrors[e],o.style.display="block"):(o.textContent="",o.style.display="none"));const i=this.shadowRoot.querySelector(`[data-field="${e}"]`);i&&(this.formErrors[e]?i.classList.add("error"):i.classList.remove("error"))}showFormErrors(e){console.log("[Checkout WebComponent] showFormErrors"),this.formErrors=e,Object.keys(e).forEach(t=>{const o=this.shadowRoot.querySelector(`[data-error="${t}"]`);let i=t;["addressLine","city","state","zipCode","country"].includes(t)&&(i=`address.${t}`),["cardholderName","cardNumber","expiryDate","cvv"].includes(t)?i=`payment.card.${t}`:t==="upiId"?i=`payment.upi.${t}`:["walletType","walletNumber"].includes(t)?i=`payment.wallet.${t}`:t==="bankName"&&(i=`payment.netbanking.${t}`);const a=this.shadowRoot.querySelector(`[data-field="${i}"]`);o&&(o.textContent=e[t],o.style.display="block"),a&&a.classList.add("error")})}proceedToCheckout(){var e,t;if(console.log("[Checkout WebComponent] proceedToCheckout"),this.currentModalStep==="plan-selection"){this.proceedToPersonalDetails();return}if(this.currentModalStep==="personal-details"){const o=this.validatePersonalDetails();if(Object.keys(o).length>0){this.showFormErrors(o);return}if(this.preview){this.proceedToPaymentMethod();return}this.createCustomerAccount().then(i=>{console.log("Account created successfully, now placing order");const a=i.id||i.accountId||this.createdAccountId;if(!a)throw new Error("Account ID not found in account creation response");return this.placeOrder(a)}).then(i=>{console.log("Order placed successfully, now fetching invoices");const a=i.cart&&i.cart[0]&&i.cart[0].orderId;return a?this.getOrderInvoices(a).then(n=>(console.log("Invoices fetched, proceeding to payment"),{order:i,invoices:n})).catch(n=>(console.warn("Failed to fetch invoices, but continuing with payment:",n),{order:i,invoices:[]})):(console.warn("Order ID not found in response, skipping invoice fetch"),i)}).then(i=>{const{order:a,invoices:n}=i;console.log("Order and invoices ready, proceeding to payment"),this.orderData={...this.orderData,placedOrder:a,orderInvoices:n||[],accountId:a.accountId||this.createdAccountId},this.proceedToPaymentMethod()}).catch(i=>{console.error("Failed to process account and order:",i);let a="Failed to process your request. Please try again.";i.message&&i.message.includes("contact")?a="Failed to update contact information. Please check your details and try again.":i.message&&i.message.includes("account")?a="Failed to create account. Please check your details and try again.":i.message&&i.message.includes("order")&&(a="Failed to create order. Please try again."),alert(a)});return}if(this.currentModalStep==="payment-method"){const o=this.validatePaymentDetails();if(Object.keys(o).length>0){this.showFormErrors(o);return}if(this.preview){this.orderData={selectedPlan:this.selectedPlan||{name:"Premium Plan",period:"month",price:99.99},selectedAddons:Array.from(this.selectedAddons).map(i=>this.addons.find(n=>n.id===i)||{name:"Sample Add-on",price:10}),personalDetails:this.personalDetails,paymentMethod:this.selectedPaymentMethod||"card",originalTotal:((e=this.orderEstimate)==null?void 0:e.subtotal)||99.99,totalDiscount:0,total:((t=this.orderEstimate)==null?void 0:t.total)||99.99},this.currentModalStep="order-confirmation",this.render();return}this.initiatePayment()}}async initiatePayment(){console.log("[Checkout WebComponent] initiatePayment");try{const e=this.getPaymentSessionId();if(!e){alert("Payment session not found. Please try again.");return}if(console.log("Initiating payment with session ID:",e),console.log("Selected payment method:",this.selectedPaymentMethod),!this.cashfreeInstance){alert("Payment system not ready. Please refresh and try again.");return}switch(this.selectedPaymentMethod){case"card":await this.payViaCard(e);break;case"upi":await this.payViaUpi(e);break;case"wallet":await this.payViaWallet(e);break;case"netbanking":await this.payViaNetbanking(e);break;default:console.error("Unsupported payment method:",this.selectedPaymentMethod),alert("Selected payment method is not supported.")}}catch(e){console.error("Payment initiation failed:",e),alert("Failed to initiate payment. Please try again.")}}getPaymentSessionId(){console.log("[Checkout WebComponent] getPaymentSessionId");const e=this.orderInvoices.invoices;return e&&e.length>0&&e[0].pgPaymentSessionId?e[0].pgPaymentSessionId:(console.error("Payment session ID not found in invoices:",this.orderInvoices),null)}async payViaCard(e){if(console.log("[Checkout WebComponent] payViaCard"),!this.cashfreeComponents.cardNumber||!this.cashfreeComponents.cardHolder||!this.cashfreeComponents.cardExpiry||!this.cashfreeComponents.cardCvv){console.error("Card components not ready"),alert("Card payment form not ready. Please try again.");return}try{console.log("Processing card payment...");const t={paymentMethod:this.cashfreeComponents.cardNumber,paymentSessionId:e},o=await this.cashfreeInstance.pay(t);console.log("Card payment result:",o),this.handlePaymentResult(o)}catch(t){console.error("Card payment failed:",t),alert("Card payment failed. Please check your details and try again.")}}async payViaUpi(e){if(console.log("[Checkout WebComponent] payViaUpi"),!this.cashfreeComponents.upiCollect){console.error("UPI component not ready"),alert("UPI payment form not ready. Please try again.");return}try{console.log("Processing UPI payment...");const t={paymentMethod:this.cashfreeComponents.upiCollect,paymentSessionId:e},o=await this.cashfreeInstance.pay(t);console.log("UPI payment result:",o),this.handlePaymentResult(o)}catch(t){console.error("UPI payment failed:",t),alert("UPI payment failed. Please check your UPI ID and try again.")}}async payViaWallet(e){console.log("[Checkout WebComponent] payViaWallet");const t=this.paymentDetails.wallet.selectedProvider,o=this.paymentDetails.wallet.selectedComponent;if(!t||!o){console.error("Wallet not selected or component not ready"),alert("Please select a wallet to proceed with payment.");return}try{console.log(`Processing ${t} wallet payment...`);const i={paymentMethod:o,paymentSessionId:e},a=await this.cashfreeInstance.pay(i);this.handlePaymentResult(a)}catch(i){console.error("Wallet payment failed:",i),alert(`${t} payment failed. Please try again.`)}}async payViaNetbanking(e){console.log("[Checkout WebComponent] payViaNetbanking");try{console.log("Processing netbanking payment..."),this.cashfreeInstance.checkout({paymentSessionId:e,redirectTarget:"_self"})}catch(t){console.error("Netbanking payment failed:",t),alert("Netbanking payment failed. Please try again.")}}handlePaymentResult(e){if(console.log("[Checkout WebComponent] handlePaymentResult"),console.log("Payment result:",e),e.error){console.error("Payment failed:",e.error),alert(`Payment failed: ${e.error.message||"Unknown error"}`);return}if(e.redirect){console.log("Redirecting to complete payment...");return}e.paymentDetails&&(console.log("Payment completed successfully"),this.orderData={...this.orderData,paymentResult:e.paymentDetails,selectedPaymentMethod:this.selectedPaymentMethod},this.currentModalStep="order-confirmation",this.render())}render(){console.log("[Checkout WebComponent] render"),this.shadowRoot.innerHTML=`
      ${this.getStyles()}
      <div class="full-page-container">
        <div class="page-header">
          <div class="page-header-content">
            <h2>${this.getModalTitle()}</h2>
          </div>
        </div>

        ${this.renderProgressStepper()}

        <div class="page-content">
          ${this.renderModalContent()}
          </div>
        </div>
      </div>
    `,this.setupModalEventListeners()}getModalTitle(){switch(console.log("[Checkout WebComponent] getModalTitle"),this.currentModalStep){case"plan-selection":return"Customize Your Plan";case"personal-details":return"Personal Details";case"payment-method":return"Payment Method";case"order-confirmation":return"Order Confirmation";default:return"Checkout"}}renderProgressStepper(){console.log("[Checkout WebComponent] renderProgressStepper");const e=[{key:"plan-selection",label:"Plan Selection",icon:"1"},{key:"personal-details",label:"Personal Details",icon:"2"},{key:"payment-method",label:"Payment Method",icon:"3"},{key:"order-confirmation",label:"Confirmation",icon:"✓"}];return`
      <div class="progress-indicator">
        <div class="progress-steps">
          ${e.map((t,o)=>`
            <div class="progress-step ${this.getStepStatus(t.key)}">
              <div class="step-icon">${t.icon}</div>
              <div class="step-label">${t.label}</div>
            </div>
            ${o<e.length-1?'<div class="step-connector"></div>':""}
          `).join("")}
        </div>
      </div>
    `}getStepStatus(e){console.log("[Checkout WebComponent] getStepStatus");const t=["plan-selection","personal-details","payment-method","order-confirmation"],o=t.indexOf(this.currentModalStep),i=t.indexOf(e);return i<o?"completed":i===o?"active":"upcoming"}renderModalContent(){switch(console.log("[Checkout WebComponent] renderModalContent"),this.currentModalStep){case"plan-selection":return this.renderPlanSelectionContent();case"personal-details":return this.renderPersonalDetailsContent();case"payment-method":return this.renderPaymentMethodContent();case"order-confirmation":return this.renderOrderConfirmation()}}renderPlanSelectionContent(){return console.log("[Checkout WebComponent] renderPlanSelectionContent"),`
      <div class="page-body">
        <div class="plan-section">
          ${this.renderSelectedPlan()}
        </div>
        
        <div class="addons-section">
          <h3>Available Add-ons</h3>
          ${this.renderAddonsContent()}
        </div>

      </div>
      
      <div class="page-sidebar">
        <div class="order-summary">
          <div class="order-summary-content">
            <h3>Order Summary</h3>
            <div class="order-summary-details">
              ${this.renderOrderSummary()}
            </div>
            
            <div class="coupon-section">
              <div class="coupon-input-group">
              <div class="form-group">
                <input type="text" id="couponInput" placeholder="Enter coupon code" value="${this.couponCode}">
                </div>
                <button class="btn btn-primary" id="applyCouponBtn">Apply</button>
              </div>
              ${this.getCouponStatusMessage()}
              ${this.isSuccessfullyAppliedCoupon()?`
                <div class="applied-coupon">
                  <span class="coupon-name">${this.getAppliedCouponName()}</span>
                  <button class="btn btn-icon remove-coupon-btn" id="removeCouponBtn">×</button>
                </div>
              `:""}
            </div>
            
            <div class="available-discounts-section">
              <h4>Available Discounts</h4>
              <div class="available-discounts-grid">
                ${this.isLoadingOffers?`
                  <div class="loading-offers">
                    <div class="spinner"></div>
                    <span>Loading offers...</span>
                  </div>
                `:this.offersLoadError?`
                  <div class="offers-error">
                    <p>Unable to load offers at this time.</p>
                  </div>
                `:this.availableDiscounts.length===0?`
                  <p class="no-offers">No offers available for this plan.</p>
                `:this.availableDiscounts.map(e=>{var a;const t=((a=this.selectedDiscount)==null?void 0:a.id)===e.id,o=this.isDiscountSuccessfullyApplied(e.id),i=e.type==="percentage"?`${e.value}% off`:`$${e.value} off`;return`
                    <div class="available-discount-card ${t?"selected":""} ${o?"applied":""}" data-discount-id="${e.id}">
                      <div class="available-discount-header">
                        <span class="available-discount-name">${e.name}</span>
                        ${o?`<button class="btn btn-icon remove-discount-btn" data-discount-id="${e.id}" title="Remove discount">×</button>`:`<span class="available-discount-value">${i}</span>`}
                      </div>
                      <p class="available-discount-description">${e.description}</p>
                      ${o?'<span class="discount-applied-badge">✓ Applied</span>':`<span class="available-discount-code">Code: ${e.code}</span>`}
                    </div>
                  `}).join("")}
              </div>
            </div>
          </div>

          <div class="sidebar-footer">
            <button class="btn btn-primary btn-block" id="proceedBtn">
              Next
            </button>
          </div>
        </div>
      </div>
    `}renderPersonalDetailsContent(){return console.log("[Checkout WebComponent] renderPersonalDetailsContent"),`
      <div class="page-body">
        <div class="personal-details-form">
          <h3>Personal Information</h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="firstName">First Name *</label>
              <input type="text" id="firstName" data-field="firstName" 
                     value="${this.personalDetails.firstName}" 
                     placeholder="Enter your first name">
              <div class="field-error" data-error="firstName"></div>
            </div>
            
            <div class="form-group">
              <label for="lastName">Last Name *</label>
              <input type="text" id="lastName" data-field="lastName" 
                     value="${this.personalDetails.lastName}" 
                     placeholder="Enter your last name">
              <div class="field-error" data-error="lastName"></div>
            </div>
            
            <div class="form-group full-width">
              <label for="email">Email Address *</label>
              <input type="email" id="email" data-field="email" 
                     value="${this.personalDetails.email}" 
                     placeholder="Enter your email address">
              <div class="field-error" data-error="email"></div>
            </div>
            
            <div class="form-group">
              <label for="phone">Phone Number *</label>
              <input type="tel" id="phone" data-field="phone" 
                     value="${this.personalDetails.phone}" 
                     placeholder="Enter your phone number">
              <div class="field-error" data-error="phone"></div>
            </div>
            
            <div class="form-group">
              <label for="company">Company (Optional)</label>
              <input type="text" id="company" data-field="company" 
                     value="${this.personalDetails.company}" 
                     placeholder="Enter company name">
            </div>
          </div>

          <h3>Billing Address</h3>
          <div class="form-grid">
            <div class="form-group full-width">
              <label for="addressLine">Address Line*</label>
              <input type="text" id="addressLine" data-field="address.addressLine" 
                     value="${this.personalDetails.address.addressLine}" 
                     placeholder="Enter your address">
              <div class="field-error" data-error="addressLine"></div>
            </div>
            
            <div class="form-group">
              <label for="city">City *</label>
              <input type="text" id="city" data-field="address.city" 
                     value="${this.personalDetails.address.city}" 
                     placeholder="Enter your city">
              <div class="field-error" data-error="city"></div>
            </div>
            
            <div class="form-group">
              <label for="state">State/Province *</label>
              <input type="text" id="state" data-field="address.state" 
                     value="${this.personalDetails.address.state}" 
                     placeholder="Enter state/province">
              <div class="field-error" data-error="state"></div>
            </div>
            
            <div class="form-group">
              <label for="zipCode">ZIP/Postal Code *</label>
              <input type="text" id="zipCode" data-field="address.zipCode" 
                     value="${this.personalDetails.address.zipCode}" 
                     placeholder="Enter ZIP/postal code">
              <div class="field-error" data-error="zipCode"></div>
            </div>
            
            <div class="form-group">
              <label for="country">Country *</label>
              <select id="country" data-field="address.country">
                <option value="">Select Country</option>
                <option value="US" ${this.personalDetails.address.country==="US"?"selected":""}>United States</option>
                <option value="CA" ${this.personalDetails.address.country==="CA"?"selected":""}>Canada</option>
                <option value="GB" ${this.personalDetails.address.country==="GB"?"selected":""}>United Kingdom</option>
                <option value="AU" ${this.personalDetails.address.country==="AU"?"selected":""}>Australia</option>
                <option value="DE" ${this.personalDetails.address.country==="DE"?"selected":""}>Germany</option>
                <option value="FR" ${this.personalDetails.address.country==="FR"?"selected":""}>France</option>
                <option value="IND" ${this.personalDetails.address.country==="IND"?"selected":""}>India</option>
              </select>
              <div class="field-error" data-error="country"></div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="page-sidebar">
        <div class="order-summary">
          <div class="order-summary-content">
            <h3>Order Summary</h3>
            <div class="order-summary-details">
              ${this.renderOrderSummary()}
            </div>
          </div>
          
          <div class="sidebar-footer">
            <div class="form-actions">
              <button class="btn btn-secondary back-btn" id="backBtn">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M10 3L5 8L10 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Back
              </button>
              <button class="btn btn-primary btn-block proceed-btn" id="proceedBtn" ${this.isPersonalDetailsFormValid()?"":"disabled"}>
                Next
              </button>
            </div>
          </div>
        </div>
      </div>
    `}renderPaymentMethodContent(){return console.log("[Checkout WebComponent] renderPaymentMethodContent"),this.selectedPaymentMethod?this.renderPaymentMethodForm():this.renderPaymentMethodSelection()}renderPaymentMethodSelection(){return console.log("[Checkout WebComponent] renderPaymentMethodSelection"),`
      <div class="page-body">
        <div class="payment-method-selection">
          <h3>Choose Payment Method</h3>
          <div class="payment-methods-grid">
            <div class="payment-method-card" data-method="upi">
              <div class="payment-icon">
                <svg width="24" height="24" viewBox="0 0 32 32" fill="none">
                  <rect x="4" y="8" width="24" height="16" rx="3" stroke="#526484" stroke-width="2"/>
                  <path d="M8 16h16M12 12h8" stroke="#526484" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <h4>UPI</h4>
              <p>Google Pay, PhonePe, Paytm</p>
            </div>

            <div class="payment-method-card" data-method="card">
              <div class="payment-icon">
                <svg width="24" height="24" viewBox="0 0 32 32" fill="none">
                  <rect x="4" y="8" width="24" height="16" rx="3" stroke="#526484" stroke-width="2"/>
                  <path d="M4 14h24" stroke="#526484" stroke-width="2"/>
                  <rect x="6" y="18" width="4" height="2" fill="#526484"/>
                </svg>
              </div>
              <h4>Credit/Debit Card</h4>
              <p>Visa, Mastercard, Rupay</p>
            </div>

            <div class="payment-method-card" data-method="wallet">
              <div class="payment-icon">
                <svg width="24" height="24" viewBox="0 0 32 32" fill="none">
                  <rect x="6" y="8" width="20" height="16" rx="2" stroke="#526484" stroke-width="2"/>
                  <circle cx="20" cy="16" r="2" stroke="#526484" stroke-width="2"/>
                  <path d="M6 12h20" stroke="#526484" stroke-width="2"/>
                </svg>
              </div>
              <h4>Digital Wallets</h4>
              <p>Paytm, Amazon Pay, Mobikwik</p>
            </div>

            <div class="payment-method-card" data-method="netbanking">
              <div class="payment-icon">
                <svg width="24" height="24" viewBox="0 0 32 32" fill="none">
                  <rect x="6" y="10" width="20" height="12" rx="2" stroke="#526484" stroke-width="2"/>
                  <path d="M10 6L16 10L22 6" stroke="#526484" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M10 16h4M18 16h4" stroke="#526484" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <h4>Net Banking</h4>
              <p>All major banks</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="page-sidebar">
        <div class="order-summary">
          <div class="order-summary-content">
            <h3>Order Summary</h3>
            <div class="order-summary-details">
              ${this.renderOrderSummary()}
            </div>
          </div>
          
          <div class="sidebar-footer">
            <div class="form-actions">
              <button class="btn btn-secondary back-btn" id="backBtn">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M10 3L5 8L10 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Back
              </button>
            </div>
          </div>
        </div>
      </div>
    `}renderPaymentMethodForm(){console.log("[Checkout WebComponent] renderPaymentMethodForm");let e="";switch(this.selectedPaymentMethod){case"upi":e=this.renderUPIForm();break;case"card":e=this.renderCardForm();break;case"wallet":e=this.renderWalletForm();break;case"netbanking":e=this.renderNetBankingForm();break}return`
      <div class="page-body">
        <div class="payment-form-section">
          <div class="selected-method-header">
            <button class="btn btn-secondary change-method-btn" id="changeMethodBtn">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M10 3L5 8L10 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Change Payment Method
            </button>
            <h3>${this.getPaymentMethodTitle()}</h3>
          </div>
          ${e}
        </div>
      </div>

      <div class="page-sidebar">
        <div class="order-summary">
          <div class="order-summary-content">
            <h3>Order Summary</h3>
            <div class="order-summary-details">
              ${this.renderOrderSummary()}
            </div>
          </div>

          <div class="sidebar-footer">
            <div class="form-actions">
              <button class="btn btn-secondary back-btn" id="backBtn">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M10 3L5 8L10 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Back
              </button>
              <button class="btn btn-primary proceed-btn" id="proceedBtn">
                Complete Order
              </button>
            </div>
          </div>
        </div>
      </div>
    `}getPaymentMethodTitle(){switch(console.log("[Checkout WebComponent] getPaymentMethodTitle"),this.selectedPaymentMethod){case"upi":return"UPI Payment";case"card":return"Card Payment";case"wallet":return"Digital Wallet";case"netbanking":return"Net Banking";default:return"Payment"}}renderUPIForm(){return console.log("[Checkout WebComponent] renderUPIForm"),`
      <div class="payment-form">
        <div class="form-group">
          <label for="upiCollect">UPI ID *</label>
          <div id="upiCollect" class="cashfree-input-container"></div>
          <div class="field-error" data-error="upiId"></div>
        </div>
        <div class="cashfree-loading" id="cashfreeUpiLoading" style="display: none;">
          <p>Loading secure UPI form...</p>
        </div>
        <div class="upi-note">
          <p>Enter your UPI ID to complete the payment. You'll receive a payment request on your UPI app.</p>
        </div>
      </div>
    `}renderCardForm(){return console.log("[Checkout WebComponent] renderCardForm"),`
      <div class="payment-form">
        <div class="form-grid">
          <div class="form-group full-width">
            <label for="cardHolder">Cardholder Name *</label>
            <div id="cardHolder" class="cashfree-input-container"></div>
            <div class="field-error" data-error="cardholderName"></div>
          </div>
          
          <div class="form-group full-width">
            <label for="cardNumber">Card Number *</label>
            <div id="cardNumber" class="cashfree-input-container"></div>
            <div class="field-error" data-error="cardNumber"></div>
          </div>
          
          <div class="form-group">
            <label for="cardExpiry">Expiry Date *</label>
            <div id="cardExpiry" class="cashfree-input-container"></div>
            <div class="field-error" data-error="expiryDate"></div>
          </div>
          
          <div class="form-group">
            <label for="cardCvv">CVV *</label>
            <div id="cardCvv" class="cashfree-input-container"></div>
            <div class="field-error" data-error="cvv"></div>
          </div>
        </div>
        <div class="cashfree-loading" id="cashfreeLoading" style="display: none;">
          <p>Loading secure payment form...</p>
        </div>
      </div>
    `}renderWalletForm(){return console.log("[Checkout WebComponent] renderWalletForm"),`
      <div class="payment-form">
        <div class="wallet-options">
          <label class="wallet-section-label">Select Wallet *</label>
          <div class="wallet-providers">
            ${[{id:"phonepe",name:"PhonePe",provider:"phonepe"},{id:"amazon",name:"Amazon Pay",provider:"amazon"},{id:"paytm",name:"Paytm",provider:"paytm"},{id:"freecharge",name:"FreeCharge",provider:"freecharge"},{id:"mobikwik",name:"Mobikwik",provider:"mobikwik"}].map(t=>`
              <div class="wallet-provider-container">
                <div id="${t.id}" class="cashfree-wallet-container" data-provider="${t.provider}"></div>
              </div>
            `).join("")}
          </div>
        </div>
        
        <div class="cashfree-loading" id="cashfreeWalletLoading" style="display: none;">
          <p>Loading wallet options...</p>
        </div>
        
        <div class="wallet-note">
          <p>Click on your preferred wallet to continue with the payment. You'll be redirected to complete the payment securely.</p>
        </div>
      </div>
    `}renderNetBankingForm(){return console.log("[Checkout WebComponent] renderNetBankingForm"),`
      <div class="payment-form">
        <div class="form-group">
          <label for="bankName">Select Bank *</label>
          <select id="bankName" data-field="payment.netbanking.bankName">
            <option value="">Choose Your Bank</option>
            <option value="sbi" ${this.paymentDetails.netbanking.bankName==="sbi"?"selected":""}>State Bank of India</option>
            <option value="hdfc" ${this.paymentDetails.netbanking.bankName==="hdfc"?"selected":""}>HDFC Bank</option>
            <option value="icici" ${this.paymentDetails.netbanking.bankName==="icici"?"selected":""}>ICICI Bank</option>
            <option value="axis" ${this.paymentDetails.netbanking.bankName==="axis"?"selected":""}>Axis Bank</option>
            <option value="kotak" ${this.paymentDetails.netbanking.bankName==="kotak"?"selected":""}>Kotak Mahindra Bank</option>
            <option value="pnb" ${this.paymentDetails.netbanking.bankName==="pnb"?"selected":""}>Punjab National Bank</option>
            <option value="canara" ${this.paymentDetails.netbanking.bankName==="canara"?"selected":""}>Canara Bank</option>
            <option value="bob" ${this.paymentDetails.netbanking.bankName==="bob"?"selected":""}>Bank of Baroda</option>
          </select>
          <div class="field-error" data-error="bankName"></div>
        </div>
        <div class="netbanking-note">
          <p>You will be redirected to your bank's website to complete the payment securely.</p>
        </div>
      </div>
    `}renderOrderConfirmation(){if(console.log("[Checkout WebComponent] renderOrderConfirmation"),!this.orderData)return"<div>No order data available</div>";const e={card:"Credit/Debit Card",upi:"UPI",wallet:"Digital Wallet",netbanking:"Net Banking"}[this.orderData.paymentMethod]||this.orderData.paymentMethod;return`
      <div class="page-body">  
        <div class="confirmation-container">
          <div class="confirmation-success">
            <div class="success-icon-large">
              <svg width="40" height="40" viewBox="0 0 80 80" fill="none">
                <circle cx="40" cy="40" r="38" stroke="#10b981" stroke-width="4" fill="#f0fdf4"/>
                <path d="M25 40L35 50L55 30" stroke="#10b981" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <h2>Order Confirmed!</h2>
            <p class="confirmation-message">Your subscription has been successfully processed.</p>
          </div>

          <div class="confirmation-details">
            <h3>Order Summary</h3>
            
            <div class="detail-section">
              <h4>Subscription Details</h4>
              <div class="detail-row">
                <span class="detail-label">Plan:</span>
                <span class="detail-value">${this.orderData.selectedPlan.name}</span>
              </div>
              ${this.orderData.selectedAddons.length>0?`
                <div class="detail-row">
                  <span class="detail-label">Add-ons:</span>
                  <span class="detail-value">${this.orderData.selectedAddons.map(t=>t.name).join(", ")}</span>
                </div>
              `:""}
            </div>

            <div class="detail-section">
              <h4>Billing Information</h4>
              <div class="detail-row">
                <span class="detail-label">Name:</span>
                <span class="detail-value">${this.orderData.personalDetails.firstName} ${this.orderData.personalDetails.lastName}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Email:</span>
                <span class="detail-value">${this.orderData.personalDetails.email}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Payment Method:</span>
                <span class="detail-value">${e}</span>
              </div>
            </div>

            <div class="detail-section">
              <h4>Payment Summary</h4>
              <div class="detail-row">
                <span class="detail-label">Subtotal:</span>
                <span class="detail-value">$${this.orderData.originalTotal.toFixed(2)}</span>
              </div>
              ${this.orderData.totalDiscount>0?`
                <div class="detail-row discount-row">
                  <span class="detail-label">Discount:</span>
                  <span class="detail-value">-$${this.orderData.totalDiscount.toFixed(2)}</span>
                </div>
              `:""}
              <div class="detail-row total-row">
                <span class="detail-label">Total:</span>
                <span class="detail-value">$${this.orderData.total.toFixed(2)}/${this.orderData.selectedPlan.period}</span>
              </div>
            </div>

            <div class="confirmation-note">
              <p>✉️ A confirmation email has been sent to <strong>${this.orderData.personalDetails.email}</strong></p>
              <p>📅 Your subscription will begin immediately and will renew on ${this.getNextBillingDate()}.</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="page-sidebar">
        <div class="order-summary">
          <div class="order-summary-content">
            <div class="confirmation-actions">
              <h3>What's Next?</h3>
              <div class="next-steps">
                <div class="next-step">
                  <span class="step-number">1</span>
                  <span class="step-text">Check your email for login credentials</span>
                </div>
                <div class="next-step">
                  <span class="step-number">2</span>
                  <span class="step-text">Access your dashboard to get started</span>
                </div>
                <div class="next-step">
                  <span class="step-number">3</span>
                  <span class="step-text">Explore features and customize settings</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="sidebar-footer">
            <button class="btn btn-primary proceed-btn" id="proceedBtn" onclick="window.location.href='/dashboard'">
              Go to Dashboard
            </button>
            <button class="btn btn-secondary close-confirmation-btn" id="closeConfirmationBtn">
              Close
            </button>
          </div>
        </div>
      </div>
    `}getNextBillingDate(){console.log("[Checkout WebComponent] getNextBillingDate");const e=new Date;return this.orderData&&this.orderData.selectedPlan.period==="month"?e.setMonth(e.getMonth()+1):e.setFullYear(e.getFullYear()+1),e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}selectPaymentMethod(e){this.selectedPaymentMethod=e,this.render()}getCashfreeStyleObject(){console.log("[Checkout WebComponent] getCashfreeStyleObject");const e=getComputedStyle(this.shadowRoot.host),t=(o,i)=>e.getPropertyValue(o).trim()||i;return{base:{fontSize:t("--billhive-font-size","12px"),fontFamily:t("--billhive-font-family","'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif"),backgroundColor:"#FFFFFF",":focus":{border:`1px solid ${t("--billhive-accent-color","#5b5bd6")}`},border:`1px solid ${t("--billhive-border-color","#e5e7eb")}`,borderRadius:t("--billhive-card-border-radius","4px"),padding:"12px",color:t("--billhive-text-color","#111827")},invalid:{color:"#dc2626",border:"1px solid #dc2626"}}}async setupCashfreeCardComponents(){if(console.log("[Checkout WebComponent] setupCashfreeCardComponents"),!this.cashfreeInstance){console.error("Cashfree SDK not loaded"),this.showCardFormError("Secure payment form could not be loaded. Please try again or select a different payment method.");return}try{const e=this.shadowRoot.querySelector("#cashfreeLoading");e&&(e.style.display="block");const t=this.getCashfreeStyleObject(),o={values:{placeholder:"1234 5678 9012 3456"},style:t};this.cashfreeComponents.cardNumber=this.cashfreeInstance.create("cardNumber",o);const i=this.shadowRoot.querySelector("#cardNumber");i&&await this.cashfreeComponents.cardNumber.mount(i);const a={values:{placeholder:"Enter cardholder name"},style:t};this.cashfreeComponents.cardHolder=this.cashfreeInstance.create("cardHolder",a);const n=this.shadowRoot.querySelector("#cardHolder");n&&await this.cashfreeComponents.cardHolder.mount(n);const l={values:{placeholder:"MM/YY"},style:t};this.cashfreeComponents.cardExpiry=this.cashfreeInstance.create("cardExpiry",l);const d=this.shadowRoot.querySelector("#cardExpiry");d&&await this.cashfreeComponents.cardExpiry.mount(d);const c={values:{placeholder:"123"},style:t};this.cashfreeComponents.cardCvv=this.cashfreeInstance.create("cardCvv",c);const s=this.shadowRoot.querySelector("#cardCvv");s&&await this.cashfreeComponents.cardCvv.mount(s),this.cashfreeComponents.cardNumber.on("change",p=>{p.value&&p.value.cvvLength&&this.cashfreeComponents.cardCvv.update({cvvLength:p.value.cvvLength}),this.validateCashfreeCardForm()}),this.cashfreeComponents.cardHolder.on("change",()=>{this.validateCashfreeCardForm()}),this.cashfreeComponents.cardExpiry.on("change",()=>{this.validateCashfreeCardForm()}),this.cashfreeComponents.cardCvv.on("change",()=>{this.validateCashfreeCardForm()}),e&&(e.style.display="none"),console.log("✅ Cashfree card components mounted successfully")}catch(e){console.error("Failed to setup Cashfree card components:",e),this.showCardFormError("Failed to initialize secure payment form. Please refresh and try again.")}}showCardFormError(e){console.log("[Checkout WebComponent] showCardFormError"),["#cardNumber","#cardHolder","#cardExpiry","#cardCvv"].forEach(o=>{const i=this.shadowRoot.querySelector(o);i&&(i.innerHTML=`<div style="color: #df1b41; padding: 12px; border: 1px solid #df1b41; border-radius: 12px; background: #fff5f5;">${e}</div>`)})}validateCashfreeCardForm(){if(console.log("[Checkout WebComponent] validateCashfreeCardForm"),this.cashfreeComponents.cardNumber&&this.cashfreeComponents.cardHolder&&this.cashfreeComponents.cardExpiry&&this.cashfreeComponents.cardCvv){const e=this.cashfreeComponents.cardNumber.isComplete()&&this.cashfreeComponents.cardHolder.isComplete()&&this.cashfreeComponents.cardExpiry.isComplete()&&this.cashfreeComponents.cardCvv.isComplete();this.paymentDetails.card.isValid=e,e&&(delete this.formErrors.cardNumber,delete this.formErrors.cardholderName,delete this.formErrors.expiryDate,delete this.formErrors.cvv)}}async setupCashfreeUpiComponent(){if(console.log("[Checkout WebComponent] setupCashfreeUpiComponent"),!this.cashfreeInstance){console.error("Cashfree SDK not loaded"),this.showUpiFormError("Secure UPI form could not be loaded. Please try again or select a different payment method.");return}try{const e=this.shadowRoot.querySelector("#cashfreeUpiLoading");e&&(e.style.display="block");const t={fields:{upiId:{label:"Enter your UPI ID",placeholder:"yourname@paytm"}},style:this.getCashfreeStyleObject()};this.cashfreeComponents.upiCollect=this.cashfreeInstance.create("upiCollect",t);const o=this.shadowRoot.querySelector("#upiCollect");o&&await this.cashfreeComponents.upiCollect.mount(o),this.cashfreeComponents.upiCollect.on("change",()=>{this.validateCashfreeUpiForm()}),e&&(e.style.display="none"),console.log("✅ Cashfree UPI component mounted successfully")}catch(e){console.error("Failed to setup Cashfree UPI component:",e),this.showUpiFormError("Failed to initialize secure UPI form. Please refresh and try again.")}}showUpiFormError(e){console.log("[Checkout WebComponent] showUpiFormError");const t=this.shadowRoot.querySelector("#upiCollect");t&&(t.innerHTML=`<div style="color: #df1b41; padding: 12px; border: 1px solid #df1b41; border-radius: 12px; background: #fff5f5;">${e}</div>`)}validateCashfreeUpiForm(){if(console.log("[Checkout WebComponent] validateCashfreeUpiForm"),this.cashfreeComponents.upiCollect){const e=this.cashfreeComponents.upiCollect.isComplete();this.paymentDetails.upi.isValid=e,e&&delete this.formErrors.upiId}}async setupCashfreeWalletComponents(){if(console.log("[Checkout WebComponent] setupCashfreeWalletComponents"),!this.cashfreeInstance){console.error("Cashfree SDK not loaded"),this.showWalletFormError("Secure wallet options could not be loaded. Please try again or select a different payment method.");return}try{const e=this.shadowRoot.querySelector("#cashfreeWalletLoading");e&&(e.style.display="block");const t=[{id:"phonepe",provider:"phonepe",buttonText:"PhonePe"},{id:"amazon",provider:"amazon",buttonText:"Amazon Pay"},{id:"paytm",provider:"paytm",buttonText:"Paytm"},{id:"freecharge",provider:"freecharge",buttonText:"FreeCharge"},{id:"mobikwik",provider:"mobikwik",buttonText:"Mobikwik"}],o=getComputedStyle(this.shadowRoot.host),i=(n,l)=>o.getPropertyValue(n).trim()||l,a={base:{fontSize:i("--billhive-font-size","12px"),padding:"12px",display:"flex",alignItems:"center",borderRadius:i("--billhive-card-border-radius","4px"),gap:"12px",border:`1px solid ${i("--billhive-border-color","#e5e7eb")}`,backgroundColor:"#FFFFFF",cursor:"pointer",fontFamily:i("--billhive-font-family","'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif"),color:i("--billhive-text-color","#111827"),":hover":{backgroundColor:i("--billhive-input-components-color","#f9fafb")}}};for(const n of t){const l={values:{provider:n.provider,phone:"1234567890",buttonText:n.buttonText,buttonIcon:!0},style:a},d=this.cashfreeInstance.create("wallet",l),c=this.shadowRoot.querySelector(`#${n.id}`);c&&(await d.mount(c),this.cashfreeComponents.wallets.set(n.provider,d),d.on("click",s=>{console.log(`${n.buttonText} wallet clicked:`,s),this.handleWalletSelection(n.provider,d)}))}e&&(e.style.display="none"),console.log("✅ Cashfree wallet components mounted successfully")}catch(e){console.error("Failed to setup Cashfree wallet components:",e),this.showWalletFormError("Failed to initialize wallet options. Please refresh and try again.")}}handleWalletSelection(e,t){console.log("[Checkout WebComponent] handleWalletSelection"),this.paymentDetails.wallet.selectedProvider=e,this.paymentDetails.wallet.selectedComponent=t,this.paymentDetails.wallet.isValid=!0,delete this.formErrors.walletType,console.log(`Wallet ${e} selected and ready for payment`)}showWalletFormError(e){console.log("[Checkout WebComponent] showWalletFormError"),["#phonepe","#amazon","#paytm","#freecharge","#mobikwik"].forEach(o=>{const i=this.shadowRoot.querySelector(o);i&&(i.innerHTML=`<div style="color: #df1b41; padding: 12px; border: 1px solid #df1b41; border-radius: 12px; background: #fff5f5; text-align: center;">${e}</div>`)})}setupPaymentFormListeners(){console.log("[Checkout WebComponent] setupPaymentFormListeners");const e=this.selectedPaymentMethod;if(e==="upi")this.setupCashfreeUpiComponent();else if(e==="card")this.setupCashfreeCardComponents();else if(e==="wallet")this.setupCashfreeWalletComponents();else if(e==="netbanking"){const t=this.shadowRoot.querySelector("#bankName");t&&t.addEventListener("change",o=>{this.handlePaymentInputChange("netbanking.bankName",o.target.value)})}}handlePaymentInputChange(e,t){console.log("[Checkout WebComponent] handlePaymentInputChange");const o=e.split(".");if(o.length===2){const[i,a]=o;this.paymentDetails[i]||(this.paymentDetails[i]={}),this.paymentDetails[i][a]=t,delete this.formErrors[a],this.updateFieldError(`payment.${i}.${a}`)}}setupModalEventListeners(){var l;console.log("[Checkout WebComponent] setupModalEventListeners"),this.planId&&!((l=this.selectedPlan)!=null&&l.ratePlanPriceId)&&(this.isLoadingPlan=!0,this.isLoadingAddons=!0,this.loadPlanFromApi().catch(d=>{console.error("Failed to load plan:",d)}));const e=this.shadowRoot.querySelector("#proceedBtn"),t=this.shadowRoot.querySelector("#backBtn"),o=this.shadowRoot.querySelector("#couponInput"),i=this.shadowRoot.querySelector("#applyCouponBtn"),a=this.shadowRoot.querySelector("#removeCouponBtn");if(e==null||e.addEventListener("click",()=>this.proceedToCheckout()),t==null||t.addEventListener("click",()=>this.goBackToPlanSelection()),this.shadowRoot.querySelectorAll(".addon-checkbox").forEach(d=>{d.addEventListener("change",c=>{this.toggleAddon(c.target.dataset.addonId)})}),this.shadowRoot.querySelectorAll(".addon-quantity-input").forEach(d=>{d.addEventListener("input",c=>{let s=c.target.value.replace(/[^\d]/g,"");s===""&&(s="1"),this.handleAddonQuantityChange(c.target.dataset.addonId,s)}),d.addEventListener("keypress",c=>{!/[\d]/.test(c.key)&&!["Backspace","Delete","Tab","Enter","ArrowLeft","ArrowRight"].includes(c.key)&&c.preventDefault()}),d.addEventListener("blur",c=>{const s=c.target.dataset.addonId,p=c.target.value;(!p||parseInt(p)<1)&&this.handleAddonQuantityChange(s,"1")})}),this.shadowRoot.querySelectorAll(".qty-btn").forEach(d=>{d.addEventListener("click",c=>{const s=c.target.dataset.addonId,p=c.target.dataset.action,m=this.addonQuantities.get(s)||1;p==="increase"&&m<999?this.handleAddonQuantityChange(s,m+1):p==="decrease"&&m>1&&this.handleAddonQuantityChange(s,m-1),this.render()})}),this.shadowRoot.querySelectorAll(".available-discount-card").forEach(d=>{d.addEventListener("click",c=>{if(c.target.classList.contains("remove-discount-btn"))return;const s=c.currentTarget.dataset.discountId;this.selectDiscount(s)})}),this.shadowRoot.querySelectorAll(".available-discount-card .remove-discount-btn").forEach(d=>{d.addEventListener("click",c=>{c.stopPropagation();const s=c.target.dataset.discountId;this.removeDiscount(s)})}),o==null||o.addEventListener("input",d=>{this.couponCode=d.target.value}),o==null||o.addEventListener("keypress",d=>{d.key==="Enter"&&this.applyCouponCode()}),i==null||i.addEventListener("click",()=>this.applyCouponCode()),a==null||a.addEventListener("click",()=>this.removeCoupon()),this.currentModalStep==="personal-details"&&(["firstName","lastName","email","phone","company"].forEach(d=>{const c=this.shadowRoot.querySelector(`[data-field="${d}"]`);c&&(c.addEventListener("input",s=>{this.handleInputChange(d,s.target.value)}),d==="email"&&(c.addEventListener("input",s=>{const p=s.target.value.trim();this.existingAccount&&this.existingAccount.email!==p&&(this.existingAccount=null,this.hideExistingAccountMessage())}),c.addEventListener("blur",s=>{const p=s.target.value.trim();p&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p)?this.handleEmailCheck(p):p||(this.existingAccount=null,this.hideExistingAccountMessage())})))}),["address.addressLine","address.city","address.state","address.zipCode","address.country"].forEach(d=>{const c=this.shadowRoot.querySelector(`[data-field="${d}"]`);c&&(c.addEventListener("input",s=>{this.handleInputChange(d,s.target.value)}),c.tagName==="SELECT"&&c.addEventListener("change",s=>{this.handleInputChange(d,s.target.value)}))})),this.currentModalStep==="payment-method"){this.shadowRoot.querySelectorAll(".payment-method-card").forEach((s,p)=>{const m=s.dataset.method;s.addEventListener("click",h=>{this.selectPaymentMethod(m)})});const c=this.shadowRoot.querySelector("#changeMethodBtn");c&&c.addEventListener("click",()=>{this.selectedPaymentMethod=null,this.render()}),this.selectedPaymentMethod&&this.setupPaymentFormListeners()}if(this.currentModalStep==="order-confirmation"){const d=this.shadowRoot.querySelector("#closeConfirmationBtn");d&&d.addEventListener("click",()=>{const c=new CustomEvent("order-completed",{detail:this.orderData,bubbles:!0});this.dispatchEvent(c),this.close()})}const n=this.shadowRoot.querySelector("#retryPlanLoad");n&&n.addEventListener("click",d=>{d.preventDefault(),this.loadPlanFromApi()})}renderSelectedPlan(){if(console.log("[Checkout WebComponent] renderSelectedPlan"),console.log("renderSelectedPlan:",{isLoadingPlan:this.isLoadingPlan,selectedPlan:this.selectedPlan,planId:this.planId,planLoadError:this.planLoadError}),this.isLoadingPlan&&!this.selectedPlan)return`
        <div class="selected-plan loading">
          <div class="loading-spinner"></div>
          <p>Loading plan details...</p>
        </div>
      `;if(this.planLoadError)return`
        <div class="selected-plan error">
          <div class="error-icon">⚠️</div>
          <p>Failed to load plan details: ${this.planLoadError}</p>
          <button class="btn btn-primary retry-btn" id="retryPlanLoad">Retry</button>
        </div>
      `;if(!this.selectedPlan)return`
        <div class="selected-plan default-plan">
          <div class="plan-info">
            <div class="plan-header">
              <span class="plan-name">No Plan Selected</span>
            </div>
            <div class="detail-item">
              <span class="value">Please select a plan to continue</span>
            </div>
          </div>

          <div class="plan-price">
            <div class="price-display">
              <span class="price">$0</span>
              <span class="period">/month</span>
            </div>
            <div class="billing-info">Select a plan to see pricing</div>
          </div>
        </div>
      `;const e=o=>({USD:"$",EUR:"€",GBP:"£",INR:"₹",JPY:"¥",CAD:"C$",AUD:"A$",CHF:"CHF",CNY:"¥",SEK:"kr"})[o==null?void 0:o.toUpperCase()]||o||"$",t=this.selectedPlan.currencyCode?e(this.selectedPlan.currencyCode):"$";return`
      <div class="selected-plan">
        <div class="plan-info">
          <div class="plan-header">
            <span class="plan-name">${this.selectedPlan.name}</span>
          </div>
          
          
            ${this.selectedPlan.productName?`<div class="detail-item"><span class="label">Product:</span> <span class="value">${this.selectedPlan.productName}</span></div>`:""}
    

          ${this.selectedPlan.isTrial&&this.selectedPlan.trialPeriod?`<div class="trial-info">
              <span class="trial-badge">Free Trial</span>
              <span class="trial-details">${this.selectedPlan.trialPeriod.periodName} free trial</span>
            </div>`:""}
            
        </div>
        
        <div class="plan-price">
          <div class="price-display">
            <span class="price">${t}${this.selectedPlan.price}</span>
            <span class="period">/${this.selectedPlan.period}</span>
          </div>
          ${this.selectedPlan.billingPeriod?`<div class="billing-info">Billed ${this.selectedPlan.billingPeriod.periodName}</div>`:""}
        </div>
      </div>
    `}renderAddonsContent(){return console.log("[Checkout WebComponent] renderAddonsContent"),this.isLoadingAddons?'<div class="loading-state">Loading available add-ons...</div>':this.addonsLoadError?`<div class="error-state">Failed to load add-ons: ${this.addonsLoadError}</div>`:!this.addons||this.addons.length===0?'<div class="empty-state">No add-ons available for this plan.</div>':`
      <div class="addons-grid">
        ${this.addons.map(e=>this.renderAddon(e)).join("")}
      </div>
    `}getCurrencySymbol(e){return console.log("[Checkout WebComponent] getCurrencySymbol"),{USD:"$",EUR:"€",GBP:"£",INR:"₹",JPY:"¥",CNY:"¥",AUD:"A$",CAD:"C$",CHF:"Fr",SEK:"kr",NZD:"NZ$"}[e]||e||"$"}formatDisplayDate(e){if(console.log("[Checkout WebComponent] formatDisplayDate"),!e)return"";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(t){return console.error("Error formatting date:",t),e}}isCouponRejected(){return console.log("[Checkout WebComponent] isCouponRejected"),!this.orderEstimate||!this.orderEstimate.cart?!1:this.orderEstimate.cart.some(e=>{var o,i;return(e.itemType==="Discount"||e.itemType==="Coupon"||((o=e.description)==null?void 0:o.toLowerCase().includes("coupon"))||((i=e.description)==null?void 0:i.toLowerCase().includes("discount")))&&e.status==="Rejected"})}getCouponStatusMessage(){var t;if(console.log("[Checkout WebComponent] getCouponStatusMessage"),!this.orderEstimate||!this.orderEstimate.cart)return"";const e=this.orderEstimate.cart.find(o=>{var a,n;return(o.itemType==="Discount"||o.itemType==="Coupon"||((a=o.description)==null?void 0:a.toLowerCase().includes("coupon"))||((n=o.description)==null?void 0:n.toLowerCase().includes("discount")))&&o.status==="Rejected"});return e&&((t=e.options)!=null&&t.reason)?`<div class="coupon-error">${e.options.reason}</div>`:""}isSuccessfullyAppliedCoupon(){return console.log("[Checkout WebComponent] isSuccessfullyAppliedCoupon"),!this.orderEstimate||!this.orderEstimate.cart?!1:!!this.orderEstimate.cart.find(t=>{var i,a;return(t.itemType==="Coupon"||((i=t.description)==null?void 0:i.toLowerCase().includes("coupon"))&&!((a=t.itemType)!=null&&a.includes("Discount")))&&t.status!=="Rejected"})}getAppliedCouponName(){if(console.log("[Checkout WebComponent] getAppliedCouponName"),!this.orderEstimate||!this.orderEstimate.cart)return"";const e=this.orderEstimate.cart.find(t=>{var i,a;return(t.itemType==="Coupon"||((i=t.description)==null?void 0:i.toLowerCase().includes("coupon"))&&!((a=t.itemType)!=null&&a.includes("Discount")))&&t.status!=="Rejected"});return e?e.description:""}isDiscountSuccessfullyApplied(e){return console.log("[Checkout WebComponent] isDiscountSuccessfullyApplied"),!this.orderEstimate||!this.orderEstimate.cart?!1:this.orderEstimate.cart.some(t=>t.itemType==="Discount"&&(t.itemId===e||t.discountId===e)&&t.status!=="Rejected")}renderAddon(e){console.log("[Checkout WebComponent] renderAddon");const t=this.selectedAddons.has(e.id),o=this.getCurrencySymbol(e.currencyCode),i=e.period,a=e.unitOfMeasurement?` per ${e.unitOfMeasurement}`:"",n=this.addonQuantities.get(e.id)||1;return`
      <div class="addon-card ${t?"selected":""}">
        
        <div class="addon-content">
          <div class="addon-left">
            <label class="addon-label">
              <input 
                type="checkbox" 
                class="addon-checkbox" 
                data-addon-id="${e.id}"
                ${t?"checked":""}
              >
              <div class="addon-info">
                <span class="addon-name">${e.name}</span>
                <p class="addon-description">${e.description}</p>
              </div>
            </label>
          </div>
          <div class="addon-right">
            <div class="addon-price-section">
              <span class="addon-price">
                ${e.isPriceIncluded?"Included":`+${o}${e.price}/${i}${a}`}
              </span>
              ${t?`
                <div class="addon-quantity-control">
                  <label for="addon-qty-${e.id}" style="margin-right: 8px;">Quantity:</label>
                  <div class="quantity-input-group" style="display: inline-flex; align-items: center;">
                    <button class="btn btn-sm qty-btn qty-decrease" data-addon-id="${e.id}" data-action="decrease" ${n<=1?"disabled":""}>-</button>
                    <input
                      type="number"
                      id="addon-qty-${e.id}"
                      class="addon-quantity-input"
                      data-addon-id="${e.id}"
                      value="${n}"
                      min="1"
                      max="999"
                      style="width: 60px; text-align: center; margin: 0 8px;"
                    >
                    <button class="btn btn-sm qty-btn qty-increase" data-addon-id="${e.id}" data-action="increase" ${n>=999?"disabled":""}>+</button>
                  </div>
                </div>
              `:""}
            </div>
          </div>
        </div>
      </div>
    `}renderDiscount(e){var i;console.log("[Checkout WebComponent] renderDiscount");const t=((i=this.selectedDiscount)==null?void 0:i.id)===e.id,o=e.type==="percentage"?`${e.value}% off`:`$${e.value} off`;return`
      <div class="discount-card ${t?"selected":""}" data-discount-id="${e.id}">
        <div class="discount-header">
          <span class="discount-name">${e.name}</span>
          <span class="discount-value">${o}</span>
        </div>
        <p class="discount-description">${e.description}</p>
        <span class="discount-code">Code: ${e.code}</span>
      </div>
    `}renderOrderSummary(){if(console.log("[Checkout WebComponent] renderOrderSummary"),!this.selectedPlan)return`
        <div class="default-summary">
          <div class="summary-item">
            <div class="item-details">
              <span class="item-name">Select a plan to see pricing</span>
            </div>
          </div>

          <div class="summary-divider"></div>

          <div class="summary-subtotal">
            <span class="subtotal-label">Subtotal</span>
            <span class="subtotal-price">$0.00</span>
          </div>

          <div class="summary-tax">
            <span class="tax-label">Tax</span>
            <span class="tax-amount">$0.00</span>
          </div>

          <div class="summary-divider"></div>

          <div class="summary-total">
            <span class="total-label">Total</span>
            <span class="total-price">$0.00</span>
          </div>
        </div>
      `;if(this.isLoadingEstimate)return`
        <div class="loading-items">
          <div class="spinner"></div>
          <p>Loading items...</p>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-subtotal">
          <span class="subtotal-label">Subtotal</span>
          <span class="subtotal-price loading-text">Calculating...</span>
        </div>

        <div class="summary-tax">
          <span class="tax-label">Tax</span>
          <span class="tax-amount loading-text">Calculating...</span>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-total">
          <span class="total-label">Total</span>
          <span class="total-price loading-text">Calculating...</span>
        </div>
      `;if(this.estimateError)return`
        <div class="error-items">
          <p>Unable to load items</p>
          <small>${this.estimateError}</small>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-subtotal">
          <span class="subtotal-label">Subtotal</span>
          <span class="subtotal-price">$0.00</span>
        </div>

        <div class="summary-tax">
          <span class="tax-label">Tax</span>
          <span class="tax-amount">$0.00</span>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-total">
          <span class="total-label">Total</span>
          <span class="total-price">$0.00</span>
        </div>
      `;if(!this.orderEstimate)return`
        <div class="loading-summary">
          <p>Loading order summary...</p>
        </div>
      `;const e=this.orderEstimate,t=this.getCurrencySymbol(e.currency||this.selectedPlan.currencyCode);let o="";const i=[],a=[],n=new Map;let l=null;if(e.cart&&e.cart.length>0&&e.cart.forEach(s=>{var m,h;if(!((s.itemType==="Discount"||s.itemType==="Coupon"||(m=s.description)!=null&&m.toLowerCase().includes("coupon")||(h=s.description)!=null&&h.toLowerCase().includes("discount"))&&s.status==="Rejected"))if(s.itemType==="Rate Plan"&&s.status==="Reserved"&&s.nextBillingDate&&(l=this.formatDisplayDate(s.nextBillingDate)),s.itemType==="Discount"&&s.itemId&&s.status!=="Reserved"){n.has(s.itemId)||n.set(s.itemId,{description:s.description,items:[],totalAmount:0});const u=n.get(s.itemId);u.items.push(s),u.totalAmount+=s.amount}else s.status==="Reserved"?a.push(s):i.push(s)}),i.forEach(s=>{var b,v;const p=s.itemType==="Discount"||s.itemType==="Coupon"||((b=s.description)==null?void 0:b.toLowerCase().includes("coupon"))||((v=s.description)==null?void 0:v.toLowerCase().includes("discount"));if(s.itemType==="Discount")return;const m=s.fromDate&&!p?this.formatDisplayDate(s.fromDate):"",h=s.toDate&&!p?this.formatDisplayDate(s.toDate):"",u=m&&h?`${m} - ${h}`:"";o+=`
        <div class="summary-item">
          <div class="item-details">
            <span class="item-name">${s.description}</span>
            ${u?`<span class="item-dates">${u}</span>`:""}
          </div>
          <span class="item-price ${p?"discount-price":""}">
            ${p?"-":""}${t}${s.amount.toFixed(2)}
          </span>
        </div>
      `}),n.forEach((s,p)=>{const m=s.items.length>1;o+=`
        <div class="summary-item discount-group">
          <div class="item-details">
            <span class="item-name">
              ${s.description}
              ${m?`
                <span class="discount-info-icon" data-discount-id="${p}">
                  ⓘ
                  <div class="discount-tooltip">
                    <div class="tooltip-title">Applied on:</div>
                    ${s.items.map(h=>{var b;return`<div class="tooltip-item">- ${((b=h.options)==null?void 0:b.itemType)||"Item"}: ${t}${h.amount.toFixed(2)}</div>`}).join("")}
                  </div>
                </span>
              `:""}
            </span>
          </div>
          <span class="item-price discount-price">
            -${t}${s.totalAmount.toFixed(2)}
          </span>
        </div>
      `}),a.length>0){const s=new Map,p=[];a.forEach(h=>{if(h.itemType==="Discount"&&h.itemId){s.has(h.itemId)||s.set(h.itemId,{description:h.description,items:[],totalAmount:0});const u=s.get(h.itemId);u.items.push(h),u.totalAmount+=h.amount}else p.push(h)});const m=a.reduce((h,u)=>h+u.amount,0);o+=`
        <div class="reserved-items-section">
          ${l?`
            <div class="reserved-billing-date">
              Next Billing Date - <span class="billing-date-value">${l}</span>
            </div>
          `:""}
          
          ${p.map(h=>{var g,$;const u=h.itemType==="Discount"||h.itemType==="Coupon"||((g=h.description)==null?void 0:g.toLowerCase().includes("coupon"))||(($=h.description)==null?void 0:$.toLowerCase().includes("discount")),b=h.fromDate&&!u?this.formatDisplayDate(h.fromDate):"",v=h.toDate&&!u?this.formatDisplayDate(h.toDate):"",y=b&&v?`${b} - ${v}`:"";return`
              <div class="summary-item reserved-item">
                <div class="item-details">
                  <span class="item-name">${h.description}</span>
                  ${y?`<span class="item-dates">${y}</span>`:""}
                </div>
                <span class="item-price ${u?"discount-price":""}">
                  ${u?"-":""}${t}${h.amount.toFixed(2)}
                </span>
              </div>
            `}).join("")}
          
          ${Array.from(s.entries()).map(([h,u])=>{const b=u.items.length>1;return`
              <div class="summary-item reserved-item discount-group">
                <div class="item-details">
                  <span class="item-name">
                    ${u.description}
                    ${b?`
                      <span class="discount-info-icon" data-discount-id="${h}">
                        ⓘ
                        <div class="discount-tooltip">
                          <div class="tooltip-title">Applied on:</div>
                          ${u.items.map(v=>{var g;return`<div class="tooltip-item">- ${((g=v.options)==null?void 0:g.itemType)||"Item"}: ${t}${v.amount.toFixed(2)}</div>`}).join("")}
                        </div>
                      </span>
                    `:""}
                  </span>
                </div>
                <span class="item-price discount-price">
                  -${t}${u.totalAmount.toFixed(2)}
                </span>
              </div>
            `}).join("")}
          
          <div class="reserved-subtotal">
            <span class="subtotal-label">Subtotal</span>
            <span class="subtotal-price">${t}${m.toFixed(2)}</span>
          </div>
        </div>
      `}o+=`
      <div class="summary-divider"></div>
      <div class="summary-subtotal">
        <span class="subtotal-label">Subtotal</span>
        <span class="subtotal-price" data-value="${e.subtotal}">${t}${e.subtotal.toFixed(2)}</span>
      </div>
    `,e.discounts&&e.discounts.length>0&&e.discounts.forEach(s=>{o+=`
          <div class="summary-discount">
            <span class="discount-label">${s.name}</span>
            <span class="discount-amount">-${t}${s.amount.toFixed(2)}</span>
          </div>
        `});const d=e.tax||0;o+=`
      <div class="summary-tax">
        <span class="tax-label">Tax</span>
        <span class="tax-amount" data-value="${d}">${t}${d.toFixed(2)}</span>
      </div>
    `,o+=`
      <div class="summary-divider"></div>
      <div class="summary-total">
        <span class="total-label">Total</span>
        <span class="total-price" data-value="${e.total}">${t}${e.total.toFixed(2)}/${this.selectedPlan.period||"month"}</span>
      </div>
    `;const c=e.discounts?e.discounts.reduce((s,p)=>s+p.amount,0):0;return c>0&&(o+=`
        <div class="savings-notice">
          You save ${t}${c.toFixed(2)}!
        </div>
      `),o}getStyles(){return console.log("[Checkout WebComponent] getStyles"),console.log("getStyles theme is:",x(this.theme,"Checkout")),`
      <style>
        ${x(this.theme,"Checkout")}
        
        :host {
          font-family: var(--billhive-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
          font-size: 12px;
        }

        /* Custom scrollbar styles - thin and visible only on hover */
        * {
          scrollbar-width: thin;
          scrollbar-color: transparent transparent;
        }

        *:hover {
          scrollbar-color: rgba(0, 0, 0, 0.3) transparent;
        }

        /* Webkit browsers (Chrome, Safari, Edge) */
        *::-webkit-scrollbar {
          width: 12px;
          height: 12px;
        }

        *::-webkit-scrollbar-track {
          background: transparent;
        }

        *::-webkit-scrollbar-thumb {
          background-color: transparent;
          border-radius: 12px;
          transition: background-color 0.3s ease;
        }

        *:hover::-webkit-scrollbar-thumb {
          background-color: rgba(0, 0, 0, 0.3);
        }

        *::-webkit-scrollbar-thumb:hover {
          background-color: rgba(0, 0, 0, 0.5);
        }

        .btn {
          display: inline-block;
          font-weight: 400;
          text-align: center;
          white-space: nowrap;
          vertical-align: middle;
          user-select: none;
          border: 1px solid transparent;
          padding: 8px 12px;
          font-size: var(--billhive-font-size, 12px);
          line-height: 1.5;
          border-radius: var(--billhive-card-border-radius, 4px);
          transition: all 0.15s ease-in-out;
          cursor: pointer;
          text-decoration: none;
          font-family: var(--billhive-font-family);
        }

        .btn-primary {
          color: var(--billhive-header-color, #fff);
          background-color: var(--billhive-accent-color, #145388);
          border-color: var(--billhive-accent-color, #145388);
        }
		
		    .btn-primary:hover {
          color: var(--billhive-header-color, #fff);
          background-color: var(--billhive-accent-hover, #0f3f65);
          border-color: var(--billhive-accent-hover, #0f3f65);
          box-shadow: var(--billhive-button-shadow, 0 2px 4px rgba(20, 83, 136, 0.3));
        }

        .btn-primary:focus {
          outline: 0;
          box-shadow: var(--billhive-button-shadow, 0 0 0 12px rgba(20, 83, 136, 0.25));
        }

        .btn-block {
          display: block;
          width: 100%;
        }


        .full-page-container {
          background: white;
          width: 100%;
          min-height: 100vh;
          display: flex;
          flex-direction: column;
          font-family: var(--billhive-font-family);
        }

        .page-header {
          background: var(--billhive-header-color, white);
          border-bottom: 1px solid var(--billhive-border-color, #e0e0e0);
          padding: 18px 24px;
          position: sticky;
          top: 0;
        }

        .page-header-content {
          display: flex;
          justify-content: space-between;
          align-items: center;
          max-width: 1200px;
          margin: 0 auto;
        }

        .page-header-content h2 {
          margin: 0;
          font-size: var(--billhive-header-font-size, 21px);
          font-weight: var(--billhive-header-font-weight, 600);
        }

        .page-content {
          flex: 1;
          max-width: 1100px;
          margin: 0 auto;
          width: 90%;
          box-sizing: border-box;
          display: flex;
          overflow: hidden;
        }

        .page-body {
          flex: 2;
          padding-right: 14px;
          overflow-y: auto;
        }

        .page-sidebar {
          flex: 1;
          background: var(--billhive-disabled-color, #f8f9fb);
          border-radius: 8px
          border: 2px solid var(--billhive-border-color, #e7ecf3);
          display: flex;
          flex-direction: column;
        }

        .modal-overlay.visible .modal-container {
          transform: translate(0, 0) scale(1);
        }

        .modal-overlay.fade-in .modal-container {
          transform: translate(0, -30px) scale(0.95);
        }

        .modal-overlay.fade-in.show .modal-container {
          transform: translate(0, 0) scale(1);
        }

        .modal-header {
          padding: 0;
          border-bottom: 1px solid var(--billhive-border-color, #e7ecf3);
          padding: 14px 18px;
          background: var(--billhive-header-color, #f9fafb);
        }

        .modal-header-content {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 12px;
        }

        .modal-header h2 {
          font-size: var(--billhive-header-font-size, 12px);
          font-weight: var(--billhive-header-font-weight, 700);
          color: var(--billhive-text-color, #364a63);
          margin: 0;
          font-family: var(--billhive-font-family);
        }

        .close-btn {
          position: absolute;
          top: 12px;
          right: 12px;
          height: 27px;
          width: 27px;
          display: inline-flex;
          justify-content: center;
          align-items: center;
          color: var(--billhive-sub-text-color, #8094ae);
          z-index: 1;
          transition: all 0.3s;
          background: none;
          border: none;
          border-radius: var(--billhive-card-border-radius, 4px);
          cursor: pointer;
          font-size: 15px;
          font-weight: 700;
          line-height: 1;
          opacity: 0.5;
          padding: 0;
        }

        .close-btn:hover {
          opacity: 0.75;
        }

        /* Progress Stepper Styles */
        .progress-indicator {
          padding: 18px 24px;
          max-width: 1200px;
          margin: 0 auto;
          width: 100%;
          box-sizing: border-box;
        }

        .progress-steps {
          display: flex;
          align-items: center;
          justify-content: center;
          max-width: 500px;
          margin: 0 auto;
        }

        .progress-step {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 12px;
          flex: 1;
        }

        .step-icon {
          width: 22px;
          height: 22px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: 600;
          font-size: 12px;
          background: var(--billhive-input-components-color, #e7ecf3);
          color: var(--billhive-text-color, #8094ae);
          transition: all 0.3s ease;
          font-family: var(--billhive-font-family);
        }

        .progress-step.active .step-icon {
          background: var(--billhive-accent-color, #145388);
          color: var(--billhive-header-color, white);
        }

        .progress-step.completed .step-icon {
          background: var(--billhive-accent-color, #145388);
          color: white;
        }

        .step-label {
          font-size: var(--billhive-font-size, 12px);
          font-weight: 500;
          color: var(--billhive-text-color, #8094ae);
          text-align: center;
          transition: color 0.3s ease;
          line-height: 1;
          font-family: var(--billhive-font-family);
        }

        .progress-step.active .step-label,
        .progress-step.completed .step-label {
          color: var(--billhive-text-color, #364a63);
        }

        .step-connector {
          flex: 1;
          height: 2px;
          background: var(--billhive-border-color, #e7ecf3);
          margin: 0 12px;
          position: relative;
          top: -12px;
        }

        .progress-step.completed + .step-connector {
          background: #10b981;
        }

        .modal-content {
          display: flex;
          flex: 1;
          overflow: hidden;
        }

        .page-body {
          flex: 2;
          overflow-y: auto;
          max-height: calc(82vh - 140px);
        }

        .page-sidebar {
          flex: 1;
          background: var(--billhive-disabled-color, #f8f9fb);
          border: 2px solid var(--billhive-border-color, #e7ecf3);
          border-radius: 8px;
          display: flex;
          flex-direction: column;
          max-height: calc(103vh - 200px); /* Full-page mode: account for header + stepper + padding */
        }

        /* Modal mode - when inside modal-container, use different max-height */
        :host([data-mode="modal"]) .page-sidebar {
          max-height: calc(85vh - 140px); /* Modal mode: account for modal padding */
        }

        .plan-section, .addons-section {
          margin-bottom: 15px;
        }

        .plan-section h3, .addons-section h3 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          margin: 0 0 12px 0;
          font-family: var(--billhive-font-family);
        }

        .selected-plan {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 12px;
          background: var(--billhive-disabled-color, #f8f9fb);
          border-radius: var(--billhive-card-border-radius, 8px);
          border: 2px solid var(--billhive-border-color, #e7ecf3);
        }

        .plan-info {
          display: flex;
          flex-direction: column;
          align-items: flex-start;
          flex: 1;
        }
        

        .selected-plan.loading {
          flex-direction: column;
          justify-content: center;
          align-items: center;
          gap: 12px;
          min-height: 70px;
        }

        .selected-plan.error {
          flex-direction: column;
          justify-content: center;
          align-items: center;
          gap: 12px;
          background: #fef5f5;
          border-color: #fed7d7;
          color: #c53030;
        }

        .selected-plan.default-plan {
          background: var(--billhive-highlight-panel-color, #f9fafb);
          border: 2px dashed var(--billhive-border-color, #e7ecf3);
        }

        .selected-plan.default-plan .plan-name {
          color: var(--billhive-sub-text-color, #8094ae);
        }

        .selected-plan.default-plan .value {
          color: var(--billhive-sub-text-color, #8094ae);
          font-style: italic;
        }

        .selected-plan.default-plan .price {
          color: var(--billhive-sub-text-color, #8094ae);
        }

        .selected-plan.default-plan .billing-info {
          color: var(--billhive-sub-text-color, #8094ae);
          font-style: italic;
        }

        .loading-spinner {
          width: 24px;
          height: 24px;
          border: 2px solid var(--billhive-loading-color, #e2e8f0);
          border-top: 2px solid var(--billhive-accent-color, #145388);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .error-icon {
          font-size: 18px;
        }

        .retry-btn {
          padding: 12px 14px;
          background: var(--billhive-accent-color, #145388);
          color: var(--billhive-header-color, white);
          border: none;
          border-radius: var(--billhive-card-border-radius, 4px);
          cursor: pointer;
          font-size: var(--billhive-text-font-size, 12px);
          font-family: var(--billhive-font-family);
          transition: all 0.2s ease;
        }

        .retry-btn:hover {
          background: var(--billhive-accent-hover, #0f3f65);
          box-shadow: var(--billhive-button-shadow, 0 2px 4px rgba(20, 83, 136, 0.3));
        }

        .product-name {
          display: block;
          color: #8094ae;
          font-size: 12px;
          margin-top: 12px;
        }

        .trial-info {
          display: flex;
          align-items: center;
          gap: 12px;
          margin-top: 12px;
          width: 100%;
        }

        .trial-badge {
          background: #38a169;
          color: white;
          padding: 12px 12px;
          border-radius: 12px;
          font-size: 12px;
          font-weight: 600;
        }

        .trial-details {
          color: #38a169;
          font-size: 12px;
          font-weight: 500;
        }

        .recommended-badge {
          background: var(--billhive-accent-color, #145388);
          color: var(--billhive-header-color, white);
          padding: 12px 12px;
          border-radius: 12px;
          font-size: 12px;
          font-weight: 600;
          margin-left: 12px;
        }

        .plan-header {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .plan-name {
        font-size: var(--billhive-font-size, 12px);
        font-weight: var(--billhive-header-font-weight, 600);
        }

        .plan-description {
          color: #8094ae;
          font-size: 12px;
          margin-bottom: 12px;
        }

        .plan-details {
          display: grid;
          gap: 12px;
          margin-bottom: 14px;
        }

        .detail-item {
          font-size: 12px;
          display: block;
          margin-bottom: 12px;
        }

        .detail-item .label {
          color: #8094ae;
          font-weight: 500;
          min-width: 80px;
        }

        .detail-item .value {
          color: #364a63;
          font-weight: 600;
        }

        .status-active {
          color: #38a169;
        }

        .status-inactive {
          color: #e53e3e;
        }

        .plan-features {
          display: flex;
          flex-direction: column;
          gap: 12px;
          margin-top: 14px;
        }

        .feature-item {
          font-size: 12px;
          color: #364a63;
        }

        .price-display {
          display: flex;
          align-items: baseline;
          gap: 12px;
        }

        .price {
          font-size: var(--billhive-header-font-size, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          font-family: var(--billhive-font-family);
        }

        .period {
          font-size: var(--billhive-font-size, 12px);
          color: var(--billhive-sub-text-color, #8094ae);
          font-family: var(--billhive-font-family);
        }

        .billing-info {
          font-size: var(--billhive-sub-header-font-size, 12px);
          color: var(--billhive-sub-text-color, #8094ae);
          margin-top: 12px;
          font-family: var(--billhive-font-family);
        }

        .plan-info h4 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          margin: 0 0 12px 0;
          font-family: var(--billhive-font-family);
        }

        .plan-info p {
          color: #8094ae;
          font-size: var(--billhive-font-size, 12px);
          margin: 0;
        }

        .plan-price .price {
          font-size: var(--billhive-font-size, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          font-family: var(--billhive-font-family);
        }

        .addons-grid {
          display: grid;
          gap: 14px;
        }

        .addon-card {
          padding: 12px;
          border: 2px solid #e7ecf3;
          border-radius: var(--billhive-card-border-radius, 8px);
          transition: all 0.2s ease;
          cursor: pointer;
          position: relative;
          background-color: var(--billhive-cards-color, white);
        }

        .addon-card:hover {
          border-color: var(--billhive-accent-color, #526484);
        }

        .addon-card.selected {
          border-color: var(--billhive-accent-color, #526484);
          background: var(--billhive-disabled-color, #f8f9fb);
        }

        .addon-card.recommended {
          border-color: #4CAF50;
        }

        .addon-badge {
          position: absolute;
          top: -12px;
          right: 12px;
          background: #4CAF50;
          color: white;
          padding: 2px 8px;
          border-radius: var(--billhive-card-border-radius, 4px);
          font-size: 12px;
          font-weight: 600;
        }

        .addon-quantity {
          margin: 0;
          font-size: var(--billhive-sub-header-font-size, 12px);
          color: var(--billhive-sub-text-color, #8094ae);
          text-align: right;
          font-family: var(--billhive-font-family);
        }

        .addon-quantity-control {
          margin-top: 12px;
          display: flex;
          flex-direction: column;
          align-items: flex-end;
          gap: 12px;
          font-size: var(--billhive-sub-header-font-size, 12px);
          color: var(--billhive-text-color, #364a63);
        }

        .quantity-input-group {
          display: flex;
          align-items: center;
          border: 1px solid #e7ecf3;
          border-radius: var(--billhive-card-border-radius, 4px);
          overflow: hidden;
          background: white;
        }

        .qty-btn {
          background: var(--billhive-accent-color, #526484);
          color: white;
          border: none;
          width: 28px;
          height: 28px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: background-color 0.2s ease;
          font-size: 14px;
          font-weight: 600;
        }

        .qty-btn:hover {
          background: var(--billhive-accent-color-hover, #455a77);
        }

        .qty-btn:disabled {
          background: #e7ecf3;
          color: #8094ae;
          cursor: not-allowed;
        }

        .addon-quantity-input {
          border: none;
          outline: none;
          font-size: var(--billhive-sub-header-font-size, 12px);
          font-family: var(--billhive-font-family);
          color: var(--billhive-text-color, #364a63);
          background: transparent;
        }

        .addon-quantity-input::-webkit-outer-spin-button,
        .addon-quantity-input::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }

        .addon-quantity-input[type=number] {
          -moz-appearance: textfield;
        }

        .loading-state, .error-state, .empty-state {
          padding: 20px;
          text-align: center;
          color: #666;
        }

        .error-state {
          color: #f44336;
        }

        .addon-content {
          display: flex;
          align-items: flex-start;
          gap: 14px;
        }

        .addon-left {
          flex: 1;
        }

        .addon-right {
          display: flex;
          align-items: flex-start;
        }

        .addon-price-section {
          display: flex;
          flex-direction: column;
          align-items: flex-end;
          gap: 12px;
        }

        .addon-label {
          display: flex;
          align-items: flex-start;
          gap: 12px;
          cursor: pointer;
        }

        .addon-info {
          flex: 1;
          text-align: left;
        }

        .addon-name {
          font-weight: 500;
          color: #364a63;
          display: block;
          margin-bottom: 12px;
          text-align: left;
          font-size: var(--billhive-font-size, 12px);
        }

        .addon-checkbox {
          width: 16px;
          height: 16px;
          accent-color: var(--billhive-accent-color, #526484);
          margin-top: 2px;
        }

        .addon-price {
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          font-size: var(--billhive-font-size, 12px);
          font-family: var(--billhive-font-family);
        }

        .addon-description {
          color: #8094ae;
          font-size: var(--billhive-sub-header-font-size, 12px);
          margin: 0;
          text-align: left;
        }

        .order-summary {
          display: flex;
          flex-direction: column;
          height: 100%;
        }

        .order-summary-content {
          flex: 1;
          padding: 15px;
          overflow-y: auto;
        }

        .order-summary h3 {
          font-size: var(--billhive-font-size-sub-heading, 16px);
          font-weight: 600;
          color: #364a63;
          margin: 0 0 8px 0;
        }

        .sidebar-footer {
          padding: 14px 15px 15px 15px;
          border-top: 1px solid #e7ecf3;
          background: #f8f9fb;
          margin-top: auto;
        }

        .loading-summary, .error-summary {
          padding: 18px;
          text-align: center;
          color: var(--billhive-sub-text-color, #64748b);
        }

        .loading-summary .spinner {
          width: 24px;
          height: 24px;
          border: 2px solid #e7ecf3;
          border-top-color: var(--billhive-primary-color, #F15A29);
          border-radius: 50%;
          margin: 0 auto 12px;
          animation: spin 0.8s linear infinite;
        }

        .error-summary {
          color: #dc2626;
        }

        .error-summary small {
          display: block;
          margin-top: 12px;
          font-size: 12px;
          opacity: 0.8;
        }

        .summary-item {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          padding: 6px 0;
          border-bottom: 1px solid #e7ecf3;
        }

        .item-details {
          display: flex;
          flex-direction: column;
          gap: 2px;
          flex: 1;
          text-align: left;
        }

        .item-name {
          color: #364a63;
          font-size: var(--billhive-font-size, 12px);
          font-weight: 500;
          text-align: left;
          margin: 0;
          padding: 0;
        }

        .item-dates {
          color: var(--billhive-sub-text-color, #8094ae);
          font-size: var(--billhive-sub-header-font-size, 12px);
          text-align: left;
          margin: 0;
          padding: 0;
        }

        .item-price {
          font-weight: 600;
          color: #364a63;
          font-size: var(--billhive-font-size, 12px);
          margin-left: 14px;
          white-space: nowrap;
        }

        .item-price.discount-price {
          color: #10b981;
        }

        .reserved-items-section {
          background: #fef2f2;
          border-radius: var(--billhive-card-border-radius, 12px);
          margin: 14px 0;
          padding: 12px;
        }

        .reserved-billing-date {
          color: #dc2626;
          font-size: var(--billhive-font-size, 12px);
          margin-bottom: 12px;
          text-align: left;
          padding-bottom: 12px;
        }

        .reserved-billing-date .billing-date-value {
          color: #364a63;
        }

        .reserved-item {
          margin-bottom: 12px;
        }

        .reserved-item:last-of-type {
          margin-bottom: 12px;
        }

        .reserved-subtotal {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding-top: 12px;
          margin-top: 12px;
        }

        .reserved-subtotal .subtotal-label {
          color: #dc2626;
          font-size: var(--billhive-font-size, 12px);
        }

        .reserved-subtotal .subtotal-price {
          color: #dc2626;
          font-size: var(--billhive-font-size, 12px);
        }

        .reserved-items-section .item-price {
          font-weight: normal;
        }

        .summary-divider {
          height: 1px;
          background: #e7ecf3;
          margin: 1px 0;
        }

        .loading-items,
        .error-items {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 24px 12px;
          gap: 12px;
        }

        .loading-items .spinner {
          width: 24px;
          height: 24px;
          border: 2px solid var(--billhive-border-color, #e2e8f0);
          border-top: 2px solid var(--billhive-accent-color, #145388);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        .loading-items p,
        .error-items p {
          margin: 0;
          font-size: var(--billhive-font-size, 12px);
          color: var(--billhive-sub-text-color, #8094ae);
        }

        .error-items p {
          color: #c53030;
        }

        .error-items small {
          font-size: var(--billhive-sub-header-font-size, 12px);
          color: var(--billhive-sub-text-color, #8094ae);
        }

        .loading-text {
          color: var(--billhive-sub-text-color, #8094ae);
          font-style: italic;
          font-size: var(--billhive-sub-header-font-size, 12px);
        }

        .summary-total {
          display: flex;
          justify-content: space-between;
          align-items: center;
          font-size: var(--billhive-font-size-sub-heading, 14px);
          font-weight: 700;
          color: #364a63;
          padding: 12px 0;
        }

        .proceed-btn {
          width: 100%;
          background: var(--billhive-accent-color, #526484);
          color: var(--billhive-header-color, white);
          border: 2px solid var(--billhive-accent-color, #526484);
          padding: 8px 15px;
          border-radius: var(--billhive-card-border-radius, 8px);
          font-size: var(--billhive-font-size, 12px);
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s ease;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 12px;
          margin: 0;
          font-family: var(--billhive-font-family);
        }

        .proceed-btn:hover:not(:disabled) {
          background: var(--billhive-accent-hover, #455670);
          border-color: var(--billhive-accent-hover, #455670);
          transform: translateY(-1px);
          box-shadow: var(--billhive-button-shadow, 0 4px 12px rgba(82, 100, 132, 0.3));
        }

        .proceed-btn:disabled {
          background: #e0e0e0;
          border-color: #e0e0e0;
          color: #999;
          cursor: not-allowed;
          opacity: 0.6;
        }

        .proceed-btn:disabled:hover {
          transform: none;
          box-shadow: none;
        }

        /* Available Discounts in Sidebar */
        .available-discounts-section {
          border-top: 1px solid #e7ecf3;
          padding-top: 14px;
          margin-top: 14px;
        }

        .available-discounts-section h4 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: 600;
          color: #364a63;
          margin: 0 0 12px 0;
        }

        .available-discounts-grid {
          display: grid;
          gap: 12px;
        }

        .available-discount-card {
          padding: 12px;
          border: 1px solid #e7ecf3;
          border-radius: var(--billhive-card-border-radius, 12px);
          transition: all 0.2s ease;
          cursor: pointer;
          background: white;
          background-color: var(--billhive-cards-color, white);
        }

        .available-discount-card:hover {
          border-color: var(--billhive-accent-color, #526484);
          background: var(--billhive-disabled-color, #f8f9fb);
        }

        .available-discount-card.selected {
          border-color: var(--billhive-accent-color, #526484);
          background: var(--billhive-accent-light, #f0f7ff);
        }

        .available-discount-card.applied {
          border-color: #10b981;
          background: #f0fdf4;
        }

        .discount-applied-badge {
          display: inline-block;
          color: #10b981;
          font-size: var(--billhive-sub-header-font-size, 12px);
          font-weight: 600;
          margin-top: 12px;
        }

        .available-discount-card .remove-discount-btn {
          background: transparent;
          color: #dc2626;
          border: none;
          width: 24px;
          height: 24px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          font-size: 24px;
          font-weight: bold;
          transition: color 0.2s;
          padding: 0;
          line-height: 1;
        }

        .available-discount-card .remove-discount-btn:hover {
          color: #b91c1c;
        }

        .available-discount-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 4px;
        }

        .available-discount-name {
          font-weight: 600;
          color: #364a63;
          font-size: var(--billhive-font-size, 12px);
        }

        .available-discount-value {
          font-weight: 600;
          color: var(--billhive-text-color, #364a63);
          font-size: var(--billhive-font-size, 12px);
        }

        .available-discount-description {
          color: #8094ae;
          font-size: var(--billhive-sub-header-font-size, 12px);
          margin: 0 0 12px 0;
          line-height: 1.3;
        }

        .available-discount-code {
          font-size: var(--billhive-sub-header-font-size, 12px);
          color: var(--billhive-text-color, #364a63);
          background: var(--billhive-input-components-color, #e7ecf3);
          padding: 3px 12px;
          border-radius: var(--billhive-card-border-radius, 12px);
          font-weight: 500;
          font-family: var(--billhive-font-family);
        }

        /* Loading and error states for offers */
        .loading-offers {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 14px;
          text-align: center;
          color: var(--billhive-sub-text-color, #8094ae);
          font-size: var(--billhive-sub-header-font-size, 12px);
        }

        .loading-offers .spinner {
          width: 16px;
          height: 16px;
          border: 2px solid var(--billhive-disabled-color, #e7ecf3);
          border-top: 2px solid var(--billhive-accent-color, #526484);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .offers-error {
          padding: 14px;
          text-align: center;
          color: var(--billhive-error-color, #dc2626);
          font-size: var(--billhive-sub-header-font-size, 12px);
        }

        .offers-error p {
          margin: 0;
        }

        .no-offers {
          padding: 14px;
          text-align: center;
          color: var(--billhive-sub-text-color, #8094ae);
          font-size: var(--billhive-sub-header-font-size, 12px);
          margin: 0;
          font-style: italic;
        }

        /* Coupon styles */
        .coupon-section {
          border-top: 1px solid #e7ecf3;
          padding-top: 14px;
          margin-top: 14px;
        }

        .coupon-section h4 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: 600;
          color: #364a63;
          margin: 0 0 12px 0;
        }

        .coupon-input-group {
          display: flex;
          gap: 12px;
          margin-bottom: 12px;
        }

        .coupon-input-group input {
          flex: 1;
          padding: 8px;
          border: 1px solid var(--billhive-border-color, #e7ecf3);
          border-radius: var(--billhive-card-border-radius, 4px);
          font-size: var(--billhive-font-size, 12px);
          font-family: var(--billhive-font-family);
        }

        .coupon-input-group input:focus {
          outline: none;
          border-color: var(--billhive-accent-color, #526484);
        }

        .apply-coupon-btn {
          padding: 8px 12px;
          background: var(--billhive-accent-color, #526484);
          color: var(--billhive-header-color, white);
          border: none;
          border-radius: var(--billhive-card-border-radius, 4px);
          font-size: var(--billhive-font-size, 12px);
          font-weight: 500;
          cursor: pointer;
          transition: background 0.2s ease;
          font-family: var(--billhive-font-family);
        }

        .apply-coupon-btn:hover {
          background: var(--billhive-accent-hover, #455670);
        }

        .coupon-message {
          font-size: var(--billhive-font-size, 12px);
          padding: 12px;
          border-radius: var(--billhive-card-border-radius, 4px);
          margin-bottom: 12px;
        }

        .coupon-message.success {
          background: #d4edda;
          color: #155724;
          border: 1px solid #c3e6cb;
        }

        /* Order Confirmation Styles */
        .confirmation-container {
          max-width: 600px;
          margin: 0 auto;
        }

        .confirmation-success {
          text-align: center;
          margin-bottom: 24px;
        }

        .success-icon-large {
          display: inline-flex;
          margin-bottom: 14px;
        }

        .confirmation-success h2 {
          font-size: var(--billhive-header-font-size, 24px);
          font-weight: 700;
          color: #10b981;
          margin: 0 0 12px 0;
        }

        .confirmation-message {
          color: #8094ae;
          font-size: var(--billhive-font-size, 12px);
          margin: 0;
        }

        .confirmation-details {
          background: #f8f9fb;
          border-radius: var(--billhive-card-border-radius, 8px);
          padding: 14px;
        }

        .confirmation-details h3 {
          font-size: var(--billhive-font-size-sub-heading, 16px);
          font-weight: 600;
          color: #364a63;
          margin: 0 0 12px 0;
        }

        .detail-section {
          margin-bottom: 12px;
          padding-bottom: 12px;
          border-bottom: 1px solid #e7ecf3;
        }

        .detail-section:last-of-type {
          border-bottom: none;
          margin-bottom: 0;
          padding-bottom: 0;
        }

        .detail-section h4 {
          font-size: 12px;
          font-weight: 600;
          color: #8094ae;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          margin: 0 0 4px 0;
        }

        .detail-row {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 3px 0;
        }

        .detail-label {
          color: #8094ae;
          font-size: 12px;
        }

        .detail-value {
          color: #364a63;
          font-weight: 600;
          font-size: 12px;
        }

        .discount-row .detail-value {
          color: #10b981;
        }

        .total-row {
          border-top: 2px solid #e7ecf3;
          margin-top: 12px;
          padding-top: 14px;
        }

        .total-row .detail-label,
        .total-row .detail-value {
          font-size: 12px;
          font-weight: 700;
        }

        .confirmation-note {
          background: #f0fdf4;
          border: 1px solid #10b981;
          border-radius: var(--billhive-card-border-radius, 12px);
          padding: 12px;
          margin-top: 14px;
        }

        .confirmation-note p {
          color: var(--billhive-text-color, #364a63);
          font-size: var(--billhive-font-size, 12px);
          margin: 12px 0;
          font-family: var(--billhive-font-family);
        }

        .confirmation-note p:first-child {
          margin-top: 0;
        }

        .confirmation-note p:last-child {
          margin-bottom: 0;
        }

        .confirmation-actions h3 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          margin: 0 0 12px 0;
          font-family: var(--billhive-font-family);
        }

        .next-steps {
          display: flex;
          flex-direction: column;
          gap: 14px;
        }

        .next-step {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .step-number {
          width: 26px;
          height: 26px;
          background: var(--billhive-input-components-color, #e7ecf3);
          color: var(--billhive-text-color, #364a63);
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: var(--billhive-header-font-weight, 600);
          font-size: var(--billhive-font-size, 12px);
          flex-shrink: 0;
          font-family: var(--billhive-font-family);
        }

        .step-text {
          color: var(--billhive-text-color, #364a63);
          font-size: var(--billhive-font-size, 12px);
          line-height: 1.3;
          font-family: var(--billhive-font-family);
        }

        .close-confirmation-btn {
          width: 100%;
          background: var(--billhive-input-components-color, #e7ecf3);
          color: var(--billhive-text-color, #364a63);
          border: none;
          padding: 12px 15px;
          border-radius: var(--billhive-card-border-radius, 8px);
          font-size: var(--billhive-font-size, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          cursor: pointer;
          margin-top: 12px;
          transition: all 0.2s ease;
          font-family: var(--billhive-font-family);
        }

        .close-confirmation-btn:hover {
          background: var(--billhive-border-color, #d4dae6);
        }

        .coupon-message.error {
          background: #f8d7da;
          color: #721c24;
          border: 1px solid #f5c6cb;
        }

        .applied-coupon {
          display: flex;
          justify-content: space-between;
          align-items: center;
          background: #d4edda;
          padding: 12px;
          border-radius: var(--billhive-card-border-radius, 4px);
          border: 1px solid #c3e6cb;
        }

        .coupon-error {
          background: #fef2f2;
          border: 1px solid #fecaca;
          color: #dc2626;
          padding: 12px;
          border-radius: var(--billhive-card-border-radius, 4px);
          font-size: var(--billhive-sub-header-font-size, 12px);
          margin-top: 12px;
        }

        .coupon-name {
          color: #155724;
          font-weight: 500;
          font-size: var(--billhive-font-size, 12px);
          font-family: var(--billhive-font-family);
        }

        .remove-coupon-btn {
          background: none;
          border: none;
          color: #155724;
          font-size: 14px;
          font-weight: bold;
          cursor: pointer;
          padding: 0;
          width: 20px;
          height: 20px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .remove-coupon-btn:hover {
          background: rgba(21, 87, 36, 0.1);
          border-radius: 50%;
        }

        /* Updated summary styles */
        .summary-subtotal {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 2px 0;
          color: var(--billhive-sub-text-color, #8094ae);
          font-size: var(--billhive-font-size, 14px);
          font-family: var(--billhive-font-family);
        }

        .summary-discount {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 2px 0;
          color: #10b981;
          font-size: var(--billhive-font-size, 14px);
          font-family: var(--billhive-font-family);
        }

        .summary-tax {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 2px 0;
          color: var(--billhive-sub-text-color, #8094ae);
          font-size: var(--billhive-font-size, 14px);
          font-family: var(--billhive-font-family);
        }

        .discount-amount {
          font-weight: 600;
        }

        .savings-notice {
          text-align: center;
          color: #10b981;
          font-weight: var(--billhive-header-font-weight, 600);
          font-size: var(--billhive-font-size, 12px);
          padding: 12px;
          background: #f0fdf4;
          border-radius: var(--billhive-card-border-radius, 4px);
          margin-top: 12px;
          font-family: var(--billhive-font-family);
        }

        .discount-group .item-name {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .discount-info-icon {
          position: relative;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 16px;
          height: 16px;
          background: var(--billhive-input-components-color, #e7ecf3);
          color: var(--billhive-text-color, #364a63);
          border-radius: 50%;
          font-size: 12px;
          font-weight: bold;
          cursor: help;
          transition: all 0.2s ease;
        }

        .discount-info-icon:hover {
          background: var(--billhive-primary-color, #2563eb);
          color: white;
        }

        .discount-tooltip {
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          background: white;
          border: 1px solid var(--billhive-border-color, #d4dae6);
          border-radius: var(--billhive-card-border-radius, 4px);
          padding: 12px;
          min-width: 200px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
          z-index: 1000;
          display: none;
          margin-bottom: 12px;
        }

        .discount-info-icon:hover .discount-tooltip {
          display: block;
        }

        .discount-tooltip::after {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          border: 12px solid transparent;
          border-top-color: white;
        }

        .discount-tooltip::before {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          border: 7px solid transparent;
          border-top-color: var(--billhive-border-color, #d4dae6);
          margin-top: -1px;
        }

        .tooltip-title {
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          margin-bottom: 12px;
          font-size: var(--billhive-sub-header-font-size, 12px);
        }

        .tooltip-item {
          color: var(--billhive-sub-text-color, #8094ae);
          font-size: var(--billhive-sub-header-font-size, 12px);
          padding: 12px 0;
        }

        @media (max-width: 768px) {
          .modal-container {
            margin: 14px;
            min-height: 500px;
            max-height: calc(100vh - 24px);
          }

          .modal-content {
            flex-direction: column;
          }

          .page-sidebar {
            border-left: none;
            border-top: 1px solid #e7ecf3;
          }

          .page-body {
            padding: 18px;
          }
          
          .order-summary-content {
            padding: 18px;
          }
          
          .sidebar-footer {
            padding: 14px 18px 18px 18px;
          }

          .selected-plan {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
          }

          .coupon-input-group {
            flex-direction: column;
          }

          .apply-coupon-btn {
            width: 100%;
          }
        }

        /* Personal Details Form Styles */
        .personal-details-form {
          max-width: 600px;
          text-align: left !important; /* Override any external text-center */
        }
        
        /* Prevent external pricing styles from affecting this form */
        .personal-details-form.pricing,
        .personal-details-form.text-center {
          text-align: left !important;
        }

        .personal-details-form h3 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          margin: 0 0 12px 0;
          padding-bottom: 12px;
          border-bottom: 1px solid var(--billhive-border-color, #e7ecf3);
          font-family: var(--billhive-font-family);
        }

        .form-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 14px;
          margin-bottom: 18px;
        }

        .form-group {
          display: flex;
          flex-direction: column;
          width: 100%
        }

        .form-group.full-width {
          grid-column: 1 / -1;
        }

        .form-group label {
          font-weight: 500;
          color: var(--billhive-text-color, #364a63);
          margin-bottom: 12px;
          font-size: var(--billhive-font-size, 12px);
          font-family: var(--billhive-font-family);
        }

        .form-group input,
        .form-group select {
          padding: 8px;
          border: 2px solid var(--billhive-border-color, #e7ecf3);
          border-radius: var(--billhive-card-border-radius, 12px);
          font-size: var(--billhive-font-size, 12px);
          transition: border-color 0.2s ease;
          font-family: var(--billhive-font-family);
          background: var(--billhive-input-components-color, #f8f9fb);
        }

        .form-group input:focus,
        .form-group select:focus {
          outline: none;
          border-color: var(--billhive-accent-color, #526484);
        }

        .form-group input.error,
        .form-group select.error {
          border-color: var(--billhive-error-color, #e85347);
        }

        .field-error {
          color: var(--billhive-error-color, #e85347);
          font-size: var(--billhive-sub-header-font-size, 12px);
          margin-top: 12px;
          display: none;
          font-family: var(--billhive-font-family);
        }

        .form-actions {
          display: flex;
          gap: 14px;
        }

        .back-btn {
          background: var(--billhive-cards-color, #ffffff);
          color: var(--billhive-text-color, #364a63);
          border: 2px solid var(--billhive-border-color, #e7ecf3);
          font-weight: 600;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
        }

        .back-btn:hover {
          background: var(--billhive-disabled-color, #f8f9fb);
          border-color: var(--billhive-accent-color, #526484);
          color: var(--billhive-accent-color, #526484);
          transform: translateY(-1px);
        }

        .sidebar-footer .proceed-btn {
          flex: 1;
          min-width: 180px;
        }

        .proceed-btn:hover:not(:disabled) {
          background: var(--billhive-accent-hover, #455670);
          border-color: var(--billhive-accent-hover, #455670);
          transform: translateY(-1px);
          box-shadow: var(--billhive-button-shadow, 0 4px 12px rgba(82, 100, 132, 0.3));
        }

        .proceed-btn:disabled {
          background: #e0e0e0;
          border-color: #e0e0e0;
          color: #999;
          cursor: not-allowed;
          opacity: 0.6;
        }

        .proceed-btn:disabled:hover {
          transform: none;
          box-shadow: none;
        }

        @media (max-width: 768px) {
          .modal-container {
            margin: 14px;
            min-height: 500px;
            max-height: calc(100vh - 24px);
          }

          .modal-content {
            flex-direction: column;
          }

          .page-sidebar {
            border-left: none;
            border-top: 1px solid #e7ecf3;
          }

        
          .page-body {
            padding: 18px;
          }
          
          .order-summary-content {
            padding: 18px;
          }
          
          .sidebar-footer {
            padding: 14px 18px 18px 18px;
          }

          .selected-plan {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
          }

          .coupon-input-group {
            flex-direction: column;
          }

          .apply-coupon-btn {
            width: 100%;
          }

          .form-grid {
            grid-template-columns: 1fr;
          }

          .form-actions {
            flex-direction: column-reverse;
            gap: 12px;
          }

          .back-btn,
          .proceed-btn {
            width: 100%;
            min-width: unset;
            justify-content: center;
          }

          .proceed-btn {
            flex: none;
          }
        }

        /* Payment Method Styles */
        .payment-methods-section {
          max-width: 600px;
        }

        .payment-methods-section h3 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          margin: 0 0 14px 0;
          padding-bottom: 12px;
          border-bottom: 1px solid var(--billhive-border-color, #e7ecf3);
          font-family: var(--billhive-font-family);
        }

        .payment-methods-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
          gap: 12px;
          margin-bottom: 14px;
        }

        .payment-method-card {
          padding: 12px;
          border: 2px solid var(--billhive-border-color, #e7ecf3);
          border-radius: var(--billhive-card-border-radius, 12px);
          cursor: pointer;
          transition: all 0.2s ease;
          text-align: center;
          background: var(--billhive-cards-color, #ffffff);
          position: relative;
          user-select: none;
          min-height: 90px;
        }

        .payment-method-card:hover {
          border-color: var(--billhive-accent-color, #526484);
          background: var(--billhive-disabled-color, #f8f9fb);
        }

        .payment-method-card.selected {
          border-color: var(--billhive-accent-color, #526484);
          background: var(--billhive-disabled-color, #f8f9fb);
        }

        .payment-method-icon {
          font-size: 24px;
          margin-bottom: 12px;
          display: block;
        }

        .payment-method-name {
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          font-size: var(--billhive-font-size, 12px);
          font-family: var(--billhive-font-family);
        }

        .payment-form {
          background: #f8f9fb;
          padding: 18px;
          border-radius: var(--billhive-card-border-radius, 8px);
          border: 1px solid #e7ecf3;
          margin-top: 14px;
        }

        .payment-form .form-group label {
          text-align: left !important;
          display: block;
        }

        .payment-form .form-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 14px;
        }

        .cashfree-input-container {
          min-height: 44px;
          background: var(--billhive-surface, #fff);
          border-radius: var(--billhive-card-border-radius, 12px);
          position: relative;
        }

        .cashfree-input-container iframe {
          width: 100% !important;
          height: 44px !important;
        }

        .cashfree-loading {
          text-align: center;
          padding: 20px;
          color: var(--billhive-text-secondary, #666);
        }

        .cashfree-loading p {
          margin: 0;
          font-size: var(--billhive-font-size, 12px);
        }

        .wallet-options {
          margin-bottom: 14px;
        }

        .wallet-section-label {
          display: block;
          font-weight: 500;
          color: var(--billhive-text-color, #364a63);
          margin-bottom: 12px;
          font-size: var(--billhive-font-size, 12px);
          font-family: var(--billhive-font-family);
          text-align: left !important;
        }

        .wallet-providers {
          display: grid;
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .wallet-provider-container {
          position: relative;
        }

        .cashfree-wallet-container {
          min-height: 48px;
          background: var(--billhive-surface, #fff);
          border-radius: var(--billhive-card-border-radius, 4px);
          position: relative;
        }

        .cashfree-wallet-container iframe {
          width: 100% !important;
          min-height: 48px !important;
        }

        .wallet-note {
          background: var(--billhive-input-components-color, #f9fafb);
          padding: 12px;
          border-radius: var(--billhive-card-border-radius, 4px);
          border-left: 4px solid var(--billhive-accent-color, #5b5bd6);
          font-size: var(--billhive-sub-header-font-size, 12px);
          color: var(--billhive-sub-text-color, #6b7280);
          margin-top: 14px;
        }

        .upi-note,
        .netbanking-note {
          background: var(--billhive-accent-light, #e8f4fd);
          padding: 12px;
          border-radius: var(--billhive-card-border-radius, 12px);
          border-left: 4px solid var(--billhive-accent-color, #526484);
          margin-top: 14px;
        }

        .upi-note p,
        .netbanking-note p {
          margin: 0;
          color: var(--billhive-text-color, #364a63);
          font-size: var(--billhive-font-size, 12px);
          line-height: 1.4;
          font-family: var(--billhive-font-family);
        }

        @media (max-width: 768px) {
          .payment-methods-grid {
            grid-template-columns: repeat(2, 1fr);
          }

          .payment-method-card {
            padding: 12px;
          }

          .payment-method-icon {
            font-size: 18px;
          }

          .payment-form .form-grid {
            grid-template-columns: 1fr;
          }
        }

        /* Payment Form Section Styles */
        .payment-form-section {
          max-width: 600px;
        }

        .selected-method-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 18px;
          padding-bottom: 14px;
          border-bottom: 1px solid #e7ecf3;
        }

        .change-method-btn {
          display: flex;
          align-items: center;
          gap: 12px;
          background: var(--billhive-cards-color, #ffffff);
          color: var(--billhive-text-color, #364a63);
          border: 2px solid var(--billhive-border-color, #e7ecf3);
          padding: 12px 14px;
          border-radius: var(--billhive-card-border-radius, 12px);
          font-size: var(--billhive-font-size, 12px);
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s ease;
        }

        .change-method-btn:hover {
          background: var(--billhive-disabled-color, #f8f9fb);
          border-color: var(--billhive-accent-color, #526484);
          color: var(--billhive-accent-hover, #455670);
        }

        .selected-method-header h3 {
          margin: 0;
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          font-family: var(--billhive-font-family);
        }

        @media (max-width: 768px) {
          .selected-method-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 14px;
          }

          .change-method-btn {
            order: 2;
            align-self: flex-end;
          }

          /* Mobile stepper styles */
          .progress-steps {
            max-width: 100%;
          }

          .step-label {
            font-size: 12px;
            line-height: 1.1;
          }

          .step-icon {
            width: 24px;
            height: 24px;
            font-size: 12px;
          }

          .step-connector {
            margin: 0 12px;
            top: -12px;
          }
        }
        
        .payment-method-card .payment-icon {
          margin-bottom: 12px;
        }
        
        .payment-method-card h4 {
          font-size: var(--billhive-font-size, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          margin: 0 0 12px 0;
          font-family: var(--billhive-font-family);
        }
        
        .payment-method-card p {
          font-size: var(--billhive-sub-header-font-size, 12px);
          color: var(--billhive-sub-text-color, #8094ae);
          margin: 0;
          line-height: 1.2;
          font-family: var(--billhive-font-family);
        }
      </style>
    `}}customElements.define("bh-checkout",P),typeof module<"u"&&module.exports&&(module.exports=P)})();

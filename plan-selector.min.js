(function(){"use strict";const f={baseUrl:"http://localhost:4001",endpoints:{pricingTable:l=>`/products/${l}/pricing-table`,products:"/products",subscriptions:"/subscriptions"},headers:{"Content-Type":"application/json",Accept:"application/json"},getAuthHeaders(){return{...this.headers,"api-key":this.apiKey}},getPricingTableUrl(l=null){const e=l||this.productId;return`${this.baseUrl}${this.endpoints.pricingTable(e)}`}};typeof module<"u"&&module.exports&&(module.exports=f),typeof window<"u"&&(window.ApiConfig=f);function w(l,e=null){let t="";switch(console.log("generateThemeCSS :",l),e){case"Pricing-Table":return l.branding&&(l.branding.primaryColor&&(t+=`--billhive-primary-color: ${l.branding.primaryColor};
    `),l.branding.backgroundColor&&(t+=`--billhive-background-color: ${l.branding.backgroundColor};
    `)),l.header&&(l.header.color&&(t+=`--billhive-header-text-color: ${l.header.color};
    `),l.header.fontSize&&(t+=`--billhive-header-font-size: ${l.header.fontSize}px;
    `),l.header.fontWeight&&(t+=`--billhive-header-font-weight: ${l.header.fontWeight};
    `)),l.card&&(l.card.backgroundColor&&(t+=`--billhive-card-background-color: ${l.card.backgroundColor};
    `),l.card.headerColor&&(t+=`--billhive-card-header-color: ${l.card.headerColor};
    `),l.card.textColor&&(t+=`--billhive-card-text-color: ${l.card.textColor};
    `),l.card.borderColor&&(t+=`--billhive-card-border-color: ${l.card.borderColor};
    `),l.card.headerFontSize&&(t+=`--billhive-card-header-font-size: ${l.card.headerFontSize}px;
    `),l.card.textFontSize&&(t+=`--billhive-card-text-font-size: ${l.card.textFontSize}px;
    `),l.card.headerFontWeight&&(t+=`--billhive-card-header-font-weight: ${l.card.headerFontWeight};
    `),l.card.shadow&&(t+=`--billhive-card-shadow: ${{small:"0 1px 3px rgba(0, 0, 0, 0.12)",medium:"0 4px 6px rgba(0, 0, 0, 0.1)",large:"0 10px 15px rgba(0, 0, 0, 0.1)"}[l.card.shadow]||l.card.shadow};
    `)),l.notes&&l.notes.fontSize&&(t+=`--billhive-font-size-foot-notes: ${l.notes.fontSize}px;
    `),`
    :host {
      ${t.trim()}
    }
  `}return l.theme&&typeof l.theme=="object"&&(l.theme.colors&&Object.entries(l.theme.colors).forEach(([i,o])=>{let a;switch(i){case"accent":a="--billhive-accent-color";break;case"header":a="--billhive-header-color";break;case"highlightPanel":a="--billhive-highlight-panel-color";break;case"card":a="--billhive-cards-color";break;case"inputComponent":a="--billhive-input-components-color";break;case"text":a="--billhive-text-color";break;case"subText":a="--billhive-sub-text-color";break;case"borders":a="--billhive-border-color";break;case"accentHover":a="--billhive-accent-hover";break;case"accentLight":a="--billhive-accent-light";break;default:a=`--billhive-${i.replace(/([A-Z])/g,"-$1").toLowerCase()}-color`}t+=`${a}: ${o};
    `}),l.theme.typography&&Object.entries(l.theme.typography).forEach(([i,o])=>{const a=`--billhive-${i.replace(/([A-Z])/g,"-$1").toLowerCase()}`;t+=`${a}: ${o};
    `}),l.theme.shadows&&Object.entries(l.theme.shadows).forEach(([i,o])=>{let a;switch(i){case"card":a="--billhive-card-shadow";break;case"modal":a="--billhive-modal-shadow";break;case"button":a="--billhive-button-shadow";break;default:a=`--billhive-${i}-shadow`}t+=`${a}: ${o};
    `}),l.layout&&(t+=`--billhive-layout: ${l.layout};
    `)),console.log("generateThemeCSS Response :",t),`
    :host {
      ${t.trim()}
    }
  `}function C(l){if(console.log("Merging themes. Custom theme:",l),!l)throw new Error("mergeThemes: customTheme is required and cannot be null or undefined");if(!l.theme)throw new Error('mergeThemes: customTheme must have a "theme" property containing colors, typography, and shadows');if(!l.theme.colors)throw new Error("mergeThemes: theme.colors section is required");if(!l.theme.typography)throw new Error("mergeThemes: theme.typography section is required");if(["accent","text"].forEach(i=>{if(!l.theme.colors[i])throw new Error(`mergeThemes: Required color property missing: theme.colors.${i}`)}),!l.theme.typography.fontFamily)throw new Error("mergeThemes: Required typography property missing: theme.typography.fontFamily");const t=JSON.parse(JSON.stringify(l));return console.log("Processed theme:",t),t}function y(l){let e=l.replace("#","");e.length===8&&(e=e.substr(0,6));const t=parseInt(e.substr(0,2),16),i=parseInt(e.substr(2,2),16),o=parseInt(e.substr(4,2),16),a=Math.floor(t*.8),n=Math.floor(i*.8),s=Math.floor(o*.8);return{theme:{colors:{accentHover:`#${a.toString(16).padStart(2,"0")}${n.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`,accentLight:`rgba(${t}, ${i}, ${o}, 0.1)`},shadows:{button:`0 2px 4px rgba(${t}, ${i}, ${o}, 0.3)`}}}}function k(l){if(!l)throw new Error("validateTheme: theme is required and cannot be null or undefined");if(!l.theme)throw new Error('validateTheme: Theme must have a "theme" property containing colors, typography, and shadows');const e=l.theme;if(!e.colors)throw new Error("validateTheme: Missing theme.colors section");if(["accent","text"].forEach(o=>{if(!e.colors[o])throw new Error(`validateTheme: Missing required color property: theme.colors.${o}`)}),Object.entries(e.colors).forEach(([o,a])=>{if(a&&typeof a=="string"&&!a.match(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{8}|[A-Fa-f0-9]{3})|rgba?\(.*\)$/))throw new Error(`validateTheme: Invalid color format for theme.colors.${o}: ${a}`)}),!e.typography)throw new Error("validateTheme: Missing theme.typography section");if(["fontFamily"].forEach(o=>{if(!e.typography[o])throw new Error(`validateTheme: Missing required typography property: theme.typography.${o}`)}),l.layout&&!["in-app","full-page"].includes(l.layout))throw new Error(`validateTheme: Invalid layout value: ${l.layout}. Must be 'in-app' or 'full-page'`)}class P extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.selectedPlan=null,this.productId=null,this.planId=null,this.apiKey=null,this.isLoadingPlan=!1,this.planLoadError=null,this.addons=[],this.selectedAddons=new Set,this.addonQuantities=new Map,this.isLoadingAddons=!1,this.addonsLoadError=null,this.isVisible=!1,this.couponCode="",this.appliedCoupon=null,this.availableDiscounts=[],this.selectedDiscount=null,this.isLoadingOffers=!1,this.offersLoadError=null,this.updateTimeout=null,this.orderEstimate=null,this.isLoadingEstimate=!1,this.estimateError=null,this.estimateRequestId=0,this.currentModalStep="plan-selection",this.existingAccount=null,this.isCheckingExistingAccount=!1,this.createdOrder=null,this.isCreatingOrder=!1,this.orderCreated=!1,this.orderInvoices=[],this.isLoadingInvoices=!1,this.personalDetails={firstName:"",lastName:"",email:"",phone:"",company:"",address:{addressLine:"",city:"",state:"",zipCode:"",country:""}},this.formErrors={},this.selectedPaymentMethod="",this.orderData=null,this.paymentDetails={card:{cardNumber:"",expiryDate:"",cvv:"",cardholderName:""},upi:{upiId:""},netbanking:{bankName:""},wallet:{walletType:"",walletNumber:""}},this.theme={},this.cashfreeInstance=null,this.cashfreeComponents={cardNumber:null,cardHolder:null,cardExpiry:null,cardCvv:null,upiCollect:null,wallets:new Map}}get themeData(){return this.theme}set themeData(e){e&&typeof e=="object"&&this.applyThemeData(e)}applyThemeData(e){var t,i;try{const o=k(e);if(o.isValid){this.theme=C(e);const a=((i=(t=e.theme)==null?void 0:t.colors)==null?void 0:i.accent)||e.accentColor;if(a){const n=y(a);this.theme={...this.theme,theme:{...this.theme.theme,colors:{...this.theme.theme.colors,...n.theme.colors},shadows:{...this.theme.theme.shadows,...n.theme.shadows}}}}console.log("Checkout programmatic theme applied:",this.theme),this.render()}else console.warn("Invalid themeData configuration:",o.errors)}catch(o){console.warn("Error applying themeData:",o)}}static get observedAttributes(){return["product-id","data-plan-id","api-key","visible","data-theme"]}connectedCallback(){this.loadData(),this.loadCashfreeSDK(),this.setupEventListeners()}async loadCashfreeSDK(){try{if(window.Cashfree){console.log("Cashfree SDK already loaded globally"),this.cashfreeInstance=window.Cashfree;return}const e=document.createElement("script");e.src="https://sdk.cashfree.com/js/v3/cashfree.js",e.async=!0,await new Promise((t,i)=>{e.onload=()=>{console.log("Cashfree SDK script loaded"),window.Cashfree?(this.cashfreeInstance=new window.Cashfree({mode:"sandbox"}),console.log("✅ Cashfree SDK initialized successfully"),t()):i(new Error("Cashfree object not found after script load"))},e.onerror=i,document.head.appendChild(e)})}catch(e){console.error("❌ Failed to load Cashfree SDK:",e)}}attributeChangedCallback(e,t,i){t!==i&&(e==="product-id"?this.productId=i:e==="data-plan-id"?this.planId=i:e==="api-key"?this.apiKey=i:e==="visible"?(this.isVisible=i==="true",this.isVisible&&this.render()):e==="data-theme"&&(this.loadTheme(),this.render()))}loadData(){this.productId=this.getAttribute("product-id"),this.planId=this.getAttribute("data-plan-id"),this.apiKey=this.getAttribute("api-key"),this.planId||(this.addons=[],this.selectedPlan=null),this.isVisible=this.getAttribute("visible")==="true",this.loadTheme()}loadTheme(){var i,o,a,n;this.theme={};const e=((o=(i=this.theme.theme)==null?void 0:i.colors)==null?void 0:o.accent)||this.theme.accentColor;if(e){const s=y(e);this.theme={...this.theme,theme:{...this.theme.theme,colors:{...this.theme.theme.colors,...s.theme.colors},shadows:{...this.theme.theme.shadows,...s.theme.shadows}}}}console.log("Checkout theme loaded:",this.theme);const t=this.getAttribute("data-theme");if(console.log("themeAtr :",t),t)try{const s=JSON.parse(t),d=k(s);if(d.isValid){this.theme=C(s);const c=((n=(a=s.theme)==null?void 0:a.colors)==null?void 0:n.accent)||s.accentColor;if(c){const r=y(c);this.theme={...this.theme,theme:{...this.theme.theme,colors:{...this.theme.theme.colors,...r.theme.colors},shadows:{...this.theme.theme.shadows,...r.theme.shadows}}}}console.log("Checkout custom theme applied:",this.theme)}else console.warn("Invalid theme configuration:",d.errors)}catch(s){console.warn("Invalid JSON in data-theme attribute:",s)}}loadPlan(){this.selectedPlan=null}async loadPlanFromApi(){var e;if(this.planId){this.isLoadingPlan=!0,this.planLoadError=null;try{const i=`${((e=window.ApiConfig)==null?void 0:e.baseUrl)||f.baseUrl}/rate-plan-prices/${this.planId}`,o=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const a=await o.json();this.selectedPlan=this.transformPlanApiData(a),this.isLoadingPlan=!1,this.planLoadError=null,this.render(),this.loadAddonsFromApi().catch(n=>{console.error("Failed to load addons:",n)}),this.loadApplicableOffers().catch(n=>{console.error("Failed to load applicable offers:",n)}),this.updateOrderSummary()}catch(t){this.planLoadError=t.message,this.isLoadingPlan=!1,this.isLoadingAddons=!1,this.loadPlan(),this.addons=[],this.render()}}}transformPlanApiData(e){var i,o,a;return{id:e.ratePlanId,ratePlanPriceId:e.ratePlanPriceId,name:e.name||e.externalName,description:e.description,price:e.price,currencyCode:e.currencyCode,period:((i=e.billingPeriod)==null?void 0:i.periodName)||((o=e.billingPeriod)==null?void 0:o.period),periodName:(a=e.billingPeriod)==null?void 0:a.periodName,billingPeriod:e.billingPeriod,features:e.addons||e.features||[],recommended:e.mostPopular||!1,planLevel:e.planLevel,isTrial:e.isTrial,trialPeriod:e.trialPeriod,ratePlanKey:e.ratePlanKey,productName:e.productName,productId:e.productId,status:e.status,isVisibleInPortal:e.isVisibleInPortal,isVisibleInCheckout:e.isVisibleInCheckout,requireBillingAtSignup:e.requireBillingAtSignup,autoRenew:e.autoRenew,termLength:e.termLength,taxIncluded:e.taxIncluded,pricingModel:e.pricingModel,billingCycle:e.billingCycle}}async loadAddonsFromApi(){var e,t;if(!((e=this.selectedPlan)!=null&&e.ratePlanPriceId)){this.addons=[];return}this.isLoadingAddons=!0,this.addonsLoadError=null;try{const i=((t=window.ApiConfig)==null?void 0:t.baseUrl)||f.baseUrl,o=encodeURIComponent('{"where":{"applicability":{"neq":"Mandatory"}}}'),a=`${i}/rate-plan-prices/${this.selectedPlan.ratePlanPriceId}/addons?filter=${o}`,n=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey}});if(!n.ok)throw new Error(`Failed to fetch addons: HTTP ${n.status}`);const s=await n.json();this.addons=this.transformAddonsApiData(s),this.isLoadingAddons=!1,this.addonsLoadError=null,this.render()}catch(i){console.error("Error loading addons:",i),this.addonsLoadError=i.message,this.isLoadingAddons=!1,this.addons=[],this.render()}}transformAddonsApiData(e){return Array.isArray(e)?e.map(t=>{var i,o;return{id:t.addonPriceId,addonId:t.addonId,addonPriceId:t.addonPriceId,name:t.externalName||t.name,description:t.description,price:t.price,quantity:t.quantity||1,unitOfMeasurement:t.unitOfMeasurement,period:(o=(i=t.billingPeriod)==null?void 0:i.periodName)==null?void 0:o.toLowerCase(),billingPeriod:t.billingPeriod,currencyCode:t.currencyCode,pricingModel:t.pricingModel,applicability:t.applicability,isPriceIncluded:t.isPriceIncluded,isVisibleInPortal:t.isVisibleInPortal,status:t.status,addonPriceKey:t.addonPriceKey}}):[]}async loadApplicableOffers(){var e,t;if(!((e=this.selectedPlan)!=null&&e.ratePlanPriceId)){console.warn("No ratePlanPriceId available to load offers"),this.availableDiscounts=[];return}this.isLoadingOffers=!0,this.offersLoadError=null,this.render();try{const o=`${((t=window.ApiConfig)==null?void 0:t.baseUrl)||f.baseUrl}/applicable-offers`,a=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey},body:JSON.stringify({ratePlanPriceId:this.selectedPlan.ratePlanPriceId})});if(!a.ok)throw new Error(`Failed to fetch applicable offers: HTTP ${a.status}`);const n=await a.json();this.availableDiscounts=n.map(s=>{var d;return{id:s.id,name:s.externalName||s.name,description:s.description,type:s.discountType==="Percentage"?"percentage":"fixed",value:s.amount,code:((d=s.code)==null?void 0:d.trim())||`OFFER${s.id.slice(-8).toUpperCase()}`,apiData:{tenantId:s.tenantId,applyOn:s.applyOn,discountDurationType:s.discountDurationType,expiryDate:s.expiryDate,maxRedemptionCount:s.maxRedemptionCount,maxRedemptionCountPerCustomer:s.maxRedemptionCountPerCustomer,minimumPurchaseAmount:s.minimumPurchaseAmount,status:s.status}}}).filter(s=>s.apiData.status==="Active"),this.isLoadingOffers=!1,this.offersLoadError=null}catch(i){console.error("Error loading applicable offers:",i),this.isLoadingOffers=!1,this.offersLoadError=i.message,this.availableDiscounts=[]}this.render()}async loadOrderEstimate(){var t;this.estimateRequestId+=1;const e=this.estimateRequestId;this.isLoadingEstimate=!0,this.estimateError=null,this.orderEstimate=null,this.render();try{const o=`${((t=window.ApiConfig)==null?void 0:t.baseUrl)||f.baseUrl}/orders/estimate`,a=this.buildEstimateRequestBody(),n=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey},body:JSON.stringify(a)});if(e!==this.estimateRequestId)return;if(!n.ok)throw new Error(`Failed to fetch order estimate: HTTP ${n.status}`);const s=await n.json();console.log("Order estimate received:",s),e===this.estimateRequestId&&(this.orderEstimate=s,this.isLoadingEstimate=!1,this.estimateError=null)}catch(i){e===this.estimateRequestId&&(console.error("Error loading order estimate:",i),this.isLoadingEstimate=!1,this.estimateError=i.message,this.orderEstimate=null)}e===this.estimateRequestId&&this.render()}buildEstimateRequestBody(){var o;const e=[],t=new Date().toISOString().split("T")[0];return this.selectedPlan&&(e.push({itemType:"Rate Plan",itemId:this.selectedPlan.ratePlanPriceId,quantity:1,options:{startDate:t,billingCycle:1,autoRenew:!1,autoCollect:!1,invoiceGenerationPreference:"Immediately"}}),this.selectedAddons.forEach(a=>{const n=this.addons.find(s=>s.id===a);n&&e.push({itemType:"Addon",itemId:n.addonPriceId,quantity:this.addonQuantities.get(a)||1,options:{ratePlanPriceId:this.selectedPlan.ratePlanPriceId}})})),this.selectedDiscount&&e.push({itemType:"Discount",itemId:this.selectedDiscount.id,quantity:1}),console.log("Applied coupon is:",this.appliedCoupon),this.appliedCoupon&&e.push({itemType:"Coupon",itemId:this.appliedCoupon.code,quantity:1,options:{startDate:t}}),{srcSysCode:"Website",eventType:"NEW SUBSCRIPTION",currency:(o=this.selectedPlan)==null?void 0:o.currencyCode,scheduleDate:t,cart:e,personalInfo:{}}}buildPlaceOrderRequestBody(e){const t=this.buildEstimateRequestBody();return t.personalInfo={accountId:e},t}async placeOrder(e){var t;if(this.orderCreated)return console.log("Order already created, skipping duplicate creation"),this.createdOrder;if(this.isCreatingOrder){console.log("Order creation in progress, skipping duplicate request");return}try{this.isCreatingOrder=!0;const o=`${((t=window.ApiConfig)==null?void 0:t.baseUrl)||f.baseUrl}/orders/place`,a=this.buildPlaceOrderRequestBody(e);console.log("Placing order with request body:",a);const n=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey},body:JSON.stringify(a)});if(!n.ok)throw new Error(`Failed to place order: HTTP ${n.status}`);const s=await n.json();return console.log("Order placed successfully:",s),this.createdOrder=s,this.orderCreated=!0,this.isCreatingOrder=!1,s}catch(i){throw console.error("Error placing order:",i),this.isCreatingOrder=!1,i}}async getOrderInvoices(e){var t;if(!e){console.error("Order ID is required to fetch invoices");return}if(this.isLoadingInvoices){console.log("Invoices loading in progress, skipping duplicate request");return}try{this.isLoadingInvoices=!0;const i=((t=window.ApiConfig)==null?void 0:t.baseUrl)||f.baseUrl,o=encodeURIComponent(JSON.stringify({where:{status:"Posted",orderId:e}})),a=`${i}/invoices?filter=${o}`;console.log("Fetching invoices for order:",e);const n=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey}});if(!n.ok)throw new Error(`Failed to fetch invoices: HTTP ${n.status}`);const s=await n.json();return console.log("Invoices fetched successfully:",s),this.orderInvoices=s,this.isLoadingInvoices=!1,s}catch(i){throw console.error("Error fetching invoices:",i),this.isLoadingInvoices=!1,this.orderInvoices=[],i}}async updateAccount(e){var t,i,o;try{const n=`${((t=window.ApiConfig)==null?void 0:t.baseUrl)||f.baseUrl}/accounts/${e}`,s={accountType:this.personalDetails.company&&this.personalDetails.company.trim()?"Organisation":"Individual",name:this.personalDetails.company&&this.personalDetails.company.trim()?this.personalDetails.company.trim():`${this.personalDetails.firstName} ${this.personalDetails.lastName}`.trim(),country:this.personalDetails.address.country,address:this.personalDetails.address.addressLine,state:this.personalDetails.address.state,city:this.personalDetails.address.city,zipCode:this.personalDetails.address.zipCode,phone:this.personalDetails.phone,email:this.personalDetails.email,sameAsSoldTo:!1},d=await fetch(n,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey},body:JSON.stringify(s)});if(!d.ok)throw new Error(`Failed to update account: HTTP ${d.status}`);let c;return d.status===204?(console.log("Customer account updated successfully (204 No Content)"),c={...this.existingAccount,accountId:e,name:s.name,country:s.country,address:s.address,state:s.state,city:s.city,zipCode:s.zipCode,phone:s.phone,email:s.email,accountType:s.accountType,communicationProfile:this.existingAccount.communicationProfile}):(c=await d.json(),console.log("Customer account updated:",c)),s.accountType==="Organisation"&&((o=(i=this.existingAccount)==null?void 0:i.communicationProfile)!=null&&o.contactId)&&await this.updateContact(e,this.existingAccount.communicationProfile.contactId),c}catch(a){throw console.error("Error updating account:",a),a}}async updateContact(e,t){var i,o,a,n,s;try{const c=`${((i=window.ApiConfig)==null?void 0:i.baseUrl)||f.baseUrl}/accounts/${e}/contacts/${t}`,r={fullName:`${this.personalDetails.firstName} ${this.personalDetails.lastName}`.trim(),country:this.personalDetails.address.country,email:this.personalDetails.email,address:this.personalDetails.address.addressLine,billNotification:(a=(o=this.existingAccount)==null?void 0:o.communicationProfile)==null?void 0:a.billNotification,accountNotification:(s=(n=this.existingAccount)==null?void 0:n.communicationProfile)==null?void 0:s.accountNotification,phone:this.personalDetails.phone};console.log("Updating contact:",t,r);const p=await fetch(c,{method:"PATCH",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey},body:JSON.stringify(r)});if(!p.ok)throw new Error(`Failed to update contact: HTTP ${p.status}`);if(p.status===204)return console.log("Contact updated successfully (204 No Content)"),{success:!0};const m=await p.json();return console.log("Contact updated:",m),m}catch(d){throw console.error("Error updating contact:",d),d}}async createCustomerAccount(){var e;try{if(this.existingAccount&&this.existingAccount.accountId){console.log("Updating existing Draft account:",this.existingAccount);const s=await this.updateAccount(this.existingAccount.accountId);return this.createdAccountId=s.id||s.accountId,s}const i=`${((e=window.ApiConfig)==null?void 0:e.baseUrl)||f.baseUrl}/accounts`,o={accountType:this.personalDetails.company&&this.personalDetails.company.trim()?"Organisation":"Individual",name:this.personalDetails.company&&this.personalDetails.company.trim()?this.personalDetails.company.trim():`${this.personalDetails.firstName} ${this.personalDetails.lastName}`.trim(),country:this.personalDetails.address.country,address:this.personalDetails.address.addressLine,state:this.personalDetails.address.state,city:this.personalDetails.address.city,zipCode:this.personalDetails.address.zipCode,phone:this.personalDetails.phone,email:this.personalDetails.email,sameAsSoldTo:!1,communicationProfile:{fullName:`${this.personalDetails.firstName} ${this.personalDetails.lastName}`.trim(),address:this.personalDetails.address.addressLine,country:this.personalDetails.address.country,phone:this.personalDetails.phone,email:this.personalDetails.email}},a=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey},body:JSON.stringify(o)});if(!a.ok)throw new Error(`Failed to create customer account: HTTP ${a.status}`);const n=await a.json();return console.log("Customer account created:",n),this.createdAccountId=n.accountId,n}catch(t){throw console.error("Error creating customer account:",t),t}}async checkExistingAccount(e){var t;try{const o=`${((t=window.ApiConfig)==null?void 0:t.baseUrl)||f.baseUrl}/accounts?filter=${encodeURIComponent(JSON.stringify({where:{email:e}}))}`,a=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json",Accept:"application/json","x-api-key":this.apiKey}});if(!a.ok)throw new Error(`Failed to check existing account: HTTP ${a.status}`);const n=await a.json();return console.log("Existing account check result:",n),n.accounts&&n.accounts.length>0?n.accounts[0]:null}catch(i){return console.error("Error checking existing account:",i),null}}async handleEmailCheck(e){if(console.log("Checking email:",e),this.isCheckingExistingAccount){console.log("Already checking, skipping...");return}this.isCheckingExistingAccount=!0,this.existingAccount=null,this.hideExistingAccountMessage(),delete this.formErrors.email,this.updateFieldError("email");try{const t=await this.checkExistingAccount(e);console.log("Found existing account:",t),t&&t.accountId?t.status==="Active"?(console.log("Account is Active, showing error"),this.formErrors.email="Email ID is already associated with another account, please use another email ID",this.updateFieldError("email"),this.updateNextButtonState()):t.status==="Draft"&&(console.log("Account is Draft, prefilling details"),t&&(this.existingAccount=t,this.showExistingAccountMessage(t),await this.prefillAccountDetails(t))):(console.log("No existing account found"),this.hideExistingAccountMessage())}catch(t){console.error("Error during email check:",t)}finally{this.isCheckingExistingAccount=!1}}async prefillAccountDetails(e){console.log("Prefilling account details:",e),console.log("Current personal details before prefill:",this.personalDetails);const t=this.personalDetails.email;if(this.personalDetails={firstName:"",lastName:"",email:t,phone:"",company:"",address:{addressLine:"",city:"",state:"",zipCode:"",country:""}},e.accountType==="Organisation"){if(console.log("Organisation account detected"),this.personalDetails.company=e.name,console.log("Prefilled company:",this.personalDetails.company),e.communicationProfile&&e.communicationProfile.fullName){const i=e.communicationProfile.fullName.split(" ").filter(o=>o.trim());i.length>=1&&(this.personalDetails.firstName=i[0],console.log("Prefilled firstName from communicationProfile:",this.personalDetails.firstName)),i.length>=2&&(this.personalDetails.lastName=i.slice(1).join(" "),console.log("Prefilled lastName from communicationProfile:",this.personalDetails.lastName))}}else if(console.log("Individual account detected"),e.name){const i=e.name.split(" ").filter(o=>o.trim());i.length>=1&&(this.personalDetails.firstName=i[0],console.log("Prefilled firstName:",this.personalDetails.firstName)),i.length>=2&&(this.personalDetails.lastName=i.slice(1).join(" "),console.log("Prefilled lastName:",this.personalDetails.lastName))}e.phone&&(this.personalDetails.phone=e.phone,console.log("Prefilled phone:",this.personalDetails.phone)),e.address&&(this.personalDetails.address.addressLine=e.address,console.log("Prefilled addressLine:",this.personalDetails.address.addressLine)),e.city&&(this.personalDetails.address.city=e.city,console.log("Prefilled city:",this.personalDetails.address.city)),e.state&&(this.personalDetails.address.state=e.state,console.log("Prefilled state:",this.personalDetails.address.state)),e.zipCode&&(this.personalDetails.address.zipCode=e.zipCode,console.log("Prefilled zipCode:",this.personalDetails.address.zipCode)),e.country&&(this.personalDetails.address.country=e.country,console.log("Prefilled country:",this.personalDetails.address.country)),console.log("Personal details after prefill:",this.personalDetails),this.render(),this.updateNextButtonState()}showExistingAccountMessage(e){const t=this.shadowRoot.querySelector('[data-field="email"]');if(t){let i=this.shadowRoot.querySelector(".existing-account-message");i||(i=document.createElement("div"),i.className="existing-account-message",t.parentNode.appendChild(i)),i.innerHTML=`
        <div style="margin-top: 8px; padding: 12px; background-color: #e3f2fd; border-left: 4px solid #2196f3; border-radius: 4px; font-size: 14px; color: #1976d2;">
          ✓ We found an existing account for this email: <strong>${e.name||e.email}</strong>
          <br><small>We've prefilled your information from your existing account.</small>
        </div>
      `}}hideExistingAccountMessage(){const e=this.shadowRoot.querySelector(".existing-account-message");e&&e.remove()}setupEventListeners(){this.handleEscapeKey=e=>{e.key==="Escape"&&this.isVisible&&this.close()},document.addEventListener("keydown",this.handleEscapeKey)}open(e){e!==void 0&&(this.selectedPlan=e),this.selectedAddons.clear(),this.couponCode="",this.appliedCoupon=null,this.selectedDiscount=null,this.availableDiscounts=[],this.currentModalStep="plan-selection",this.formErrors={},this.isVisible=!0,this.render(),document.body.style.overflow="hidden",setTimeout(()=>{const t=this.shadowRoot.querySelector(".modal-overlay");t&&this.isVisible&&(t.classList.add("fade-in"),setTimeout(()=>{t&&this.isVisible&&t.classList.add("show")},10))},10)}close(){if(!this.isVisible)return;this.updateTimeout&&(clearTimeout(this.updateTimeout),this.updateTimeout=null),this.selectedAddons.clear(),this.addonQuantities.clear();const e=this.shadowRoot.querySelector(".modal-overlay");if(e)e.classList.remove("show"),setTimeout(()=>{if(e){e.classList.remove("fade-in","visible"),this.isVisible=!1,document.body.style.overflow="";const t=new CustomEvent("modal-closed",{bubbles:!0});this.dispatchEvent(t)}},300);else{this.isVisible=!1,document.body.style.overflow="";const t=new CustomEvent("modal-closed",{bubbles:!0});this.dispatchEvent(t)}}disconnectedCallback(){this.updateTimeout&&(clearTimeout(this.updateTimeout),this.updateTimeout=null),this.handleEscapeKey&&(document.removeEventListener("keydown",this.handleEscapeKey),this.handleEscapeKey=null),document.body.style.overflow=""}toggleAddon(e){this.selectedAddons.has(e)?(this.selectedAddons.delete(e),this.addonQuantities.delete(e)):(this.selectedAddons.add(e),this.addonQuantities.set(e,1)),this.updateOrderSummary()}handleAddonQuantityChange(e,t){const i=parseInt(t,10),o=this.shadowRoot.querySelector(`#addon-qty-${e}`);isNaN(i)||i<1?(this.addonQuantities.set(e,1),o&&(o.value=1,o.style.borderColor="#ff6b6b",setTimeout(()=>{o.style.borderColor=""},1500))):i>999?(this.addonQuantities.set(e,999),o&&(o.value=999,o.style.borderColor="#ff6b6b",setTimeout(()=>{o.style.borderColor=""},1500))):(this.addonQuantities.set(e,i),o&&(o.style.borderColor="")),this.updateOrderSummary()}updateOrderSummary(){this.updateTimeout&&clearTimeout(this.updateTimeout),this.updateTimeout=setTimeout(()=>{this.loadOrderEstimate()},300)}calculateTotal(){let e=this.selectedPlan?this.selectedPlan.price:0;return this.selectedAddons.forEach(t=>{const i=this.addons.find(o=>o.id===t);i&&(e+=i.price)}),e}calculateDiscountedTotal(){let e=this.calculateTotal(),t=0;return this.appliedCoupon&&(this.appliedCoupon.type==="percentage"?t+=e*this.appliedCoupon.value/100:this.appliedCoupon.type==="fixed"&&(t+=this.appliedCoupon.value)),this.selectedDiscount&&(this.selectedDiscount.type==="percentage"?t+=e*this.selectedDiscount.value/100:this.selectedDiscount.type==="fixed"&&(t+=this.selectedDiscount.value)),Math.max(0,e-t)}getTotalDiscount(){const e=this.calculateTotal(),t=this.calculateDiscountedTotal();return e-t}applyCouponCode(){const e=this.couponCode.trim();e&&(this.appliedCoupon={code:e,name:`Coupon: ${e}`},this.showMessage("Coupon applied successfully!","success"),this.updateOrderSummary())}removeCoupon(){this.appliedCoupon=null,this.couponCode="",this.updateOrderSummary()}selectDiscount(e){var t;((t=this.selectedDiscount)==null?void 0:t.id)===e?this.selectedDiscount=null:this.selectedDiscount=this.availableDiscounts.find(i=>i.id===e),this.updateOrderSummary()}removeDiscount(e){var t;((t=this.selectedDiscount)==null?void 0:t.id)===e&&(this.selectedDiscount=null,this.updateOrderSummary())}showMessage(e,t="info"){const i=this.shadowRoot.querySelector(".coupon-message");i&&(i.textContent=e,i.className=`coupon-message ${t}`,i.style.display="block",setTimeout(()=>{i.style.display="none"},3e3))}proceedToPersonalDetails(){this.currentModalStep="personal-details",this.render()}goBackToPlanSelection(){this.currentModalStep="plan-selection",this.render()}proceedToPaymentMethod(){this.currentModalStep="payment-method",this.render()}goBackToPersonalDetails(){this.currentModalStep="personal-details",this.render()}selectPaymentMethod(e){this.selectedPaymentMethod=e,this.render()}validatePersonalDetails(){const e={},{personalDetails:t}=this;return t.firstName.trim()||(e.firstName="First name is required"),t.lastName.trim()||(e.lastName="Last name is required"),t.email.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t.email)||(e.email="Please enter a valid email address"):e.email="Email is required",t.phone.trim()||(e.phone="Phone number is required"),t.address.addressLine.trim()||(e.addressLine="Address line is required"),t.address.city.trim()||(e.city="City is required"),t.address.state.trim()||(e.state="State/Province is required"),t.address.zipCode.trim()||(e.zipCode="ZIP/Postal code is required"),t.address.country.trim()||(e.country="Country is required"),e}isPersonalDetailsFormValid(){if(Object.keys(this.formErrors).length>0)return!1;const{personalDetails:e}=this,t=e.firstName.trim()&&e.lastName.trim()&&e.email.trim()&&e.phone.trim()&&e.address.addressLine.trim()&&e.address.city.trim()&&e.address.state.trim()&&e.address.zipCode.trim()&&e.address.country.trim(),i=e.email.trim()&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email);return t&&i}validatePaymentDetails(){const e={};if(!this.selectedPaymentMethod)return e.paymentMethod="Please select a payment method",e;switch(this.selectedPaymentMethod){case"card":this.cashfreeComponents.cardNumber&&this.cashfreeComponents.cardHolder&&this.cashfreeComponents.cardExpiry&&this.cashfreeComponents.cardCvv?(this.cashfreeComponents.cardHolder.isComplete()||(e.cardholderName="Cardholder name is required"),this.cashfreeComponents.cardNumber.isComplete()||(e.cardNumber="Please enter a valid card number"),this.cashfreeComponents.cardExpiry.isComplete()||(e.expiryDate="Please enter a valid expiry date"),this.cashfreeComponents.cardCvv.isComplete()||(e.cvv="Please enter a valid CVV")):e.cardForm="Payment form is not properly initialized. Please refresh and try again.";break;case"upi":this.cashfreeComponents.upiCollect?this.cashfreeComponents.upiCollect.isComplete()||(e.upiId="Please enter a valid UPI ID"):e.upiForm="UPI form is not properly initialized. Please refresh and try again.";break;case"netbanking":this.paymentDetails.netbanking.bankName.trim()||(e.bankName="Please select a bank");break;case"wallet":this.cashfreeComponents.wallets&&this.cashfreeComponents.wallets.size>0?(!this.paymentDetails.wallet.selectedProvider||!this.paymentDetails.wallet.isValid)&&(e.walletType="Please select a wallet to proceed"):e.walletForm="Wallet options are not properly initialized. Please refresh and try again.";break}return e}handleInputChange(e,t){if(e.startsWith("address.")){const i=e.replace("address.","");this.personalDetails.address[i]=t}else if(e.startsWith("payment.")){const[,i,o]=e.split(".");this.paymentDetails[i]&&(this.paymentDetails[i][o]=t)}else this.personalDetails[e]=t;delete this.formErrors[e],this.updateFieldError(e),this.updateNextButtonState()}updateNextButtonState(){if(this.currentModalStep==="personal-details"){const e=this.shadowRoot.querySelector("#proceedBtn");e&&(this.isPersonalDetailsFormValid()?e.removeAttribute("disabled"):e.setAttribute("disabled",""))}}updateFieldError(e){let t=e;if(e.startsWith("address.")&&(t=e.replace("address.","")),e.startsWith("payment.")){const a=e.split(".");a.length===3&&(t=a[2])}const i=this.shadowRoot.querySelector(`[data-error="${t}"]`);i&&(this.formErrors[e]?(i.textContent=this.formErrors[e],i.style.display="block"):(i.textContent="",i.style.display="none"));const o=this.shadowRoot.querySelector(`[data-field="${e}"]`);o&&(this.formErrors[e]?o.classList.add("error"):o.classList.remove("error"))}showFormErrors(e){this.formErrors=e,Object.keys(e).forEach(t=>{const i=this.shadowRoot.querySelector(`[data-error="${t}"]`);let o=t;["addressLine","city","state","zipCode","country"].includes(t)&&(o=`address.${t}`),["cardholderName","cardNumber","expiryDate","cvv"].includes(t)?o=`payment.card.${t}`:t==="upiId"?o=`payment.upi.${t}`:["walletType","walletNumber"].includes(t)?o=`payment.wallet.${t}`:t==="bankName"&&(o=`payment.netbanking.${t}`);const a=this.shadowRoot.querySelector(`[data-field="${o}"]`);i&&(i.textContent=e[t],i.style.display="block"),a&&a.classList.add("error")})}proceedToCheckout(){if(this.currentModalStep==="plan-selection"){this.proceedToPersonalDetails();return}if(this.currentModalStep==="personal-details"){const e=this.validatePersonalDetails();if(Object.keys(e).length>0){this.showFormErrors(e);return}this.createCustomerAccount().then(t=>{console.log("Account created successfully, now placing order");const i=t.id||t.accountId||this.createdAccountId;if(!i)throw new Error("Account ID not found in account creation response");return this.placeOrder(i)}).then(t=>{console.log("Order placed successfully, now fetching invoices");const i=t.cart&&t.cart[0]&&t.cart[0].orderId;return i?this.getOrderInvoices(i).then(o=>(console.log("Invoices fetched, proceeding to payment"),{order:t,invoices:o})).catch(o=>(console.warn("Failed to fetch invoices, but continuing with payment:",o),{order:t,invoices:[]})):(console.warn("Order ID not found in response, skipping invoice fetch"),t)}).then(t=>{const{order:i,invoices:o}=t;console.log("Order and invoices ready, proceeding to payment"),this.orderData={...this.orderData,placedOrder:i,orderInvoices:o||[],accountId:i.accountId||this.createdAccountId},this.proceedToPaymentMethod()}).catch(t=>{console.error("Failed to process account and order:",t);let i="Failed to process your request. Please try again.";t.message&&t.message.includes("contact")?i="Failed to update contact information. Please check your details and try again.":t.message&&t.message.includes("account")?i="Failed to create account. Please check your details and try again.":t.message&&t.message.includes("order")&&(i="Failed to create order. Please try again."),alert(i)});return}if(this.currentModalStep==="payment-method"){const e=this.validatePaymentDetails();if(Object.keys(e).length>0){this.showFormErrors(e);return}this.initiatePayment()}}async initiatePayment(){try{const e=this.getPaymentSessionId();if(!e){alert("Payment session not found. Please try again.");return}if(console.log("Initiating payment with session ID:",e),console.log("Selected payment method:",this.selectedPaymentMethod),!this.cashfreeInstance){alert("Payment system not ready. Please refresh and try again.");return}switch(this.selectedPaymentMethod){case"card":await this.payViaCard(e);break;case"upi":await this.payViaUpi(e);break;case"wallet":await this.payViaWallet(e);break;case"netbanking":await this.payViaNetbanking(e);break;default:console.error("Unsupported payment method:",this.selectedPaymentMethod),alert("Selected payment method is not supported.")}}catch(e){console.error("Payment initiation failed:",e),alert("Failed to initiate payment. Please try again.")}}getPaymentSessionId(){const e=this.orderInvoices.invoices;return e&&e.length>0&&e[0].pgPaymentSessionId?e[0].pgPaymentSessionId:(console.error("Payment session ID not found in invoices:",this.orderInvoices),null)}async payViaCard(e){if(!this.cashfreeComponents.cardNumber||!this.cashfreeComponents.cardHolder||!this.cashfreeComponents.cardExpiry||!this.cashfreeComponents.cardCvv){console.error("Card components not ready"),alert("Card payment form not ready. Please try again.");return}try{console.log("Processing card payment...");const t={paymentMethod:this.cashfreeComponents.cardNumber,paymentSessionId:e},i=await this.cashfreeInstance.pay(t);console.log("Card payment result:",i),this.handlePaymentResult(i)}catch(t){console.error("Card payment failed:",t),alert("Card payment failed. Please check your details and try again.")}}async payViaUpi(e){if(!this.cashfreeComponents.upiCollect){console.error("UPI component not ready"),alert("UPI payment form not ready. Please try again.");return}try{console.log("Processing UPI payment...");const t={paymentMethod:this.cashfreeComponents.upiCollect,paymentSessionId:e},i=await this.cashfreeInstance.pay(t);console.log("UPI payment result:",i),this.handlePaymentResult(i)}catch(t){console.error("UPI payment failed:",t),alert("UPI payment failed. Please check your UPI ID and try again.")}}async payViaWallet(e){const t=this.paymentDetails.wallet.selectedProvider,i=this.paymentDetails.wallet.selectedComponent;if(!t||!i){console.error("Wallet not selected or component not ready"),alert("Please select a wallet to proceed with payment.");return}try{console.log(`Processing ${t} wallet payment...`);const o={paymentMethod:i,paymentSessionId:e},a=await this.cashfreeInstance.pay(o);this.handlePaymentResult(a)}catch(o){console.error("Wallet payment failed:",o),alert(`${t} payment failed. Please try again.`)}}async payViaNetbanking(e){try{console.log("Processing netbanking payment..."),this.cashfreeInstance.checkout({paymentSessionId:e,redirectTarget:"_self"})}catch(t){console.error("Netbanking payment failed:",t),alert("Netbanking payment failed. Please try again.")}}handlePaymentResult(e){if(console.log("Payment result:",e),e.error){console.error("Payment failed:",e.error),alert(`Payment failed: ${e.error.message||"Unknown error"}`);return}if(e.redirect){console.log("Redirecting to complete payment...");return}e.paymentDetails&&(console.log("Payment completed successfully"),this.orderData={...this.orderData,paymentResult:e.paymentDetails,selectedPaymentMethod:this.selectedPaymentMethod},this.currentModalStep="order-confirmation",this.render())}render(){this.shadowRoot.innerHTML=`
      ${this.getStyles()}
      <div class="full-page-container">
        <div class="page-header">
          <div class="page-header-content">
            <h2>${this.getModalTitle()}</h2>
          </div>
        </div>

        ${this.renderProgressStepper()}

        <div class="page-content">
          ${this.renderModalContent()}
          </div>
        </div>
      </div>
    `,this.setupModalEventListeners()}getModalTitle(){switch(this.currentModalStep){case"plan-selection":return"Customize Your Plan";case"personal-details":return"Personal Details";case"payment-method":return"Payment Method";case"order-confirmation":return"Order Confirmation";default:return"Checkout"}}renderProgressStepper(){const e=[{key:"plan-selection",label:"Plan Selection",icon:"1"},{key:"personal-details",label:"Personal Details",icon:"2"},{key:"payment-method",label:"Payment Method",icon:"3"},{key:"order-confirmation",label:"Confirmation",icon:"✓"}];return`
      <div class="progress-indicator">
        <div class="progress-steps">
          ${e.map((t,i)=>`
            <div class="progress-step ${this.getStepStatus(t.key)}">
              <div class="step-icon">${t.icon}</div>
              <div class="step-label">${t.label}</div>
            </div>
            ${i<e.length-1?'<div class="step-connector"></div>':""}
          `).join("")}
        </div>
      </div>
    `}getStepStatus(e){const t=["plan-selection","personal-details","payment-method","order-confirmation"],i=t.indexOf(this.currentModalStep),o=t.indexOf(e);return o<i?"completed":o===i?"active":"upcoming"}renderModalContent(){switch(this.currentModalStep){case"plan-selection":return this.renderPlanSelectionContent();case"personal-details":return this.renderPersonalDetailsContent();case"payment-method":return this.renderPaymentMethodContent();case"order-confirmation":return this.renderOrderConfirmation()}}renderPlanSelectionContent(){return`
      <div class="page-body">
        <div class="plan-section">
          ${this.renderSelectedPlan()}
        </div>
        
        <div class="addons-section">
          <h3>Available Add-ons</h3>
          ${this.renderAddonsContent()}
        </div>

      </div>
      
      <div class="page-sidebar">
        <div class="order-summary">
          <div class="order-summary-content">
            <h3>Order Summary</h3>
            <div class="order-summary-details">
              ${this.renderOrderSummary()}
            </div>
            
            <div class="coupon-section">
              <div class="coupon-input-group">
              <div class="form-group">
                <input type="text" id="couponInput" placeholder="Enter coupon code" value="${this.couponCode}">
                </div>
                <button class="btn btn-primary" id="applyCouponBtn">Apply</button>
              </div>
              ${this.getCouponStatusMessage()}
              ${this.isSuccessfullyAppliedCoupon()?`
                <div class="applied-coupon">
                  <span class="coupon-name">${this.getAppliedCouponName()}</span>
                  <button class="btn btn-icon remove-coupon-btn" id="removeCouponBtn">×</button>
                </div>
              `:""}
            </div>
            
            <div class="available-discounts-section">
              <h4>Available Discounts</h4>
              <div class="available-discounts-grid">
                ${this.isLoadingOffers?`
                  <div class="loading-offers">
                    <div class="spinner"></div>
                    <span>Loading offers...</span>
                  </div>
                `:this.offersLoadError?`
                  <div class="offers-error">
                    <p>Unable to load offers at this time.</p>
                  </div>
                `:this.availableDiscounts.length===0?`
                  <p class="no-offers">No offers available for this plan.</p>
                `:this.availableDiscounts.map(e=>{var a;const t=((a=this.selectedDiscount)==null?void 0:a.id)===e.id,i=this.isDiscountSuccessfullyApplied(e.id),o=e.type==="percentage"?`${e.value}% off`:`$${e.value} off`;return`
                    <div class="available-discount-card ${t?"selected":""} ${i?"applied":""}" data-discount-id="${e.id}">
                      <div class="available-discount-header">
                        <span class="available-discount-name">${e.name}</span>
                        ${i?`<button class="btn btn-icon remove-discount-btn" data-discount-id="${e.id}" title="Remove discount">×</button>`:`<span class="available-discount-value">${o}</span>`}
                      </div>
                      <p class="available-discount-description">${e.description}</p>
                      ${i?'<span class="discount-applied-badge">✓ Applied</span>':`<span class="available-discount-code">Code: ${e.code}</span>`}
                    </div>
                  `}).join("")}
              </div>
            </div>
          </div>

          <div class="sidebar-footer">
            <button class="btn btn-primary btn-block" id="proceedBtn">
              Next
            </button>
          </div>
        </div>
      </div>
    `}renderPersonalDetailsContent(){return`
      <div class="page-body">
        <div class="personal-details-form">
          <h3>Personal Information</h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="firstName">First Name *</label>
              <input type="text" id="firstName" data-field="firstName" 
                     value="${this.personalDetails.firstName}" 
                     placeholder="Enter your first name">
              <div class="field-error" data-error="firstName"></div>
            </div>
            
            <div class="form-group">
              <label for="lastName">Last Name *</label>
              <input type="text" id="lastName" data-field="lastName" 
                     value="${this.personalDetails.lastName}" 
                     placeholder="Enter your last name">
              <div class="field-error" data-error="lastName"></div>
            </div>
            
            <div class="form-group full-width">
              <label for="email">Email Address *</label>
              <input type="email" id="email" data-field="email" 
                     value="${this.personalDetails.email}" 
                     placeholder="Enter your email address">
              <div class="field-error" data-error="email"></div>
            </div>
            
            <div class="form-group">
              <label for="phone">Phone Number *</label>
              <input type="tel" id="phone" data-field="phone" 
                     value="${this.personalDetails.phone}" 
                     placeholder="Enter your phone number">
              <div class="field-error" data-error="phone"></div>
            </div>
            
            <div class="form-group">
              <label for="company">Company (Optional)</label>
              <input type="text" id="company" data-field="company" 
                     value="${this.personalDetails.company}" 
                     placeholder="Enter company name">
            </div>
          </div>

          <h3>Billing Address</h3>
          <div class="form-grid">
            <div class="form-group full-width">
              <label for="addressLine">Address Line*</label>
              <input type="text" id="addressLine" data-field="address.addressLine" 
                     value="${this.personalDetails.address.addressLine}" 
                     placeholder="Enter your address">
              <div class="field-error" data-error="addressLine"></div>
            </div>
            
            <div class="form-group">
              <label for="city">City *</label>
              <input type="text" id="city" data-field="address.city" 
                     value="${this.personalDetails.address.city}" 
                     placeholder="Enter your city">
              <div class="field-error" data-error="city"></div>
            </div>
            
            <div class="form-group">
              <label for="state">State/Province *</label>
              <input type="text" id="state" data-field="address.state" 
                     value="${this.personalDetails.address.state}" 
                     placeholder="Enter state/province">
              <div class="field-error" data-error="state"></div>
            </div>
            
            <div class="form-group">
              <label for="zipCode">ZIP/Postal Code *</label>
              <input type="text" id="zipCode" data-field="address.zipCode" 
                     value="${this.personalDetails.address.zipCode}" 
                     placeholder="Enter ZIP/postal code">
              <div class="field-error" data-error="zipCode"></div>
            </div>
            
            <div class="form-group">
              <label for="country">Country *</label>
              <select id="country" data-field="address.country">
                <option value="">Select Country</option>
                <option value="US" ${this.personalDetails.address.country==="US"?"selected":""}>United States</option>
                <option value="CA" ${this.personalDetails.address.country==="CA"?"selected":""}>Canada</option>
                <option value="GB" ${this.personalDetails.address.country==="GB"?"selected":""}>United Kingdom</option>
                <option value="AU" ${this.personalDetails.address.country==="AU"?"selected":""}>Australia</option>
                <option value="DE" ${this.personalDetails.address.country==="DE"?"selected":""}>Germany</option>
                <option value="FR" ${this.personalDetails.address.country==="FR"?"selected":""}>France</option>
                <option value="IND" ${this.personalDetails.address.country==="IND"?"selected":""}>India</option>
              </select>
              <div class="field-error" data-error="country"></div>
            </div>
          </div>
        </div>
      </div>
      
      <div class="page-sidebar">
        <div class="order-summary">
          <div class="order-summary-content">
            <h3>Order Summary</h3>
            <div class="order-summary-details">
              ${this.renderOrderSummary()}
            </div>
          </div>
          
          <div class="sidebar-footer">
            <div class="form-actions">
              <button class="btn btn-secondary back-btn" id="backBtn">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M10 3L5 8L10 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Back
              </button>
              <button class="btn btn-primary btn-block proceed-btn" id="proceedBtn" ${this.isPersonalDetailsFormValid()?"":"disabled"}>
                Next
              </button>
            </div>
          </div>
        </div>
      </div>
    `}renderPaymentMethodContent(){return this.selectedPaymentMethod?this.renderPaymentMethodForm():this.renderPaymentMethodSelection()}renderPaymentMethodSelection(){return`
      <div class="page-body">
        <div class="payment-method-selection">
          <h3>Choose Payment Method</h3>
          <div class="payment-methods-grid">
            <div class="payment-method-card" data-method="upi">
              <div class="payment-icon">
                <svg width="24" height="24" viewBox="0 0 32 32" fill="none">
                  <rect x="4" y="8" width="24" height="16" rx="3" stroke="#526484" stroke-width="2"/>
                  <path d="M8 16h16M12 12h8" stroke="#526484" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <h4>UPI</h4>
              <p>Google Pay, PhonePe, Paytm</p>
            </div>

            <div class="payment-method-card" data-method="card">
              <div class="payment-icon">
                <svg width="24" height="24" viewBox="0 0 32 32" fill="none">
                  <rect x="4" y="8" width="24" height="16" rx="3" stroke="#526484" stroke-width="2"/>
                  <path d="M4 14h24" stroke="#526484" stroke-width="2"/>
                  <rect x="6" y="18" width="4" height="2" fill="#526484"/>
                </svg>
              </div>
              <h4>Credit/Debit Card</h4>
              <p>Visa, Mastercard, Rupay</p>
            </div>

            <div class="payment-method-card" data-method="wallet">
              <div class="payment-icon">
                <svg width="24" height="24" viewBox="0 0 32 32" fill="none">
                  <rect x="6" y="8" width="20" height="16" rx="2" stroke="#526484" stroke-width="2"/>
                  <circle cx="20" cy="16" r="2" stroke="#526484" stroke-width="2"/>
                  <path d="M6 12h20" stroke="#526484" stroke-width="2"/>
                </svg>
              </div>
              <h4>Digital Wallets</h4>
              <p>Paytm, Amazon Pay, Mobikwik</p>
            </div>

            <div class="payment-method-card" data-method="netbanking">
              <div class="payment-icon">
                <svg width="24" height="24" viewBox="0 0 32 32" fill="none">
                  <rect x="6" y="10" width="20" height="12" rx="2" stroke="#526484" stroke-width="2"/>
                  <path d="M10 6L16 10L22 6" stroke="#526484" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M10 16h4M18 16h4" stroke="#526484" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <h4>Net Banking</h4>
              <p>All major banks</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="page-sidebar">
        <div class="order-summary">
          <div class="order-summary-content">
            <h3>Order Summary</h3>
            <div class="order-summary-details">
              ${this.renderOrderSummary()}
            </div>
          </div>
          
          <div class="sidebar-footer">
            <div class="form-actions">
              <button class="btn btn-secondary back-btn" id="backBtn">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M10 3L5 8L10 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Back
              </button>
            </div>
          </div>
        </div>
      </div>
    `}renderPaymentMethodForm(){let e="";switch(this.selectedPaymentMethod){case"upi":e=this.renderUPIForm();break;case"card":e=this.renderCardForm();break;case"wallet":e=this.renderWalletForm();break;case"netbanking":e=this.renderNetBankingForm();break}return`
      <div class="page-body">
        <div class="payment-form-section">
          <div class="selected-method-header">
            <button class="btn btn-secondary change-method-btn" id="changeMethodBtn">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M10 3L5 8L10 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Change Payment Method
            </button>
            <h3>${this.getPaymentMethodTitle()}</h3>
          </div>
          ${e}
        </div>
      </div>

      <div class="page-sidebar">
        <div class="order-summary">
          <div class="order-summary-content">
            <h3>Order Summary</h3>
            <div class="order-summary-details">
              ${this.renderOrderSummary()}
            </div>
          </div>

          <div class="sidebar-footer">
            <div class="form-actions">
              <button class="btn btn-secondary back-btn" id="backBtn">
                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                  <path d="M10 3L5 8L10 13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                Back
              </button>
              <button class="btn btn-primary proceed-btn" id="proceedBtn">
                Complete Order
              </button>
            </div>
          </div>
        </div>
      </div>
    `}getPaymentMethodTitle(){switch(this.selectedPaymentMethod){case"upi":return"UPI Payment";case"card":return"Card Payment";case"wallet":return"Digital Wallet";case"netbanking":return"Net Banking";default:return"Payment"}}renderUPIForm(){return`
      <div class="payment-form">
        <div class="form-group">
          <label for="upiCollect">UPI ID *</label>
          <div id="upiCollect" class="cashfree-input-container"></div>
          <div class="field-error" data-error="upiId"></div>
        </div>
        <div class="cashfree-loading" id="cashfreeUpiLoading" style="display: none;">
          <p>Loading secure UPI form...</p>
        </div>
        <div class="upi-note">
          <p>Enter your UPI ID to complete the payment. You'll receive a payment request on your UPI app.</p>
        </div>
      </div>
    `}renderCardForm(){return`
      <div class="payment-form">
        <div class="form-grid">
          <div class="form-group full-width">
            <label for="cardHolder">Cardholder Name *</label>
            <div id="cardHolder" class="cashfree-input-container"></div>
            <div class="field-error" data-error="cardholderName"></div>
          </div>
          
          <div class="form-group full-width">
            <label for="cardNumber">Card Number *</label>
            <div id="cardNumber" class="cashfree-input-container"></div>
            <div class="field-error" data-error="cardNumber"></div>
          </div>
          
          <div class="form-group">
            <label for="cardExpiry">Expiry Date *</label>
            <div id="cardExpiry" class="cashfree-input-container"></div>
            <div class="field-error" data-error="expiryDate"></div>
          </div>
          
          <div class="form-group">
            <label for="cardCvv">CVV *</label>
            <div id="cardCvv" class="cashfree-input-container"></div>
            <div class="field-error" data-error="cvv"></div>
          </div>
        </div>
        <div class="cashfree-loading" id="cashfreeLoading" style="display: none;">
          <p>Loading secure payment form...</p>
        </div>
      </div>
    `}renderWalletForm(){return`
      <div class="payment-form">
        <div class="wallet-options">
          <label class="wallet-section-label">Select Wallet *</label>
          <div class="wallet-providers">
            ${[{id:"phonepe",name:"PhonePe",provider:"phonepe"},{id:"amazon",name:"Amazon Pay",provider:"amazon"},{id:"paytm",name:"Paytm",provider:"paytm"},{id:"freecharge",name:"FreeCharge",provider:"freecharge"},{id:"mobikwik",name:"Mobikwik",provider:"mobikwik"}].map(t=>`
              <div class="wallet-provider-container">
                <div id="${t.id}" class="cashfree-wallet-container" data-provider="${t.provider}"></div>
              </div>
            `).join("")}
          </div>
        </div>
        
        <div class="cashfree-loading" id="cashfreeWalletLoading" style="display: none;">
          <p>Loading wallet options...</p>
        </div>
        
        <div class="wallet-note">
          <p>Click on your preferred wallet to continue with the payment. You'll be redirected to complete the payment securely.</p>
        </div>
      </div>
    `}renderNetBankingForm(){return`
      <div class="payment-form">
        <div class="form-group">
          <label for="bankName">Select Bank *</label>
          <select id="bankName" data-field="payment.netbanking.bankName">
            <option value="">Choose Your Bank</option>
            <option value="sbi" ${this.paymentDetails.netbanking.bankName==="sbi"?"selected":""}>State Bank of India</option>
            <option value="hdfc" ${this.paymentDetails.netbanking.bankName==="hdfc"?"selected":""}>HDFC Bank</option>
            <option value="icici" ${this.paymentDetails.netbanking.bankName==="icici"?"selected":""}>ICICI Bank</option>
            <option value="axis" ${this.paymentDetails.netbanking.bankName==="axis"?"selected":""}>Axis Bank</option>
            <option value="kotak" ${this.paymentDetails.netbanking.bankName==="kotak"?"selected":""}>Kotak Mahindra Bank</option>
            <option value="pnb" ${this.paymentDetails.netbanking.bankName==="pnb"?"selected":""}>Punjab National Bank</option>
            <option value="canara" ${this.paymentDetails.netbanking.bankName==="canara"?"selected":""}>Canara Bank</option>
            <option value="bob" ${this.paymentDetails.netbanking.bankName==="bob"?"selected":""}>Bank of Baroda</option>
          </select>
          <div class="field-error" data-error="bankName"></div>
        </div>
        <div class="netbanking-note">
          <p>You will be redirected to your bank's website to complete the payment securely.</p>
        </div>
      </div>
    `}renderOrderConfirmation(){if(!this.orderData)return"<div>No order data available</div>";const e={card:"Credit/Debit Card",upi:"UPI",wallet:"Digital Wallet",netbanking:"Net Banking"}[this.orderData.paymentMethod]||this.orderData.paymentMethod;return`
      <div class="page-body">
        <div class="confirmation-container">
          <div class="confirmation-success">
            <div class="success-icon-large">
              <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                <circle cx="40" cy="40" r="38" stroke="#10b981" stroke-width="4" fill="#f0fdf4"/>
                <path d="M25 40L35 50L55 30" stroke="#10b981" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <h2>Order Confirmed!</h2>
            <p class="confirmation-message">Your subscription has been successfully processed.</p>
          </div>

          <div class="confirmation-details">
            <h3>Order Summary</h3>
            
            <div class="detail-section">
              <h4>Subscription Details</h4>
              <div class="detail-row">
                <span class="detail-label">Plan:</span>
                <span class="detail-value">${this.orderData.selectedPlan.name}</span>
              </div>
              ${this.orderData.selectedAddons.length>0?`
                <div class="detail-row">
                  <span class="detail-label">Add-ons:</span>
                  <span class="detail-value">${this.orderData.selectedAddons.map(t=>t.name).join(", ")}</span>
                </div>
              `:""}
            </div>

            <div class="detail-section">
              <h4>Billing Information</h4>
              <div class="detail-row">
                <span class="detail-label">Name:</span>
                <span class="detail-value">${this.orderData.personalDetails.firstName} ${this.orderData.personalDetails.lastName}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Email:</span>
                <span class="detail-value">${this.orderData.personalDetails.email}</span>
              </div>
              <div class="detail-row">
                <span class="detail-label">Payment Method:</span>
                <span class="detail-value">${e}</span>
              </div>
            </div>

            <div class="detail-section">
              <h4>Payment Summary</h4>
              <div class="detail-row">
                <span class="detail-label">Subtotal:</span>
                <span class="detail-value">$${this.orderData.originalTotal.toFixed(2)}</span>
              </div>
              ${this.orderData.totalDiscount>0?`
                <div class="detail-row discount-row">
                  <span class="detail-label">Discount:</span>
                  <span class="detail-value">-$${this.orderData.totalDiscount.toFixed(2)}</span>
                </div>
              `:""}
              <div class="detail-row total-row">
                <span class="detail-label">Total:</span>
                <span class="detail-value">$${this.orderData.total.toFixed(2)}/${this.orderData.selectedPlan.period}</span>
              </div>
            </div>

            <div class="confirmation-note">
              <p>✉️ A confirmation email has been sent to <strong>${this.orderData.personalDetails.email}</strong></p>
              <p>📅 Your subscription will begin immediately and will renew on ${this.getNextBillingDate()}.</p>
            </div>
          </div>
        </div>
      </div>
      
      <div class="page-sidebar">
        <div class="order-summary">
          <div class="order-summary-content">
            <div class="confirmation-actions">
              <h3>What's Next?</h3>
              <div class="next-steps">
                <div class="next-step">
                  <span class="step-number">1</span>
                  <span class="step-text">Check your email for login credentials</span>
                </div>
                <div class="next-step">
                  <span class="step-number">2</span>
                  <span class="step-text">Access your dashboard to get started</span>
                </div>
                <div class="next-step">
                  <span class="step-number">3</span>
                  <span class="step-text">Explore features and customize settings</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="sidebar-footer">
            <button class="btn btn-primary proceed-btn" id="proceedBtn" onclick="window.location.href='/dashboard'">
              Go to Dashboard
            </button>
            <button class="btn btn-secondary close-confirmation-btn" id="closeConfirmationBtn">
              Close
            </button>
          </div>
        </div>
      </div>
    `}getNextBillingDate(){const e=new Date;return this.orderData&&this.orderData.selectedPlan.period==="month"?e.setMonth(e.getMonth()+1):e.setFullYear(e.getFullYear()+1),e.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}selectPaymentMethod(e){this.selectedPaymentMethod=e,this.render()}getCashfreeStyleObject(){const e=getComputedStyle(this.shadowRoot.host),t=(i,o)=>e.getPropertyValue(i).trim()||o;return{base:{fontSize:t("--billhive-font-size-body-text","12px"),fontFamily:t("--billhive-font-family","'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif"),backgroundColor:"#FFFFFF",":focus":{border:`1px solid ${t("--billhive-accent-color","#5b5bd6")}`},border:`1px solid ${t("--billhive-border-color","#e5e7eb")}`,borderRadius:t("--billhive-element-border-radius","4px"),padding:"12px",color:t("--billhive-text-color","#111827")},invalid:{color:t("--billhive-error-color","#dc2626"),border:`1px solid ${t("--billhive-error-color","#dc2626")}`}}}async setupCashfreeCardComponents(){if(!this.cashfreeInstance){console.error("Cashfree SDK not loaded"),this.showCardFormError("Secure payment form could not be loaded. Please try again or select a different payment method.");return}try{const e=this.shadowRoot.querySelector("#cashfreeLoading");e&&(e.style.display="block");const t=this.getCashfreeStyleObject(),i={values:{placeholder:"1234 5678 9012 3456"},style:t};this.cashfreeComponents.cardNumber=this.cashfreeInstance.create("cardNumber",i);const o=this.shadowRoot.querySelector("#cardNumber");o&&await this.cashfreeComponents.cardNumber.mount(o);const a={values:{placeholder:"Enter cardholder name"},style:t};this.cashfreeComponents.cardHolder=this.cashfreeInstance.create("cardHolder",a);const n=this.shadowRoot.querySelector("#cardHolder");n&&await this.cashfreeComponents.cardHolder.mount(n);const s={values:{placeholder:"MM/YY"},style:t};this.cashfreeComponents.cardExpiry=this.cashfreeInstance.create("cardExpiry",s);const d=this.shadowRoot.querySelector("#cardExpiry");d&&await this.cashfreeComponents.cardExpiry.mount(d);const c={values:{placeholder:"123"},style:t};this.cashfreeComponents.cardCvv=this.cashfreeInstance.create("cardCvv",c);const r=this.shadowRoot.querySelector("#cardCvv");r&&await this.cashfreeComponents.cardCvv.mount(r),this.cashfreeComponents.cardNumber.on("change",p=>{p.value&&p.value.cvvLength&&this.cashfreeComponents.cardCvv.update({cvvLength:p.value.cvvLength}),this.validateCashfreeCardForm()}),this.cashfreeComponents.cardHolder.on("change",()=>{this.validateCashfreeCardForm()}),this.cashfreeComponents.cardExpiry.on("change",()=>{this.validateCashfreeCardForm()}),this.cashfreeComponents.cardCvv.on("change",()=>{this.validateCashfreeCardForm()}),e&&(e.style.display="none"),console.log("✅ Cashfree card components mounted successfully")}catch(e){console.error("Failed to setup Cashfree card components:",e),this.showCardFormError("Failed to initialize secure payment form. Please refresh and try again.")}}showCardFormError(e){["#cardNumber","#cardHolder","#cardExpiry","#cardCvv"].forEach(i=>{const o=this.shadowRoot.querySelector(i);o&&(o.innerHTML=`<div style="color: #df1b41; padding: 12px; border: 1px solid #df1b41; border-radius: 12px; background: #fff5f5;">${e}</div>`)})}validateCashfreeCardForm(){if(this.cashfreeComponents.cardNumber&&this.cashfreeComponents.cardHolder&&this.cashfreeComponents.cardExpiry&&this.cashfreeComponents.cardCvv){const e=this.cashfreeComponents.cardNumber.isComplete()&&this.cashfreeComponents.cardHolder.isComplete()&&this.cashfreeComponents.cardExpiry.isComplete()&&this.cashfreeComponents.cardCvv.isComplete();this.paymentDetails.card.isValid=e,e&&(delete this.formErrors.cardNumber,delete this.formErrors.cardholderName,delete this.formErrors.expiryDate,delete this.formErrors.cvv)}}async setupCashfreeUpiComponent(){if(!this.cashfreeInstance){console.error("Cashfree SDK not loaded"),this.showUpiFormError("Secure UPI form could not be loaded. Please try again or select a different payment method.");return}try{const e=this.shadowRoot.querySelector("#cashfreeUpiLoading");e&&(e.style.display="block");const t={fields:{upiId:{label:"Enter your UPI ID",placeholder:"yourname@paytm"}},style:this.getCashfreeStyleObject()};this.cashfreeComponents.upiCollect=this.cashfreeInstance.create("upiCollect",t);const i=this.shadowRoot.querySelector("#upiCollect");i&&await this.cashfreeComponents.upiCollect.mount(i),this.cashfreeComponents.upiCollect.on("change",()=>{this.validateCashfreeUpiForm()}),e&&(e.style.display="none"),console.log("✅ Cashfree UPI component mounted successfully")}catch(e){console.error("Failed to setup Cashfree UPI component:",e),this.showUpiFormError("Failed to initialize secure UPI form. Please refresh and try again.")}}showUpiFormError(e){const t=this.shadowRoot.querySelector("#upiCollect");t&&(t.innerHTML=`<div style="color: #df1b41; padding: 12px; border: 1px solid #df1b41; border-radius: 12px; background: #fff5f5;">${e}</div>`)}validateCashfreeUpiForm(){if(this.cashfreeComponents.upiCollect){const e=this.cashfreeComponents.upiCollect.isComplete();this.paymentDetails.upi.isValid=e,e&&delete this.formErrors.upiId}}async setupCashfreeWalletComponents(){if(!this.cashfreeInstance){console.error("Cashfree SDK not loaded"),this.showWalletFormError("Secure wallet options could not be loaded. Please try again or select a different payment method.");return}try{const e=this.shadowRoot.querySelector("#cashfreeWalletLoading");e&&(e.style.display="block");const t=[{id:"phonepe",provider:"phonepe",buttonText:"PhonePe"},{id:"amazon",provider:"amazon",buttonText:"Amazon Pay"},{id:"paytm",provider:"paytm",buttonText:"Paytm"},{id:"freecharge",provider:"freecharge",buttonText:"FreeCharge"},{id:"mobikwik",provider:"mobikwik",buttonText:"Mobikwik"}],i=getComputedStyle(this.shadowRoot.host),o=(n,s)=>i.getPropertyValue(n).trim()||s,a={base:{fontSize:o("--billhive-font-size-body-text","12px"),padding:"12px",display:"flex",alignItems:"center",borderRadius:o("--billhive-element-border-radius","4px"),gap:"12px",border:`1px solid ${o("--billhive-border-color","#e5e7eb")}`,backgroundColor:"#FFFFFF",cursor:"pointer",fontFamily:o("--billhive-font-family","'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif"),color:o("--billhive-text-color","#111827"),":hover":{backgroundColor:o("--billhive-input-components-color","#f9fafb")}}};for(const n of t){const s={values:{provider:n.provider,phone:"1234567890",buttonText:n.buttonText,buttonIcon:!0},style:a},d=this.cashfreeInstance.create("wallet",s),c=this.shadowRoot.querySelector(`#${n.id}`);c&&(await d.mount(c),this.cashfreeComponents.wallets.set(n.provider,d),d.on("click",r=>{console.log(`${n.buttonText} wallet clicked:`,r),this.handleWalletSelection(n.provider,d)}))}e&&(e.style.display="none"),console.log("✅ Cashfree wallet components mounted successfully")}catch(e){console.error("Failed to setup Cashfree wallet components:",e),this.showWalletFormError("Failed to initialize wallet options. Please refresh and try again.")}}handleWalletSelection(e,t){this.paymentDetails.wallet.selectedProvider=e,this.paymentDetails.wallet.selectedComponent=t,this.paymentDetails.wallet.isValid=!0,delete this.formErrors.walletType,console.log(`Wallet ${e} selected and ready for payment`)}showWalletFormError(e){["#phonepe","#amazon","#paytm","#freecharge","#mobikwik"].forEach(i=>{const o=this.shadowRoot.querySelector(i);o&&(o.innerHTML=`<div style="color: #df1b41; padding: 12px; border: 1px solid #df1b41; border-radius: 12px; background: #fff5f5; text-align: center;">${e}</div>`)})}setupPaymentFormListeners(){const e=this.selectedPaymentMethod;if(e==="upi")this.setupCashfreeUpiComponent();else if(e==="card")this.setupCashfreeCardComponents();else if(e==="wallet")this.setupCashfreeWalletComponents();else if(e==="netbanking"){const t=this.shadowRoot.querySelector("#bankName");t&&t.addEventListener("change",i=>{this.handlePaymentInputChange("netbanking.bankName",i.target.value)})}}handlePaymentInputChange(e,t){const i=e.split(".");if(i.length===2){const[o,a]=i;this.paymentDetails[o]||(this.paymentDetails[o]={}),this.paymentDetails[o][a]=t,delete this.formErrors[a],this.updateFieldError(`payment.${o}.${a}`)}}setupModalEventListeners(){var s;this.planId&&!((s=this.selectedPlan)!=null&&s.ratePlanPriceId)&&(this.isLoadingPlan=!0,this.isLoadingAddons=!0,this.loadPlanFromApi().catch(d=>{console.error("Failed to load plan:",d)}));const e=this.shadowRoot.querySelector("#proceedBtn"),t=this.shadowRoot.querySelector("#backBtn"),i=this.shadowRoot.querySelector("#couponInput"),o=this.shadowRoot.querySelector("#applyCouponBtn"),a=this.shadowRoot.querySelector("#removeCouponBtn");if(e==null||e.addEventListener("click",()=>this.proceedToCheckout()),t==null||t.addEventListener("click",()=>this.goBackToPlanSelection()),this.shadowRoot.querySelectorAll(".addon-checkbox").forEach(d=>{d.addEventListener("change",c=>{this.toggleAddon(c.target.dataset.addonId)})}),this.shadowRoot.querySelectorAll(".addon-quantity-input").forEach(d=>{d.addEventListener("input",c=>{let r=c.target.value.replace(/[^\d]/g,"");r===""&&(r="1"),this.handleAddonQuantityChange(c.target.dataset.addonId,r)}),d.addEventListener("keypress",c=>{!/[\d]/.test(c.key)&&!["Backspace","Delete","Tab","Enter","ArrowLeft","ArrowRight"].includes(c.key)&&c.preventDefault()}),d.addEventListener("blur",c=>{const r=c.target.dataset.addonId,p=c.target.value;(!p||parseInt(p)<1)&&this.handleAddonQuantityChange(r,"1")})}),this.shadowRoot.querySelectorAll(".qty-btn").forEach(d=>{d.addEventListener("click",c=>{const r=c.target.dataset.addonId,p=c.target.dataset.action,m=this.addonQuantities.get(r)||1;p==="increase"&&m<999?this.handleAddonQuantityChange(r,m+1):p==="decrease"&&m>1&&this.handleAddonQuantityChange(r,m-1),this.render()})}),this.shadowRoot.querySelectorAll(".available-discount-card").forEach(d=>{d.addEventListener("click",c=>{if(c.target.classList.contains("remove-discount-btn"))return;const r=c.currentTarget.dataset.discountId;this.selectDiscount(r)})}),this.shadowRoot.querySelectorAll(".available-discount-card .remove-discount-btn").forEach(d=>{d.addEventListener("click",c=>{c.stopPropagation();const r=c.target.dataset.discountId;this.removeDiscount(r)})}),i==null||i.addEventListener("input",d=>{this.couponCode=d.target.value}),i==null||i.addEventListener("keypress",d=>{d.key==="Enter"&&this.applyCouponCode()}),o==null||o.addEventListener("click",()=>this.applyCouponCode()),a==null||a.addEventListener("click",()=>this.removeCoupon()),this.currentModalStep==="personal-details"&&(["firstName","lastName","email","phone","company"].forEach(d=>{const c=this.shadowRoot.querySelector(`[data-field="${d}"]`);c&&(c.addEventListener("input",r=>{this.handleInputChange(d,r.target.value)}),d==="email"&&(c.addEventListener("input",r=>{const p=r.target.value.trim();this.existingAccount&&this.existingAccount.email!==p&&(this.existingAccount=null,this.hideExistingAccountMessage())}),c.addEventListener("blur",r=>{const p=r.target.value.trim();p&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p)?this.handleEmailCheck(p):p||(this.existingAccount=null,this.hideExistingAccountMessage())})))}),["address.addressLine","address.city","address.state","address.zipCode","address.country"].forEach(d=>{const c=this.shadowRoot.querySelector(`[data-field="${d}"]`);c&&(c.addEventListener("input",r=>{this.handleInputChange(d,r.target.value)}),c.tagName==="SELECT"&&c.addEventListener("change",r=>{this.handleInputChange(d,r.target.value)}))})),this.currentModalStep==="payment-method"){this.shadowRoot.querySelectorAll(".payment-method-card").forEach((r,p)=>{const m=r.dataset.method;r.addEventListener("click",h=>{this.selectPaymentMethod(m)})});const c=this.shadowRoot.querySelector("#changeMethodBtn");c&&c.addEventListener("click",()=>{this.selectedPaymentMethod=null,this.render()}),this.selectedPaymentMethod&&this.setupPaymentFormListeners()}if(this.currentModalStep==="order-confirmation"){const d=this.shadowRoot.querySelector("#closeConfirmationBtn");d&&d.addEventListener("click",()=>{const c=new CustomEvent("order-completed",{detail:this.orderData,bubbles:!0});this.dispatchEvent(c),this.close()})}const n=this.shadowRoot.querySelector("#retryPlanLoad");n&&n.addEventListener("click",d=>{d.preventDefault(),this.loadPlanFromApi()})}renderSelectedPlan(){if(console.log("renderSelectedPlan:",{isLoadingPlan:this.isLoadingPlan,selectedPlan:this.selectedPlan,planId:this.planId,planLoadError:this.planLoadError}),this.isLoadingPlan&&!this.selectedPlan)return`
        <div class="selected-plan loading">
          <div class="loading-spinner"></div>
          <p>Loading plan details...</p>
        </div>
      `;if(this.planLoadError)return`
        <div class="selected-plan error">
          <div class="error-icon">⚠️</div>
          <p>Failed to load plan details: ${this.planLoadError}</p>
          <button class="btn btn-primary retry-btn" id="retryPlanLoad">Retry</button>
        </div>
      `;if(!this.selectedPlan)return`
        <div class="selected-plan default-plan">
          <div class="plan-info">
            <div class="plan-header">
              <span class="plan-name">No Plan Selected</span>
            </div>
            <div class="detail-item">
              <span class="value">Please select a plan to continue</span>
            </div>
          </div>

          <div class="plan-price">
            <div class="price-display">
              <span class="price">$0</span>
              <span class="period">/month</span>
            </div>
            <div class="billing-info">Select a plan to see pricing</div>
          </div>
        </div>
      `;const e=i=>({USD:"$",EUR:"€",GBP:"£",INR:"₹",JPY:"¥",CAD:"C$",AUD:"A$",CHF:"CHF",CNY:"¥",SEK:"kr"})[i==null?void 0:i.toUpperCase()]||i||"$",t=this.selectedPlan.currencyCode?e(this.selectedPlan.currencyCode):"$";return`
      <div class="selected-plan">
        <div class="plan-info">
          <div class="plan-header">
            <span class="plan-name">${this.selectedPlan.name}</span>
          </div>
          
          
            ${this.selectedPlan.productName?`<div class="detail-item"><span class="label">Product:</span> <span class="value">${this.selectedPlan.productName}</span></div>`:""}
    

          ${this.selectedPlan.isTrial&&this.selectedPlan.trialPeriod?`<div class="trial-info">
              <span class="trial-badge">Free Trial</span>
              <span class="trial-details">${this.selectedPlan.trialPeriod.periodName} free trial</span>
            </div>`:""}
            
        </div>
        
        <div class="plan-price">
          <div class="price-display">
            <span class="price">${t}${this.selectedPlan.price}</span>
            <span class="period">/${this.selectedPlan.period}</span>
          </div>
          ${this.selectedPlan.billingPeriod?`<div class="billing-info">Billed ${this.selectedPlan.billingPeriod.periodName}</div>`:""}
        </div>
      </div>
    `}renderAddonsContent(){return this.isLoadingAddons?'<div class="loading-state">Loading available add-ons...</div>':this.addonsLoadError?`<div class="error-state">Failed to load add-ons: ${this.addonsLoadError}</div>`:!this.addons||this.addons.length===0?'<div class="empty-state">No add-ons available for this plan.</div>':`
      <div class="addons-grid">
        ${this.addons.map(e=>this.renderAddon(e)).join("")}
      </div>
    `}getCurrencySymbol(e){return{USD:"$",EUR:"€",GBP:"£",INR:"₹",JPY:"¥",CNY:"¥",AUD:"A$",CAD:"C$",CHF:"Fr",SEK:"kr",NZD:"NZ$"}[e]||e||"$"}formatDisplayDate(e){if(!e)return"";try{return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}catch(t){return console.error("Error formatting date:",t),e}}isCouponRejected(){return!this.orderEstimate||!this.orderEstimate.cart?!1:this.orderEstimate.cart.some(e=>{var i,o;return(e.itemType==="Discount"||e.itemType==="Coupon"||((i=e.description)==null?void 0:i.toLowerCase().includes("coupon"))||((o=e.description)==null?void 0:o.toLowerCase().includes("discount")))&&e.status==="Rejected"})}getCouponStatusMessage(){var t;if(!this.orderEstimate||!this.orderEstimate.cart)return"";const e=this.orderEstimate.cart.find(i=>{var a,n;return(i.itemType==="Discount"||i.itemType==="Coupon"||((a=i.description)==null?void 0:a.toLowerCase().includes("coupon"))||((n=i.description)==null?void 0:n.toLowerCase().includes("discount")))&&i.status==="Rejected"});return e&&((t=e.options)!=null&&t.reason)?`<div class="coupon-error">${e.options.reason}</div>`:""}isSuccessfullyAppliedCoupon(){return!this.orderEstimate||!this.orderEstimate.cart?!1:!!this.orderEstimate.cart.find(t=>{var o,a;return(t.itemType==="Coupon"||((o=t.description)==null?void 0:o.toLowerCase().includes("coupon"))&&!((a=t.itemType)!=null&&a.includes("Discount")))&&t.status!=="Rejected"})}getAppliedCouponName(){if(!this.orderEstimate||!this.orderEstimate.cart)return"";const e=this.orderEstimate.cart.find(t=>{var o,a;return(t.itemType==="Coupon"||((o=t.description)==null?void 0:o.toLowerCase().includes("coupon"))&&!((a=t.itemType)!=null&&a.includes("Discount")))&&t.status!=="Rejected"});return e?e.description:""}isDiscountSuccessfullyApplied(e){return!this.orderEstimate||!this.orderEstimate.cart?!1:this.orderEstimate.cart.some(t=>t.itemType==="Discount"&&(t.itemId===e||t.discountId===e)&&t.status!=="Rejected")}renderAddon(e){const t=this.selectedAddons.has(e.id),i=this.getCurrencySymbol(e.currencyCode),o=e.period,a=e.unitOfMeasurement?` per ${e.unitOfMeasurement}`:"",n=this.addonQuantities.get(e.id)||1;return`
      <div class="addon-card ${t?"selected":""}">
        
        <div class="addon-content">
          <div class="addon-left">
            <label class="addon-label">
              <input 
                type="checkbox" 
                class="addon-checkbox" 
                data-addon-id="${e.id}"
                ${t?"checked":""}
              >
              <div class="addon-info">
                <span class="addon-name">${e.name}</span>
                <p class="addon-description">${e.description}</p>
              </div>
            </label>
          </div>
          <div class="addon-right">
            <div class="addon-price-section">
              <span class="addon-price">
                ${e.isPriceIncluded?"Included":`+${i}${e.price}/${o}${a}`}
              </span>
              ${t?`
                <div class="addon-quantity-control">
                  <label for="addon-qty-${e.id}" style="margin-right: 8px;">Quantity:</label>
                  <div class="quantity-input-group" style="display: inline-flex; align-items: center;">
                    <button class="btn btn-sm qty-btn qty-decrease" data-addon-id="${e.id}" data-action="decrease" ${n<=1?"disabled":""}>-</button>
                    <input
                      type="number"
                      id="addon-qty-${e.id}"
                      class="addon-quantity-input"
                      data-addon-id="${e.id}"
                      value="${n}"
                      min="1"
                      max="999"
                      style="width: 60px; text-align: center; margin: 0 8px;"
                    >
                    <button class="btn btn-sm qty-btn qty-increase" data-addon-id="${e.id}" data-action="increase" ${n>=999?"disabled":""}>+</button>
                  </div>
                </div>
              `:""}
            </div>
          </div>
        </div>
      </div>
    `}renderDiscount(e){var o;const t=((o=this.selectedDiscount)==null?void 0:o.id)===e.id,i=e.type==="percentage"?`${e.value}% off`:`$${e.value} off`;return`
      <div class="discount-card ${t?"selected":""}" data-discount-id="${e.id}">
        <div class="discount-header">
          <span class="discount-name">${e.name}</span>
          <span class="discount-value">${i}</span>
        </div>
        <p class="discount-description">${e.description}</p>
        <span class="discount-code">Code: ${e.code}</span>
      </div>
    `}renderOrderSummary(){if(!this.selectedPlan)return`
        <div class="default-summary">
          <div class="summary-item">
            <div class="item-details">
              <span class="item-name">Select a plan to see pricing</span>
            </div>
          </div>

          <div class="summary-divider"></div>

          <div class="summary-subtotal">
            <span class="subtotal-label">Subtotal</span>
            <span class="subtotal-price">$0.00</span>
          </div>

          <div class="summary-tax">
            <span class="tax-label">Tax</span>
            <span class="tax-amount">$0.00</span>
          </div>

          <div class="summary-divider"></div>

          <div class="summary-total">
            <span class="total-label">Total</span>
            <span class="total-price">$0.00</span>
          </div>
        </div>
      `;if(this.isLoadingEstimate)return`
        <div class="loading-items">
          <div class="spinner"></div>
          <p>Loading items...</p>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-subtotal">
          <span class="subtotal-label">Subtotal</span>
          <span class="subtotal-price loading-text">Calculating...</span>
        </div>

        <div class="summary-tax">
          <span class="tax-label">Tax</span>
          <span class="tax-amount loading-text">Calculating...</span>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-total">
          <span class="total-label">Total</span>
          <span class="total-price loading-text">Calculating...</span>
        </div>
      `;if(this.estimateError)return`
        <div class="error-items">
          <p>Unable to load items</p>
          <small>${this.estimateError}</small>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-subtotal">
          <span class="subtotal-label">Subtotal</span>
          <span class="subtotal-price">$0.00</span>
        </div>

        <div class="summary-tax">
          <span class="tax-label">Tax</span>
          <span class="tax-amount">$0.00</span>
        </div>

        <div class="summary-divider"></div>

        <div class="summary-total">
          <span class="total-label">Total</span>
          <span class="total-price">$0.00</span>
        </div>
      `;if(!this.orderEstimate)return`
        <div class="loading-summary">
          <p>Loading order summary...</p>
        </div>
      `;const e=this.orderEstimate,t=this.getCurrencySymbol(e.currency||this.selectedPlan.currencyCode);let i="";const o=[],a=[],n=new Map;let s=null;if(e.cart&&e.cart.length>0&&e.cart.forEach(r=>{var m,h;if(!((r.itemType==="Discount"||r.itemType==="Coupon"||(m=r.description)!=null&&m.toLowerCase().includes("coupon")||(h=r.description)!=null&&h.toLowerCase().includes("discount"))&&r.status==="Rejected"))if(r.itemType==="Rate Plan"&&r.status==="Reserved"&&r.nextBillingDate&&(s=this.formatDisplayDate(r.nextBillingDate)),r.itemType==="Discount"&&r.itemId&&r.status!=="Reserved"){n.has(r.itemId)||n.set(r.itemId,{description:r.description,items:[],totalAmount:0});const u=n.get(r.itemId);u.items.push(r),u.totalAmount+=r.amount}else r.status==="Reserved"?a.push(r):o.push(r)}),o.forEach(r=>{var b,v;const p=r.itemType==="Discount"||r.itemType==="Coupon"||((b=r.description)==null?void 0:b.toLowerCase().includes("coupon"))||((v=r.description)==null?void 0:v.toLowerCase().includes("discount"));if(r.itemType==="Discount")return;const m=r.fromDate&&!p?this.formatDisplayDate(r.fromDate):"",h=r.toDate&&!p?this.formatDisplayDate(r.toDate):"",u=m&&h?`${m} - ${h}`:"";i+=`
        <div class="summary-item">
          <div class="item-details">
            <span class="item-name">${r.description}</span>
            ${u?`<span class="item-dates">${u}</span>`:""}
          </div>
          <span class="item-price ${p?"discount-price":""}">
            ${p?"-":""}${t}${r.amount.toFixed(2)}
          </span>
        </div>
      `}),n.forEach((r,p)=>{const m=r.items.length>1;i+=`
        <div class="summary-item discount-group">
          <div class="item-details">
            <span class="item-name">
              ${r.description}
              ${m?`
                <span class="discount-info-icon" data-discount-id="${p}">
                  ⓘ
                  <div class="discount-tooltip">
                    <div class="tooltip-title">Applied on:</div>
                    ${r.items.map(h=>{var b;return`<div class="tooltip-item">- ${((b=h.options)==null?void 0:b.itemType)||"Item"}: ${t}${h.amount.toFixed(2)}</div>`}).join("")}
                  </div>
                </span>
              `:""}
            </span>
          </div>
          <span class="item-price discount-price">
            -${t}${r.totalAmount.toFixed(2)}
          </span>
        </div>
      `}),a.length>0){const r=new Map,p=[];a.forEach(h=>{if(h.itemType==="Discount"&&h.itemId){r.has(h.itemId)||r.set(h.itemId,{description:h.description,items:[],totalAmount:0});const u=r.get(h.itemId);u.items.push(h),u.totalAmount+=h.amount}else p.push(h)});const m=a.reduce((h,u)=>h+u.amount,0);i+=`
        <div class="reserved-items-section">
          ${s?`
            <div class="reserved-billing-date">
              Next Billing Date - <span class="billing-date-value">${s}</span>
            </div>
          `:""}
          
          ${p.map(h=>{var g,E;const u=h.itemType==="Discount"||h.itemType==="Coupon"||((g=h.description)==null?void 0:g.toLowerCase().includes("coupon"))||((E=h.description)==null?void 0:E.toLowerCase().includes("discount")),b=h.fromDate&&!u?this.formatDisplayDate(h.fromDate):"",v=h.toDate&&!u?this.formatDisplayDate(h.toDate):"",x=b&&v?`${b} - ${v}`:"";return`
              <div class="summary-item reserved-item">
                <div class="item-details">
                  <span class="item-name">${h.description}</span>
                  ${x?`<span class="item-dates">${x}</span>`:""}
                </div>
                <span class="item-price ${u?"discount-price":""}">
                  ${u?"-":""}${t}${h.amount.toFixed(2)}
                </span>
              </div>
            `}).join("")}
          
          ${Array.from(r.entries()).map(([h,u])=>{const b=u.items.length>1;return`
              <div class="summary-item reserved-item discount-group">
                <div class="item-details">
                  <span class="item-name">
                    ${u.description}
                    ${b?`
                      <span class="discount-info-icon" data-discount-id="${h}">
                        ⓘ
                        <div class="discount-tooltip">
                          <div class="tooltip-title">Applied on:</div>
                          ${u.items.map(v=>{var g;return`<div class="tooltip-item">- ${((g=v.options)==null?void 0:g.itemType)||"Item"}: ${t}${v.amount.toFixed(2)}</div>`}).join("")}
                        </div>
                      </span>
                    `:""}
                  </span>
                </div>
                <span class="item-price discount-price">
                  -${t}${u.totalAmount.toFixed(2)}
                </span>
              </div>
            `}).join("")}
          
          <div class="reserved-subtotal">
            <span class="subtotal-label">Subtotal</span>
            <span class="subtotal-price">${t}${m.toFixed(2)}</span>
          </div>
        </div>
      `}i+=`
      <div class="summary-divider"></div>
      <div class="summary-subtotal">
        <span class="subtotal-label">Subtotal</span>
        <span class="subtotal-price" data-value="${e.subtotal}">${t}${e.subtotal.toFixed(2)}</span>
      </div>
    `,e.discounts&&e.discounts.length>0&&e.discounts.forEach(r=>{i+=`
          <div class="summary-discount">
            <span class="discount-label">${r.name}</span>
            <span class="discount-amount">-${t}${r.amount.toFixed(2)}</span>
          </div>
        `});const d=e.tax||0;i+=`
      <div class="summary-tax">
        <span class="tax-label">Tax</span>
        <span class="tax-amount" data-value="${d}">${t}${d.toFixed(2)}</span>
      </div>
    `,i+=`
      <div class="summary-divider"></div>
      <div class="summary-total">
        <span class="total-label">Total</span>
        <span class="total-price" data-value="${e.total}">${t}${e.total.toFixed(2)}/${this.selectedPlan.period||"month"}</span>
      </div>
    `;const c=e.discounts?e.discounts.reduce((r,p)=>r+p.amount,0):0;return c>0&&(i+=`
        <div class="savings-notice">
          You save ${t}${c.toFixed(2)}!
        </div>
      `),i}getStyles(){return console.log("getStyles theme is:",w(this.theme)),`
      <style>
        ${w(this.theme)}
        
        :host {
          font-family: var(--billhive-font-family, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif);
          font-size: 12px;
        }

        /* Custom scrollbar styles - thin and visible only on hover */
        * {
          scrollbar-width: thin;
          scrollbar-color: transparent transparent;
        }

        *:hover {
          scrollbar-color: rgba(0, 0, 0, 0.3) transparent;
        }

        /* Webkit browsers (Chrome, Safari, Edge) */
        *::-webkit-scrollbar {
          width: 12px;
          height: 12px;
        }

        *::-webkit-scrollbar-track {
          background: transparent;
        }

        *::-webkit-scrollbar-thumb {
          background-color: transparent;
          border-radius: 12px;
          transition: background-color 0.3s ease;
        }

        *:hover::-webkit-scrollbar-thumb {
          background-color: rgba(0, 0, 0, 0.3);
        }

        *::-webkit-scrollbar-thumb:hover {
          background-color: rgba(0, 0, 0, 0.5);
        }

        .btn {
          display: inline-block;
          font-weight: 400;
          text-align: center;
          white-space: nowrap;
          vertical-align: middle;
          user-select: none;
          border: 1px solid transparent;
          padding: 8px 12px;
          font-size: var(--billhive-font-size-body-text, 12px);
          line-height: 1.5;
          border-radius: var(--billhive-element-border-radius, 4px);
          transition: all 0.15s ease-in-out;
          cursor: pointer;
          text-decoration: none;
          font-family: var(--billhive-font-family);
        }

        .btn-primary {
          color: var(--billhive-header-color, #fff);
          background-color: var(--billhive-accent-color, #145388);
          border-color: var(--billhive-accent-color, #145388);
        }
		
		    .btn-primary:hover {
          color: var(--billhive-header-color, #fff);
          background-color: var(--billhive-accent-hover, #0f3f65);
          border-color: var(--billhive-accent-hover, #0f3f65);
          box-shadow: var(--billhive-button-shadow, 0 2px 4px rgba(20, 83, 136, 0.3));
        }

        .btn-primary:focus {
          outline: 0;
          box-shadow: var(--billhive-button-shadow, 0 0 0 12px rgba(20, 83, 136, 0.25));
        }

        .btn-block {
          display: block;
          width: 100%;
        }


        .full-page-container {
          background: var(--billhive-highlight-panel-color, white);
          width: 100%;
          min-height: 100vh;
          display: flex;
          flex-direction: column;
          font-family: var(--billhive-font-family);
        }

        .page-header {
          background: var(--billhive-header-color, white);
          border-bottom: 1px solid var(--billhive-border-color, #e0e0e0);
          padding: 18px 24px;
          position: sticky;
          top: 0;
        }

        .page-header-content {
          display: flex;
          justify-content: space-between;
          align-items: center;
          max-width: 1200px;
          margin: 0 auto;
        }

        .page-header-content h2 {
          margin: 0;
          font-size: 21px;
          font-weight: 600;
          
        }

        .page-content {
          flex: 1;
          max-width: 1100px;
          margin: 0 auto;
          width: 90%;
          box-sizing: border-box;
          display: flex;
          overflow: hidden;
        }

        .page-body {
          flex: 2;
          padding-right: 14px;
          overflow-y: auto;
        }

        .page-sidebar {
          flex: 1;
          background: var(--billhive-disabled-color, #f8f9fb);
          border-radius: 8px
          border: 2px solid var(--billhive-border-color, #e7ecf3);
          display: flex;
          flex-direction: column;
        }

        .modal-overlay.visible .modal-container {
          transform: translate(0, 0) scale(1);
        }

        .modal-overlay.fade-in .modal-container {
          transform: translate(0, -30px) scale(0.95);
        }

        .modal-overlay.fade-in.show .modal-container {
          transform: translate(0, 0) scale(1);
        }

        .modal-header {
          padding: 0;
          border-bottom: 1px solid var(--billhive-border-color, #e7ecf3);
          padding: 14px 18px;
          background: var(--billhive-header-color, #f9fafb);
        }

        .modal-header-content {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 12px;
        }

        .modal-header h2 {
          font-size: var(--billhive-font-size-heading, 12px);
          font-weight: var(--billhive-header-font-weight, 700);
          color: var(--billhive-text-color, #364a63);
          margin: 0;
          font-family: var(--billhive-font-family);
        }

        .close-btn {
          position: absolute;
          top: 12px;
          right: 12px;
          height: 27px;
          width: 27px;
          display: inline-flex;
          justify-content: center;
          align-items: center;
          color: var(--billhive-sub-text-color, #8094ae);
          z-index: 1;
          transition: all 0.3s;
          background: none;
          border: none;
          border-radius: var(--billhive-element-border-radius, 4px);
          cursor: pointer;
          font-size: 15px;
          font-weight: 700;
          line-height: 1;
          opacity: 0.5;
          padding: 0;
        }

        .close-btn:hover {
          opacity: 0.75;
        }

        /* Progress Stepper Styles */
        .progress-indicator {
          padding: 18px 24px;
          background: var(--billhive-cards-color, #fff);
          max-width: 1200px;
          margin: 0 auto;
          width: 100%;
          box-sizing: border-box;
        }

        .progress-steps {
          display: flex;
          align-items: center;
          justify-content: center;
          max-width: 500px;
          margin: 0 auto;
        }

        .progress-step {
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 12px;
          flex: 1;
        }

        .step-icon {
          width: 22px;
          height: 22px;
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: 600;
          font-size: 12px;
          background: var(--billhive-input-components-color, #e7ecf3);
          color: var(--billhive-sub-text-color, #8094ae);
          transition: all 0.3s ease;
          font-family: var(--billhive-font-family);
        }

        .progress-step.active .step-icon {
          background: var(--billhive-accent-color, #145388);
          color: var(--billhive-header-color, white);
        }

        .progress-step.completed .step-icon {
          background: var(--billhive-accent-color, #145388);
          color: white;
        }

        .step-label {
          font-size: var(--billhive-font-size-sub-text, 12px);
          font-weight: 500;
          color: var(--billhive-sub-text-color, #8094ae);
          text-align: center;
          transition: color 0.3s ease;
          line-height: 1;
          font-family: var(--billhive-font-family);
        }

        .progress-step.active .step-label,
        .progress-step.completed .step-label {
          color: var(--billhive-text-color, #364a63);
        }

        .step-connector {
          flex: 1;
          height: 2px;
          background: var(--billhive-border-color, #e7ecf3);
          margin: 0 12px;
          position: relative;
          top: -12px;
        }

        .progress-step.completed + .step-connector {
          background: #10b981;
        }

        .modal-content {
          display: flex;
          flex: 1;
          overflow: hidden;
        }

        .page-body {
          flex: 2;
          overflow-y: auto;
          max-height: calc(82vh - 140px);
        }

        .page-sidebar {
          flex: 1;
          background: var(--billhive-disabled-color, #f8f9fb);
          border: 2px solid var(--billhive-border-color, #e7ecf3);
          border-radius: 8px;
          display: flex;
          flex-direction: column;
          max-height: calc(103vh - 200px); /* Full-page mode: account for header + stepper + padding */
        }

        /* Modal mode - when inside modal-container, use different max-height */
        :host([data-mode="modal"]) .page-sidebar {
          max-height: calc(85vh - 140px); /* Modal mode: account for modal padding */
        }

        .plan-section, .addons-section {
          margin-bottom: 15px;
        }

        .plan-section h3, .addons-section h3 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          margin: 0 0 12px 0;
          font-family: var(--billhive-font-family);
        }

        .selected-plan {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 12px;
          background: var(--billhive-disabled-color, #f8f9fb);
          border-radius: var(--billhive-element-border-radius, 8px);
          border: 2px solid var(--billhive-border-color, #e7ecf3);
        }

        .plan-info {
          display: flex;
          flex-direction: column;
          align-items: flex-start;
          flex: 1;
        }
        

        .selected-plan.loading {
          flex-direction: column;
          justify-content: center;
          align-items: center;
          gap: 12px;
          min-height: 70px;
        }

        .selected-plan.error {
          flex-direction: column;
          justify-content: center;
          align-items: center;
          gap: 12px;
          background: #fef5f5;
          border-color: #fed7d7;
          color: #c53030;
        }

        .selected-plan.default-plan {
          background: var(--billhive-highlight-panel-color, #f9fafb);
          border: 2px dashed var(--billhive-border-color, #e7ecf3);
          opacity: 0.8;
        }

        .selected-plan.default-plan .plan-name {
          color: var(--billhive-sub-text-color, #8094ae);
        }

        .selected-plan.default-plan .value {
          color: var(--billhive-sub-text-color, #8094ae);
          font-style: italic;
        }

        .selected-plan.default-plan .price {
          color: var(--billhive-sub-text-color, #8094ae);
        }

        .selected-plan.default-plan .billing-info {
          color: var(--billhive-sub-text-color, #8094ae);
          font-style: italic;
        }

        .loading-spinner {
          width: 24px;
          height: 24px;
          border: 2px solid var(--billhive-loading-color, #e2e8f0);
          border-top: 2px solid var(--billhive-accent-color, #145388);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .error-icon {
          font-size: 18px;
        }

        .retry-btn {
          padding: 12px 14px;
          background: var(--billhive-accent-color, #145388);
          color: var(--billhive-header-color, white);
          border: none;
          border-radius: var(--billhive-element-border-radius, 4px);
          cursor: pointer;
          font-size: var(--billhive-text-font-size, 12px);
          font-family: var(--billhive-font-family);
          transition: all 0.2s ease;
        }

        .retry-btn:hover {
          background: var(--billhive-accent-hover, #0f3f65);
          box-shadow: var(--billhive-button-shadow, 0 2px 4px rgba(20, 83, 136, 0.3));
        }

        .product-name {
          display: block;
          color: #8094ae;
          font-size: 12px;
          margin-top: 12px;
        }

        .trial-info {
          display: flex;
          align-items: center;
          gap: 12px;
          margin-top: 12px;
          width: 100%;
        }

        .trial-badge {
          background: #38a169;
          color: white;
          padding: 12px 12px;
          border-radius: 12px;
          font-size: 12px;
          font-weight: 600;
        }

        .trial-details {
          color: #38a169;
          font-size: 12px;
          font-weight: 500;
        }

        .recommended-badge {
          background: var(--billhive-accent-color, #145388);
          color: var(--billhive-header-color, white);
          padding: 12px 12px;
          border-radius: 12px;
          font-size: 12px;
          font-weight: 600;
          margin-left: 12px;
        }

        .plan-header {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .plan-name {
        font-size: var(--billhive-font-size-body-text, 12px);
        font-weight: var(--billhive-header-font-weight, 600);
        }

        .plan-description {
          color: #8094ae;
          font-size: 12px;
          margin-bottom: 12px;
        }

        .plan-details {
          display: grid;
          gap: 12px;
          margin-bottom: 14px;
        }

        .detail-item {
          font-size: 12px;
          display: block;
          margin-bottom: 12px;
        }

        .detail-item .label {
          color: #8094ae;
          font-weight: 500;
          min-width: 80px;
        }

        .detail-item .value {
          color: #364a63;
          font-weight: 600;
        }

        .status-active {
          color: #38a169;
        }

        .status-inactive {
          color: #e53e3e;
        }

        .plan-features {
          display: flex;
          flex-direction: column;
          gap: 12px;
          margin-top: 14px;
        }

        .feature-item {
          font-size: 12px;
          color: #364a63;
        }

        .price-display {
          display: flex;
          align-items: baseline;
          gap: 12px;
        }

        .price {
          font-size: var(--billhive-font-size-heading, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          font-family: var(--billhive-font-family);
        }

        .period {
          font-size: var(--billhive-font-size-body-text, 12px);
          color: var(--billhive-sub-text-color, #8094ae);
          font-family: var(--billhive-font-family);
        }

        .billing-info {
          font-size: var(--billhive-font-size-sub-text, 12px);
          color: var(--billhive-sub-text-color, #8094ae);
          margin-top: 12px;
          font-family: var(--billhive-font-family);
        }

        .plan-info h4 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          margin: 0 0 12px 0;
          font-family: var(--billhive-font-family);
        }

        .plan-info p {
          color: #8094ae;
          font-size: var(--billhive-font-size-body-text, 12px);
          margin: 0;
        }

        .plan-price .price {
          font-size: var(--billhive-font-size-body-text, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          font-family: var(--billhive-font-family);
        }

        .addons-grid {
          display: grid;
          gap: 14px;
        }

        .addon-card {
          padding: 12px;
          border: 2px solid #e7ecf3;
          border-radius: var(--billhive-element-border-radius, 8px);
          transition: all 0.2s ease;
          cursor: pointer;
          position: relative;
          background-color: var(--billhive-cards-color, white);
        }

        .addon-card:hover {
          border-color: var(--billhive-accent-color, #526484);
        }

        .addon-card.selected {
          border-color: var(--billhive-accent-color, #526484);
          background: var(--billhive-disabled-color, #f8f9fb);
        }

        .addon-card.recommended {
          border-color: #4CAF50;
        }

        .addon-badge {
          position: absolute;
          top: -12px;
          right: 12px;
          background: #4CAF50;
          color: white;
          padding: 2px 8px;
          border-radius: var(--billhive-element-border-radius, 4px);
          font-size: 12px;
          font-weight: 600;
        }

        .addon-quantity {
          margin: 0;
          font-size: var(--billhive-font-size-sub-text, 12px);
          color: var(--billhive-sub-text-color, #8094ae);
          text-align: right;
          font-family: var(--billhive-font-family);
        }

        .addon-quantity-control {
          margin-top: 12px;
          display: flex;
          flex-direction: column;
          align-items: flex-end;
          gap: 12px;
          font-size: var(--billhive-font-size-sub-text, 12px);
          color: var(--billhive-text-color, #364a63);
        }

        .quantity-input-group {
          display: flex;
          align-items: center;
          border: 1px solid #e7ecf3;
          border-radius: var(--billhive-element-border-radius, 4px);
          overflow: hidden;
          background: white;
        }

        .qty-btn {
          background: var(--billhive-accent-color, #526484);
          color: white;
          border: none;
          width: 28px;
          height: 28px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          transition: background-color 0.2s ease;
          font-size: 14px;
          font-weight: 600;
        }

        .qty-btn:hover {
          background: var(--billhive-accent-color-hover, #455a77);
        }

        .qty-btn:disabled {
          background: #e7ecf3;
          color: #8094ae;
          cursor: not-allowed;
        }

        .addon-quantity-input {
          border: none;
          outline: none;
          font-size: var(--billhive-font-size-sub-text, 12px);
          font-family: var(--billhive-font-family);
          color: var(--billhive-text-color, #364a63);
          background: transparent;
        }

        .addon-quantity-input::-webkit-outer-spin-button,
        .addon-quantity-input::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }

        .addon-quantity-input[type=number] {
          -moz-appearance: textfield;
        }

        .loading-state, .error-state, .empty-state {
          padding: 20px;
          text-align: center;
          color: #666;
        }

        .error-state {
          color: #f44336;
        }

        .addon-content {
          display: flex;
          align-items: flex-start;
          gap: 14px;
        }

        .addon-left {
          flex: 1;
        }

        .addon-right {
          display: flex;
          align-items: flex-start;
        }

        .addon-price-section {
          display: flex;
          flex-direction: column;
          align-items: flex-end;
          gap: 12px;
        }

        .addon-label {
          display: flex;
          align-items: flex-start;
          gap: 12px;
          cursor: pointer;
        }

        .addon-info {
          flex: 1;
          text-align: left;
        }

        .addon-name {
          font-weight: 500;
          color: #364a63;
          display: block;
          margin-bottom: 12px;
          text-align: left;
          font-size: var(--billhive-font-size-body-text, 12px);
        }

        .addon-checkbox {
          width: 16px;
          height: 16px;
          accent-color: var(--billhive-accent-color, #526484);
          margin-top: 2px;
        }

        .addon-price {
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          font-size: var(--billhive-font-size-body-text, 12px);
          font-family: var(--billhive-font-family);
        }

        .addon-description {
          color: #8094ae;
          font-size: var(--billhive-font-size-sub-text, 12px);
          margin: 0;
          text-align: left;
        }

        .order-summary {
          display: flex;
          flex-direction: column;
          height: 100%;
        }

        .order-summary-content {
          flex: 1;
          padding: 15px;
          overflow-y: auto;
        }

        .order-summary h3 {
          font-size: var(--billhive-font-size-sub-heading, 16px);
          font-weight: 600;
          color: #364a63;
          margin: 0 0 8px 0;
        }

        .sidebar-footer {
          padding: 14px 15px 15px 15px;
          border-top: 1px solid #e7ecf3;
          background: #f8f9fb;
          margin-top: auto;
        }

        .loading-summary, .error-summary {
          padding: 18px;
          text-align: center;
          color: var(--billhive-sub-text-color, #64748b);
        }

        .loading-summary .spinner {
          width: 24px;
          height: 24px;
          border: 2px solid #e7ecf3;
          border-top-color: var(--billhive-primary-color, #F15A29);
          border-radius: 50%;
          margin: 0 auto 12px;
          animation: spin 0.8s linear infinite;
        }

        .error-summary {
          color: #dc2626;
        }

        .error-summary small {
          display: block;
          margin-top: 12px;
          font-size: 12px;
          opacity: 0.8;
        }

        .summary-item {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          padding: 6px 0;
          border-bottom: 1px solid #e7ecf3;
        }

        .item-details {
          display: flex;
          flex-direction: column;
          gap: 2px;
          flex: 1;
          text-align: left;
        }

        .item-name {
          color: #364a63;
          font-size: var(--billhive-font-size-body-text, 12px);
          font-weight: 500;
          text-align: left;
          margin: 0;
          padding: 0;
        }

        .item-dates {
          color: var(--billhive-sub-text-color, #8094ae);
          font-size: var(--billhive-font-size-sub-text, 12px);
          text-align: left;
          margin: 0;
          padding: 0;
        }

        .item-price {
          font-weight: 600;
          color: #364a63;
          font-size: var(--billhive-font-size-body-text, 12px);
          margin-left: 14px;
          white-space: nowrap;
        }

        .item-price.discount-price {
          color: #10b981;
        }

        .reserved-items-section {
          background: #fef2f2;
          border-radius: var(--billhive-element-border-radius, 12px);
          margin: 14px 0;
          padding: 12px;
        }

        .reserved-billing-date {
          color: #dc2626;
          font-size: var(--billhive-font-size-body-text, 12px);
          margin-bottom: 12px;
          text-align: left;
          padding-bottom: 12px;
        }

        .reserved-billing-date .billing-date-value {
          color: #364a63;
        }

        .reserved-item {
          margin-bottom: 12px;
        }

        .reserved-item:last-of-type {
          margin-bottom: 12px;
        }

        .reserved-subtotal {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding-top: 12px;
          margin-top: 12px;
        }

        .reserved-subtotal .subtotal-label {
          color: #dc2626;
          font-size: var(--billhive-font-size-body-text, 12px);
        }

        .reserved-subtotal .subtotal-price {
          color: #dc2626;
          font-size: var(--billhive-font-size-body-text, 12px);
        }

        .reserved-items-section .item-price {
          font-weight: normal;
        }

        .summary-divider {
          height: 1px;
          background: #e7ecf3;
          margin: 1px 0;
        }

        .loading-items,
        .error-items {
          display: flex;
          flex-direction: column;
          align-items: center;
          justify-content: center;
          padding: 24px 12px;
          gap: 12px;
        }

        .loading-items .spinner {
          width: 24px;
          height: 24px;
          border: 2px solid var(--billhive-border-color, #e2e8f0);
          border-top: 2px solid var(--billhive-accent-color, #145388);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        .loading-items p,
        .error-items p {
          margin: 0;
          font-size: var(--billhive-font-size-body-text, 12px);
          color: var(--billhive-sub-text-color, #8094ae);
        }

        .error-items p {
          color: #c53030;
        }

        .error-items small {
          font-size: var(--billhive-font-size-sub-text, 12px);
          color: var(--billhive-sub-text-color, #8094ae);
        }

        .loading-text {
          color: var(--billhive-sub-text-color, #8094ae);
          font-style: italic;
          font-size: var(--billhive-font-size-sub-text, 12px);
        }

        .summary-total {
          display: flex;
          justify-content: space-between;
          align-items: center;
          font-size: var(--billhive-font-size-sub-heading, 14px);
          font-weight: 700;
          color: #364a63;
          padding: 12px 0;
        }

        .proceed-btn {
          width: 100%;
          background: var(--billhive-accent-color, #526484);
          color: var(--billhive-header-color, white);
          border: 2px solid var(--billhive-accent-color, #526484);
          padding: 8px 15px;
          border-radius: var(--billhive-element-border-radius, 8px);
          font-size: var(--billhive-font-size-body-text, 12px);
          font-weight: 600;
          cursor: pointer;
          transition: all 0.2s ease;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 12px;
          margin: 0;
          font-family: var(--billhive-font-family);
        }

        .proceed-btn:hover:not(:disabled) {
          background: var(--billhive-accent-hover, #455670);
          border-color: var(--billhive-accent-hover, #455670);
          transform: translateY(-1px);
          box-shadow: var(--billhive-button-shadow, 0 4px 12px rgba(82, 100, 132, 0.3));
        }

        .proceed-btn:disabled {
          background: #e0e0e0;
          border-color: #e0e0e0;
          color: #999;
          cursor: not-allowed;
          opacity: 0.6;
        }

        .proceed-btn:disabled:hover {
          transform: none;
          box-shadow: none;
        }

        /* Available Discounts in Sidebar */
        .available-discounts-section {
          border-top: 1px solid #e7ecf3;
          padding-top: 14px;
          margin-top: 14px;
        }

        .available-discounts-section h4 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: 600;
          color: #364a63;
          margin: 0 0 12px 0;
        }

        .available-discounts-grid {
          display: grid;
          gap: 12px;
        }

        .available-discount-card {
          padding: 12px;
          border: 1px solid #e7ecf3;
          border-radius: var(--billhive-element-border-radius, 12px);
          transition: all 0.2s ease;
          cursor: pointer;
          background: white;
          background-color: var(--billhive-cards-color, white);
        }

        .available-discount-card:hover {
          border-color: var(--billhive-accent-color, #526484);
          background: var(--billhive-disabled-color, #f8f9fb);
        }

        .available-discount-card.selected {
          border-color: var(--billhive-accent-color, #526484);
          background: var(--billhive-accent-light, #f0f7ff);
        }

        .available-discount-card.applied {
          border-color: #10b981;
          background: #f0fdf4;
        }

        .discount-applied-badge {
          display: inline-block;
          color: #10b981;
          font-size: var(--billhive-font-size-sub-text, 12px);
          font-weight: 600;
          margin-top: 12px;
        }

        .available-discount-card .remove-discount-btn {
          background: transparent;
          color: #dc2626;
          border: none;
          width: 24px;
          height: 24px;
          display: flex;
          align-items: center;
          justify-content: center;
          cursor: pointer;
          font-size: 24px;
          font-weight: bold;
          transition: color 0.2s;
          padding: 0;
          line-height: 1;
        }

        .available-discount-card .remove-discount-btn:hover {
          color: #b91c1c;
        }

        .available-discount-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 4px;
        }

        .available-discount-name {
          font-weight: 600;
          color: #364a63;
          font-size: var(--billhive-font-size-body-text, 12px);
        }

        .available-discount-value {
          font-weight: 600;
          color: var(--billhive-text-color, #364a63);
          font-size: var(--billhive-font-size-body-text, 12px);
        }

        .available-discount-description {
          color: #8094ae;
          font-size: var(--billhive-font-size-sub-text, 12px);
          margin: 0 0 12px 0;
          line-height: 1.3;
        }

        .available-discount-code {
          font-size: var(--billhive-font-size-sub-text, 12px);
          color: var(--billhive-text-color, #364a63);
          background: var(--billhive-input-components-color, #e7ecf3);
          padding: 3px 12px;
          border-radius: var(--billhive-element-border-radius, 12px);
          font-weight: 500;
          font-family: var(--billhive-font-family);
        }

        /* Loading and error states for offers */
        .loading-offers {
          display: flex;
          align-items: center;
          gap: 12px;
          padding: 14px;
          text-align: center;
          color: var(--billhive-sub-text-color, #8094ae);
          font-size: var(--billhive-font-size-sub-text, 12px);
        }

        .loading-offers .spinner {
          width: 16px;
          height: 16px;
          border: 2px solid var(--billhive-disabled-color, #e7ecf3);
          border-top: 2px solid var(--billhive-accent-color, #526484);
          border-radius: 50%;
          animation: spin 1s linear infinite;
        }

        @keyframes spin {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }

        .offers-error {
          padding: 14px;
          text-align: center;
          color: var(--billhive-error-color, #dc2626);
          font-size: var(--billhive-font-size-sub-text, 12px);
        }

        .offers-error p {
          margin: 0;
        }

        .no-offers {
          padding: 14px;
          text-align: center;
          color: var(--billhive-sub-text-color, #8094ae);
          font-size: var(--billhive-font-size-sub-text, 12px);
          margin: 0;
          font-style: italic;
        }

        /* Coupon styles */
        .coupon-section {
          border-top: 1px solid #e7ecf3;
          padding-top: 14px;
          margin-top: 14px;
        }

        .coupon-section h4 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: 600;
          color: #364a63;
          margin: 0 0 12px 0;
        }

        .coupon-input-group {
          display: flex;
          gap: 12px;
          margin-bottom: 12px;
        }

        .coupon-input-group input {
          flex: 1;
          padding: 8px;
          border: 1px solid var(--billhive-border-color, #e7ecf3);
          border-radius: var(--billhive-element-border-radius, 4px);
          font-size: var(--billhive-font-size-body-text, 12px);
          font-family: var(--billhive-font-family);
        }

        .coupon-input-group input:focus {
          outline: none;
          border-color: var(--billhive-accent-color, #526484);
        }

        .apply-coupon-btn {
          padding: 8px 12px;
          background: var(--billhive-accent-color, #526484);
          color: var(--billhive-header-color, white);
          border: none;
          border-radius: var(--billhive-element-border-radius, 4px);
          font-size: var(--billhive-font-size-body-text, 12px);
          font-weight: 500;
          cursor: pointer;
          transition: background 0.2s ease;
          font-family: var(--billhive-font-family);
        }

        .apply-coupon-btn:hover {
          background: var(--billhive-accent-hover, #455670);
        }

        .coupon-message {
          font-size: var(--billhive-font-size-body-text, 12px);
          padding: 12px;
          border-radius: var(--billhive-element-border-radius, 4px);
          margin-bottom: 12px;
        }

        .coupon-message.success {
          background: #d4edda;
          color: #155724;
          border: 1px solid #c3e6cb;
        }

        /* Order Confirmation Styles */
        .confirmation-container {
          max-width: 600px;
          margin: 0 auto;
        }

        .confirmation-success {
          text-align: center;
          margin-bottom: 24px;
        }

        .success-icon-large {
          display: inline-flex;
          margin-bottom: 14px;
        }

        .confirmation-success h2 {
          font-size: var(--billhive-font-size-heading, 12px);
          font-weight: 700;
          color: #10b981;
          margin: 0 0 12px 0;
        }

        .confirmation-message {
          color: #8094ae;
          font-size: var(--billhive-font-size-body-text, 12px);
          margin: 0;
        }

        .confirmation-details {
          background: #f8f9fb;
          border-radius: var(--billhive-element-border-radius, 8px);
          padding: 14px;
        }

        .confirmation-details h3 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: 600;
          color: #364a63;
          margin: 0 0 12px 0;
        }

        .detail-section {
          margin-bottom: 12px;
          padding-bottom: 12px;
          border-bottom: 1px solid #e7ecf3;
        }

        .detail-section:last-of-type {
          border-bottom: none;
          margin-bottom: 0;
          padding-bottom: 0;
        }

        .detail-section h4 {
          font-size: 12px;
          font-weight: 600;
          color: #8094ae;
          text-transform: uppercase;
          letter-spacing: 0.5px;
          margin: 0 0 12px 0;
        }

        .detail-row {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 12px 0;
        }

        .detail-label {
          color: #8094ae;
          font-size: 12px;
        }

        .detail-value {
          color: #364a63;
          font-weight: 600;
          font-size: 12px;
        }

        .discount-row .detail-value {
          color: #10b981;
        }

        .total-row {
          border-top: 2px solid #e7ecf3;
          margin-top: 12px;
          padding-top: 14px;
        }

        .total-row .detail-label,
        .total-row .detail-value {
          font-size: 12px;
          font-weight: 700;
        }

        .confirmation-note {
          background: #f0fdf4;
          border: 1px solid #10b981;
          border-radius: var(--billhive-element-border-radius, 12px);
          padding: 12px;
          margin-top: 14px;
        }

        .confirmation-note p {
          color: var(--billhive-text-color, #364a63);
          font-size: var(--billhive-font-size-body-text, 12px);
          margin: 12px 0;
          font-family: var(--billhive-font-family);
        }

        .confirmation-note p:first-child {
          margin-top: 0;
        }

        .confirmation-note p:last-child {
          margin-bottom: 0;
        }

        .confirmation-actions h3 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          margin: 0 0 12px 0;
          font-family: var(--billhive-font-family);
        }

        .next-steps {
          display: flex;
          flex-direction: column;
          gap: 14px;
        }

        .next-step {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .step-number {
          width: 26px;
          height: 26px;
          background: var(--billhive-input-components-color, #e7ecf3);
          color: var(--billhive-text-color, #364a63);
          border-radius: 50%;
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: var(--billhive-header-font-weight, 600);
          font-size: var(--billhive-font-size-body-text, 12px);
          flex-shrink: 0;
          font-family: var(--billhive-font-family);
        }

        .step-text {
          color: var(--billhive-text-color, #364a63);
          font-size: var(--billhive-font-size-body-text, 12px);
          line-height: 1.3;
          font-family: var(--billhive-font-family);
        }

        .close-confirmation-btn {
          width: 100%;
          background: var(--billhive-input-components-color, #e7ecf3);
          color: var(--billhive-text-color, #364a63);
          border: none;
          padding: 12px 15px;
          border-radius: var(--billhive-element-border-radius, 8px);
          font-size: var(--billhive-font-size-body-text, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          cursor: pointer;
          margin-top: 12px;
          transition: all 0.2s ease;
          font-family: var(--billhive-font-family);
        }

        .close-confirmation-btn:hover {
          background: var(--billhive-border-color, #d4dae6);
        }

        .coupon-message.error {
          background: #f8d7da;
          color: #721c24;
          border: 1px solid #f5c6cb;
        }

        .applied-coupon {
          display: flex;
          justify-content: space-between;
          align-items: center;
          background: #d4edda;
          padding: 12px;
          border-radius: var(--billhive-element-border-radius, 4px);
          border: 1px solid #c3e6cb;
        }

        .coupon-error {
          background: #fef2f2;
          border: 1px solid #fecaca;
          color: #dc2626;
          padding: 12px;
          border-radius: var(--billhive-element-border-radius, 4px);
          font-size: var(--billhive-font-size-sub-text, 12px);
          margin-top: 12px;
        }

        .coupon-name {
          color: #155724;
          font-weight: 500;
          font-size: var(--billhive-font-size-body-text, 12px);
          font-family: var(--billhive-font-family);
        }

        .remove-coupon-btn {
          background: none;
          border: none;
          color: #155724;
          font-size: 14px;
          font-weight: bold;
          cursor: pointer;
          padding: 0;
          width: 20px;
          height: 20px;
          display: flex;
          align-items: center;
          justify-content: center;
        }

        .remove-coupon-btn:hover {
          background: rgba(21, 87, 36, 0.1);
          border-radius: 50%;
        }

        /* Updated summary styles */
        .summary-subtotal {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 2px 0;
          color: var(--billhive-sub-text-color, #8094ae);
          font-size: var(--billhive-font-size-body-text, 14px);
          font-family: var(--billhive-font-family);
        }

        .summary-discount {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 2px 0;
          color: #10b981;
          font-size: var(--billhive-font-size-body-text, 14px);
          font-family: var(--billhive-font-family);
        }

        .summary-tax {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 2px 0;
          color: var(--billhive-sub-text-color, #8094ae);
          font-size: var(--billhive-font-size-body-text, 14px);
          font-family: var(--billhive-font-family);
        }

        .discount-amount {
          font-weight: 600;
        }

        .savings-notice {
          text-align: center;
          color: #10b981;
          font-weight: var(--billhive-header-font-weight, 600);
          font-size: var(--billhive-font-size-body-text, 12px);
          padding: 12px;
          background: #f0fdf4;
          border-radius: var(--billhive-element-border-radius, 4px);
          margin-top: 12px;
          font-family: var(--billhive-font-family);
        }

        .discount-group .item-name {
          display: flex;
          align-items: center;
          gap: 12px;
        }

        .discount-info-icon {
          position: relative;
          display: inline-flex;
          align-items: center;
          justify-content: center;
          width: 16px;
          height: 16px;
          background: var(--billhive-input-components-color, #e7ecf3);
          color: var(--billhive-text-color, #364a63);
          border-radius: 50%;
          font-size: 12px;
          font-weight: bold;
          cursor: help;
          transition: all 0.2s ease;
        }

        .discount-info-icon:hover {
          background: var(--billhive-primary-color, #2563eb);
          color: white;
        }

        .discount-tooltip {
          position: absolute;
          bottom: 100%;
          left: 50%;
          transform: translateX(-50%);
          background: white;
          border: 1px solid var(--billhive-border-color, #d4dae6);
          border-radius: var(--billhive-element-border-radius, 4px);
          padding: 12px;
          min-width: 200px;
          box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
          z-index: 1000;
          display: none;
          margin-bottom: 12px;
        }

        .discount-info-icon:hover .discount-tooltip {
          display: block;
        }

        .discount-tooltip::after {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          border: 12px solid transparent;
          border-top-color: white;
        }

        .discount-tooltip::before {
          content: '';
          position: absolute;
          top: 100%;
          left: 50%;
          transform: translateX(-50%);
          border: 7px solid transparent;
          border-top-color: var(--billhive-border-color, #d4dae6);
          margin-top: -1px;
        }

        .tooltip-title {
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          margin-bottom: 12px;
          font-size: var(--billhive-font-size-sub-text, 12px);
        }

        .tooltip-item {
          color: var(--billhive-sub-text-color, #8094ae);
          font-size: var(--billhive-font-size-sub-text, 12px);
          padding: 12px 0;
        }

        @media (max-width: 768px) {
          .modal-container {
            margin: 14px;
            min-height: 500px;
            max-height: calc(100vh - 24px);
          }

          .modal-content {
            flex-direction: column;
          }

          .page-sidebar {
            border-left: none;
            border-top: 1px solid #e7ecf3;
          }

          .page-body {
            padding: 18px;
          }
          
          .order-summary-content {
            padding: 18px;
          }
          
          .sidebar-footer {
            padding: 14px 18px 18px 18px;
          }

          .selected-plan {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
          }

          .coupon-input-group {
            flex-direction: column;
          }

          .apply-coupon-btn {
            width: 100%;
          }
        }

        /* Personal Details Form Styles */
        .personal-details-form {
          max-width: 600px;
          text-align: left !important; /* Override any external text-center */
        }
        
        /* Prevent external pricing styles from affecting this form */
        .personal-details-form.pricing,
        .personal-details-form.text-center {
          text-align: left !important;
        }

        .personal-details-form h3 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          margin: 0 0 12px 0;
          padding-bottom: 12px;
          border-bottom: 1px solid var(--billhive-border-color, #e7ecf3);
          font-family: var(--billhive-font-family);
        }

        .form-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 14px;
          margin-bottom: 18px;
        }

        .form-group {
          display: flex;
          flex-direction: column;
          width: 100%
        }

        .form-group.full-width {
          grid-column: 1 / -1;
        }

        .form-group label {
          font-weight: 500;
          color: var(--billhive-text-color, #364a63);
          margin-bottom: 12px;
          font-size: var(--billhive-font-size-body-text, 12px);
          font-family: var(--billhive-font-family);
        }

        .form-group input,
        .form-group select {
          padding: 8px;
          border: 2px solid var(--billhive-border-color, #e7ecf3);
          border-radius: var(--billhive-element-border-radius, 12px);
          font-size: var(--billhive-font-size-body-text, 12px);
          transition: border-color 0.2s ease;
          font-family: var(--billhive-font-family);
          background: var(--billhive-input-components-color, #f8f9fb);
        }

        .form-group input:focus,
        .form-group select:focus {
          outline: none;
          border-color: var(--billhive-accent-color, #526484);
        }

        .form-group input.error,
        .form-group select.error {
          border-color: var(--billhive-error-color, #e85347);
        }

        .field-error {
          color: var(--billhive-error-color, #e85347);
          font-size: var(--billhive-font-size-sub-text, 12px);
          margin-top: 12px;
          display: none;
          font-family: var(--billhive-font-family);
        }

        .form-actions {
          display: flex;
          gap: 14px;
        }

        .back-btn {
          background: var(--billhive-cards-color, #ffffff);
          color: var(--billhive-text-color, #364a63);
          border: 2px solid var(--billhive-border-color, #e7ecf3);
          font-weight: 600;
          display: flex;
          align-items: center;
          justify-content: center;
          gap: 8px;
        }

        .back-btn:hover {
          background: var(--billhive-disabled-color, #f8f9fb);
          border-color: var(--billhive-accent-color, #526484);
          color: var(--billhive-accent-color, #526484);
          transform: translateY(-1px);
        }

        .sidebar-footer .proceed-btn {
          flex: 1;
          min-width: 180px;
        }

        .proceed-btn:hover:not(:disabled) {
          background: var(--billhive-accent-hover, #455670);
          border-color: var(--billhive-accent-hover, #455670);
          transform: translateY(-1px);
          box-shadow: var(--billhive-button-shadow, 0 4px 12px rgba(82, 100, 132, 0.3));
        }

        .proceed-btn:disabled {
          background: #e0e0e0;
          border-color: #e0e0e0;
          color: #999;
          cursor: not-allowed;
          opacity: 0.6;
        }

        .proceed-btn:disabled:hover {
          transform: none;
          box-shadow: none;
        }

        @media (max-width: 768px) {
          .modal-container {
            margin: 14px;
            min-height: 500px;
            max-height: calc(100vh - 24px);
          }

          .modal-content {
            flex-direction: column;
          }

          .page-sidebar {
            border-left: none;
            border-top: 1px solid #e7ecf3;
          }

        
          .page-body {
            padding: 18px;
          }
          
          .order-summary-content {
            padding: 18px;
          }
          
          .sidebar-footer {
            padding: 14px 18px 18px 18px;
          }

          .selected-plan {
            flex-direction: column;
            align-items: flex-start;
            gap: 12px;
          }

          .coupon-input-group {
            flex-direction: column;
          }

          .apply-coupon-btn {
            width: 100%;
          }

          .form-grid {
            grid-template-columns: 1fr;
          }

          .form-actions {
            flex-direction: column-reverse;
            gap: 12px;
          }

          .back-btn,
          .proceed-btn {
            width: 100%;
            min-width: unset;
            justify-content: center;
          }

          .proceed-btn {
            flex: none;
          }
        }

        /* Payment Method Styles */
        .payment-methods-section {
          max-width: 600px;
        }

        .payment-methods-section h3 {
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          margin: 0 0 14px 0;
          padding-bottom: 12px;
          border-bottom: 1px solid var(--billhive-border-color, #e7ecf3);
          font-family: var(--billhive-font-family);
        }

        .payment-methods-grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
          gap: 12px;
          margin-bottom: 14px;
        }

        .payment-method-card {
          padding: 12px;
          border: 2px solid var(--billhive-border-color, #e7ecf3);
          border-radius: var(--billhive-element-border-radius, 12px);
          cursor: pointer;
          transition: all 0.2s ease;
          text-align: center;
          background: var(--billhive-cards-color, #ffffff);
          position: relative;
          user-select: none;
          min-height: 90px;
        }

        .payment-method-card:hover {
          border-color: var(--billhive-accent-color, #526484);
          background: var(--billhive-disabled-color, #f8f9fb);
        }

        .payment-method-card.selected {
          border-color: var(--billhive-accent-color, #526484);
          background: var(--billhive-disabled-color, #f8f9fb);
        }

        .payment-method-icon {
          font-size: 24px;
          margin-bottom: 12px;
          display: block;
        }

        .payment-method-name {
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          font-size: var(--billhive-font-size-body-text, 12px);
          font-family: var(--billhive-font-family);
        }

        .payment-form {
          background: #f8f9fb;
          padding: 18px;
          border-radius: var(--billhive-element-border-radius, 8px);
          border: 1px solid #e7ecf3;
          margin-top: 14px;
        }

        .payment-form .form-group label {
          text-align: left !important;
          display: block;
        }

        .payment-form .form-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 14px;
        }

        .cashfree-input-container {
          min-height: 44px;
          background: var(--billhive-surface, #fff);
          border-radius: var(--billhive-element-border-radius, 12px);
          position: relative;
        }

        .cashfree-input-container iframe {
          width: 100% !important;
          height: 44px !important;
        }

        .cashfree-loading {
          text-align: center;
          padding: 20px;
          color: var(--billhive-text-secondary, #666);
        }

        .cashfree-loading p {
          margin: 0;
          font-size: var(--billhive-font-size-body-text, 12px);
        }

        .wallet-options {
          margin-bottom: 14px;
        }

        .wallet-section-label {
          display: block;
          font-weight: 500;
          color: var(--billhive-text-color, #364a63);
          margin-bottom: 12px;
          font-size: var(--billhive-font-size-body-text, 12px);
          font-family: var(--billhive-font-family);
          text-align: left !important;
        }

        .wallet-providers {
          display: grid;
          grid-template-columns: 1fr;
          gap: 12px;
        }

        .wallet-provider-container {
          position: relative;
        }

        .cashfree-wallet-container {
          min-height: 48px;
          background: var(--billhive-surface, #fff);
          border-radius: var(--billhive-element-border-radius, 4px);
          position: relative;
        }

        .cashfree-wallet-container iframe {
          width: 100% !important;
          min-height: 48px !important;
        }

        .wallet-note {
          background: var(--billhive-input-components-color, #f9fafb);
          padding: 12px;
          border-radius: var(--billhive-element-border-radius, 4px);
          border-left: 4px solid var(--billhive-accent-color, #5b5bd6);
          font-size: var(--billhive-font-size-sub-text, 12px);
          color: var(--billhive-sub-text-color, #6b7280);
          margin-top: 14px;
        }

        .upi-note,
        .netbanking-note {
          background: var(--billhive-accent-light, #e8f4fd);
          padding: 12px;
          border-radius: var(--billhive-element-border-radius, 12px);
          border-left: 4px solid var(--billhive-accent-color, #526484);
          margin-top: 14px;
        }

        .upi-note p,
        .netbanking-note p {
          margin: 0;
          color: var(--billhive-text-color, #364a63);
          font-size: var(--billhive-font-size-body-text, 12px);
          line-height: 1.4;
          font-family: var(--billhive-font-family);
        }

        @media (max-width: 768px) {
          .payment-methods-grid {
            grid-template-columns: repeat(2, 1fr);
          }

          .payment-method-card {
            padding: 12px;
          }

          .payment-method-icon {
            font-size: 18px;
          }

          .payment-form .form-grid {
            grid-template-columns: 1fr;
          }
        }

        /* Payment Form Section Styles */
        .payment-form-section {
          max-width: 600px;
        }

        .selected-method-header {
          display: flex;
          align-items: center;
          justify-content: space-between;
          margin-bottom: 18px;
          padding-bottom: 14px;
          border-bottom: 1px solid #e7ecf3;
        }

        .change-method-btn {
          display: flex;
          align-items: center;
          gap: 12px;
          background: var(--billhive-cards-color, #ffffff);
          color: var(--billhive-text-color, #364a63);
          border: 2px solid var(--billhive-border-color, #e7ecf3);
          padding: 12px 14px;
          border-radius: var(--billhive-element-border-radius, 12px);
          font-size: var(--billhive-font-size-body-text, 12px);
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s ease;
        }

        .change-method-btn:hover {
          background: var(--billhive-disabled-color, #f8f9fb);
          border-color: var(--billhive-accent-color, #526484);
          color: var(--billhive-accent-hover, #455670);
        }

        .selected-method-header h3 {
          margin: 0;
          font-size: var(--billhive-font-size-sub-heading, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          font-family: var(--billhive-font-family);
        }

        @media (max-width: 768px) {
          .selected-method-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 14px;
          }

          .change-method-btn {
            order: 2;
            align-self: flex-end;
          }

          /* Mobile stepper styles */
          .progress-steps {
            max-width: 100%;
          }

          .step-label {
            font-size: 12px;
            line-height: 1.1;
          }

          .step-icon {
            width: 24px;
            height: 24px;
            font-size: 12px;
          }

          .step-connector {
            margin: 0 12px;
            top: -12px;
          }
        }
        
        .payment-method-card .payment-icon {
          margin-bottom: 12px;
        }
        
        .payment-method-card h4 {
          font-size: var(--billhive-font-size-body-text, 12px);
          font-weight: var(--billhive-header-font-weight, 600);
          color: var(--billhive-text-color, #364a63);
          margin: 0 0 12px 0;
          font-family: var(--billhive-font-family);
        }
        
        .payment-method-card p {
          font-size: var(--billhive-font-size-sub-text, 12px);
          color: var(--billhive-sub-text-color, #8094ae);
          margin: 0;
          line-height: 1.2;
          font-family: var(--billhive-font-family);
        }
      </style>
    `}}customElements.define("bh-checkout",P),typeof module<"u"&&module.exports&&(module.exports=P);class $ extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.productId=null,this.planId=null,this.apiKey=null,this.hasTriggeredCheckout=!1}static get observedAttributes(){return["data-product-id","data-plan-id","api-key"]}connectedCallback(){this.loadData(),this.hasTriggeredCheckout||(this.hasTriggeredCheckout=!0,this.handleSelectPlan())}attributeChangedCallback(e,t,i){t!==i&&(e==="data-product-id"?this.productId=i:e==="data-plan-id"?this.planId=i:e==="api-key"&&(this.apiKey=i))}loadData(){this.productId=this.getAttribute("data-product-id"),this.planId=this.getAttribute("data-plan-id"),this.apiKey=this.getAttribute("api-key"),console.log("PlanSelector: loadData - productId:",this.productId),console.log("PlanSelector: loadData - planId:",this.planId),console.log("PlanSelector: loadData - apiKey:",this.apiKey)}async fetchThemeFromAPI(){try{const e=`${f.baseUrl}/cf190aae-cf47-44b0-9e11-6aa6f26bc403/themes/Checkout`;console.log("PlanSelector: fetchThemeFromAPI - URL:",e),console.log("PlanSelector: fetchThemeFromAPI - apiKey:",this.apiKey);const t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json","x-api-key":this.apiKey}});if(console.log("PlanSelector: fetchThemeFromAPI - response status:",t.status),!t.ok)throw new Error(`Failed to fetch theme: ${t.status}`);const i=await t.json();return console.log("PlanSelector: fetchThemeFromAPI - themeData received:",i),console.log("PlanSelector: fetchThemeFromAPI - layout from theme:",i==null?void 0:i.layout),i}catch(e){throw console.error("PlanSelector: fetchThemeFromAPI - error:",e),e}}async handleSelectPlan(){console.log("PlanSelector: handleSelectPlan - called"),console.log("PlanSelector: handleSelectPlan - productId:",this.productId),console.log("PlanSelector: handleSelectPlan - planId:",this.planId),console.log("PlanSelector: handleSelectPlan - apiKey:",this.apiKey);try{console.log("PlanSelector: handleSelectPlan - fetching theme from API...");const e=await this.fetchThemeFromAPI();console.log("PlanSelector: handleSelectPlan - theme fetched successfully");const t=(e==null?void 0:e.layout)||"in-app";console.log("PlanSelector: handleSelectPlan - layout determined:",t),t==="in-app"?(console.log("PlanSelector: handleSelectPlan - creating in-app checkout modal"),this.createInAppCheckout(e)):t==="full-page"&&(console.log("PlanSelector: handleSelectPlan - redirecting to full-page checkout"),this.redirectToFullPage(e))}catch(e){console.error("PlanSelector: handleSelectPlan - error:",e),alert("Failed to load checkout. Please try again.")}}createInAppCheckout(e){console.log("PlanSelector: createInAppCheckout - called with themeData:",e);const t=document.getElementById("checkout-modal");t&&(console.log("PlanSelector: removing existing checkout modal"),t.remove());const i=document.createElement("div");i.id="checkout-modal",i.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    `;const o=document.createElement("div");o.style.cssText=`
      background: white;
      border-radius: 8px;
      max-width: 1000px;
      width: 95%;
      max-height: 90vh;
      overflow: hidden;
      position: relative;
    `;const a=document.createElement("button");a.innerHTML="×",a.style.cssText=`
      position: absolute;
      top: 15px;
      right: 20px;
      background: none;
      border: none;
      font-size: 28px;
      cursor: pointer;
      color: #666;
      z-index: 1001;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background-color 0.2s;
    `,a.addEventListener("mouseenter",()=>{a.style.backgroundColor="#f0f0f0"}),a.addEventListener("mouseleave",()=>{a.style.backgroundColor="transparent"});const n=document.createElement("bh-checkout");n.setAttribute("data-mode","modal"),this.planId&&n.setAttribute("data-plan-id",this.planId),this.apiKey&&n.setAttribute("api-key",this.apiKey),e&&n.setAttribute("data-theme",JSON.stringify(e.theme));const s=()=>{i.remove(),this.remove()};a.addEventListener("click",s),i.addEventListener("click",d=>{d.target===i&&s()}),n.addEventListener("checkout-closed",s),o.appendChild(a),o.appendChild(n),i.appendChild(o),document.body.appendChild(i),console.log("PlanSelector: createInAppCheckout - modal created and appended to body")}redirectToFullPage(e){console.log("PlanSelector: redirectToFullPage - called with themeData:",e);const t=encodeURIComponent(JSON.stringify(e)),i=encodeURIComponent(JSON.stringify({productId:this.productId,planId:this.planId})),o=`https://google.com/?theme=${t}&plan=${i}`;console.log("PlanSelector: redirectToFullPage - redirecting to:",o),window.location.href=o}render(){this.shadowRoot.innerHTML=""}}customElements.define("bh-plan-selector",$),typeof module<"u"&&module.exports&&(module.exports=$)})();

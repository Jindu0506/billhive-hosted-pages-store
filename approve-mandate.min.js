!function(){"use strict";const n="\n  :host {\n    display: block;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    --primary: #0d9488;\n    --primary-hover: #0f766e;\n    --border-color: #d3d3d3;\n    --text-primary: #374151;\n    --text-secondary: #6b7280;\n    --text-muted: #9ca3af;\n    --bg-white: #ffffff;\n    --success: #10b981;\n    --error: #ef4444;\n  }\n\n  :host([theme=\"dark\"]) {\n    --border-color: #3b3f5c;\n    --text-primary: #e5e7eb;\n    --text-secondary: #9ca3af;\n    --text-muted: #6b7280;\n    --bg-white: #1b2e4b;\n  }\n\n  * { box-sizing: border-box; margin: 0; padding: 0; }\n\n  .container {\n    max-width: 480px;\n    margin: 0 auto;\n    padding: 16px;\n  }\n\n  .header {\n    text-align: center;\n    padding: 20px;\n    margin-bottom: 16px;\n  }\n\n  .header-title {\n    font-size: 18px;\n    font-weight: 600;\n    color: var(--text-primary);\n    margin-bottom: 8px;\n  }\n\n  .header-amount {\n    font-size: 28px;\n    font-weight: 700;\n    color: var(--primary);\n  }\n\n  .amount-label {\n    font-size: 12px;\n    color: var(--text-muted);\n    margin-bottom: 4px;\n  }\n\n  .mandate-info {\n    display: flex;\n    justify-content: center;\n    gap: 24px;\n    margin-top: 12px;\n  }\n\n  .mandate-info-item { text-align: center; }\n\n  .mandate-info-label {\n    font-size: 11px;\n    color: var(--text-muted);\n    text-transform: uppercase;\n  }\n\n  .mandate-info-value {\n    font-size: 13px;\n    font-weight: 600;\n    color: var(--text-secondary);\n  }\n\n  .status-badge {\n    display: inline-block;\n    padding: 4px 12px;\n    border-radius: 12px;\n    font-size: 11px;\n    font-weight: 600;\n    text-transform: uppercase;\n    margin-bottom: 8px;\n  }\n\n  .status-badge.active { background: rgba(16, 185, 129, 0.1); color: #10b981; }\n  .status-badge.pending { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }\n  .status-badge.failed { background: rgba(239, 68, 68, 0.1); color: #ef4444; }\n\n  .btn-primary {\n    width: 100%;\n    padding: 14px 16px;\n    background: var(--primary);\n    color: white;\n    border: none;\n    border-radius: 6px;\n    font-size: 14px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: background 0.2s;\n  }\n\n  .btn-primary:hover:not(:disabled) { background: var(--primary-hover); }\n  .btn-primary:disabled { background: #9ca3af; cursor: not-allowed; }\n\n  .loading-container {\n    padding: 60px 20px;\n    text-align: center;\n  }\n\n  .spinner {\n    width: 32px;\n    height: 32px;\n    border: 3px solid var(--border-color);\n    border-top-color: var(--primary);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin: 0 auto 12px;\n  }\n\n  @keyframes spin { to { transform: rotate(360deg); } }\n\n  .loading-text {\n    font-size: 14px;\n    color: var(--text-secondary);\n  }\n\n  .result-container {\n    padding: 48px 24px;\n    text-align: center;\n  }\n\n  .result-icon {\n    width: 64px;\n    height: 64px;\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    margin: 0 auto 16px;\n    font-size: 28px;\n  }\n\n  .result-icon.success { background: rgba(16, 185, 129, 0.1); color: var(--success); }\n  .result-icon.error { background: rgba(239, 68, 68, 0.1); color: var(--error); }\n\n  .result-title {\n    font-size: 20px;\n    font-weight: 600;\n    color: var(--text-primary);\n    margin-bottom: 8px;\n  }\n\n  .result-message {\n    font-size: 14px;\n    color: var(--text-secondary);\n    line-height: 1.5;\n  }\n\n  .footer {\n    text-align: center;\n    margin-top: 16px;\n    font-size: 12px;\n    color: var(--text-muted);\n  }\n";class t extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),this.cashfree=null,this.state={isLoading:!0,error:null,mandate:null}}static get observedAttributes(){return["session-id","environment","api-key"]}connectedCallback(){this.init()}attributeChangedCallback(n,t,e){t!==e&&"session-id"===n&&this.init()}get sessionId(){return this.getAttribute("session-id")}get environment(){return this.getAttribute("environment")||"sandbox"}get apiKey(){return this.getAttribute("api-key")}get returnUrl(){return this.getAttribute("return-url")}getBaseUrl(){return"production"===this.environment?"https://api.billhive.com":"http://localhost:4001"}async loadCashfreeSDK(){return window.Cashfree?window.Cashfree:new Promise((n,t)=>{const e=document.createElement("script");e.src="https://sdk.cashfree.com/js/v3/cashfree.js",e.onload=()=>n(window.Cashfree),e.onerror=()=>t(new Error("Failed to load Cashfree SDK")),document.head.appendChild(e)})}async init(){this.state={isLoading:!0,error:null,mandate:null},this.render();try{const n=await fetch(`${this.getBaseUrl()}/mandate/${this.sessionId}`,{headers:{"Content-Type":"application/json","x-api-key":this.apiKey}});if(!n.ok)throw new Error(`Failed to fetch mandate: ${n.status}`);const t=await n.json();this.state.mandate=this.transformResponse(t);const e=await this.loadCashfreeSDK();this.cashfree=e({mode:"production"===this.environment?"production":"sandbox"})}catch(n){this.state.error=n.message}this.state.isLoading=!1,this.render()}transformResponse(n){return n.planDetails?{mandateSessionId:n.mandateSessionId,status:n.status,planName:n.planDetails.planName,maxAmount:n.planDetails.maxAmount||0,recurringAmount:n.planDetails.recurringAmount||0,currency:this.getCurrency(n.planDetails.currency),planType:this.formatPlanType(n.planDetails.planType),validity:this.formatDate(n.expiryDate)}:null}getCurrency(n){return{INR:"₹",USD:"$",EUR:"€",GBP:"£"}[null==n?void 0:n.toUpperCase()]||"₹"}formatPlanType(n){return{ON_DEMAND:"On Demand",PERIODIC:"Periodic"}[null==n?void 0:n.toUpperCase()]||"On Demand"}formatDate(n){if(!n)return"Until cancelled";try{return new Date(n).toLocaleDateString("en-IN",{year:"numeric",month:"short",day:"numeric"})}catch{return"Until cancelled"}}getStatusClass(n){const t=(n||"").toUpperCase();return["ACTIVE","COMPLETED"].includes(t)?"active":["FAILED","CANCELLED","EXPIRED","HALTED"].includes(t)?"failed":"pending"}render(){var t,e;const{isLoading:a,error:i,mandate:r}=this.state;if(!a)return i?(this.shadowRoot.innerHTML=`\n        <style>${n}</style>\n        <div class="container">\n          <div class="result-container">\n            <div class="result-icon error">✕</div>\n            <div class="result-title">Error</div>\n            <div class="result-message">${i}</div>\n          </div>\n          <button class="btn-primary" id="retry-btn">Try Again</button>\n        </div>\n      `,void(null==(t=this.shadowRoot.getElementById("retry-btn"))||t.addEventListener("click",()=>this.init()))):void(r?(this.shadowRoot.innerHTML=`\n      <style>${n}</style>\n      <div class="container">\n        <div class="header">\n          <div class="status-badge ${this.getStatusClass(r.status)}">${r.status}</div>\n          <div class="header-title">${r.planName||"Authorize Mandate"}</div>\n          <div class="amount-label">Maximum Debit Amount</div>\n          <div class="header-amount">${r.currency}${r.maxAmount}</div>\n          <div class="mandate-info">\n            <div class="mandate-info-item">\n              <div class="mandate-info-label">Recurring</div>\n              <div class="mandate-info-value">${r.currency}${r.recurringAmount}</div>\n            </div>\n            <div class="mandate-info-item">\n              <div class="mandate-info-label">Plan Type</div>\n              <div class="mandate-info-value">${r.planType}</div>\n            </div>\n            <div class="mandate-info-item">\n              <div class="mandate-info-label">Valid Until</div>\n              <div class="mandate-info-value">${r.validity}</div>\n            </div>\n          </div>\n        </div>\n        <button class="btn-primary" id="pay-btn">Proceed to Pay</button>\n        <div class="footer">Powered by Cashfree</div>\n      </div>\n    `,null==(e=this.shadowRoot.getElementById("pay-btn"))||e.addEventListener("click",()=>this.startCheckout())):this.shadowRoot.innerHTML=`\n        <style>${n}</style>\n        <div class="container">\n          <div class="result-container">\n            <div class="result-icon error">✕</div>\n            <div class="result-title">Invalid Mandate</div>\n            <div class="result-message">Could not load mandate details.</div>\n          </div>\n        </div>\n      `);this.shadowRoot.innerHTML=`\n        <style>${n}</style>\n        <div class="container">\n          <div class="loading-container">\n            <div class="spinner"></div>\n            <div class="loading-text">Loading...</div>\n          </div>\n        </div>\n      `}startCheckout(){const{mandate:n}=this.state;if(!(null==n?void 0:n.mandateSessionId)||!this.cashfree)return this.state.error="Unable to start checkout. Please refresh and try again.",void this.render();const t=this.shadowRoot.getElementById("pay-btn");t&&(t.disabled=!0,t.innerHTML='<div class="spinner" style="width:20px;height:20px;border-width:2px;margin:0 auto;"></div>'),this.dispatchEvent(new CustomEvent("mandate-checkout-started",{detail:{mandateSessionId:n.mandateSessionId},bubbles:!0,composed:!0}));try{this.cashfree.subscriptionsCheckout({subsSessionId:n.mandateSessionId,redirectTarget:"_self"})}catch(e){this.state.error=e.message||"Checkout failed",this.render()}}}customElements.define("approve-mandate",t)}();
